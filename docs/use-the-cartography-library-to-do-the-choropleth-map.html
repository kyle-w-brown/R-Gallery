<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Use the cartography library to do the choropleth map | R Gallery Book</title>
  <meta name="description" content="This is the complete guide to the R Gallery." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Use the cartography library to do the choropleth map | R Gallery Book" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the complete guide to the R Gallery." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Use the cartography library to do the choropleth map | R Gallery Book" />
  
  <meta name="twitter:description" content="This is the complete guide to the R Gallery." />
  

<meta name="author" content="Kyle W. Brown" />


<meta name="date" content="2021-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="map.html"/>
<link rel="next" href="flow.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Gallery Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Foreword</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>3</b> Distributions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="distributions.html"><a href="distributions.html#violin"><i class="fa fa-check"></i><b>3.1</b> Violin</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="distributions.html"><a href="distributions.html#base-r-violin-plot"><i class="fa fa-check"></i><b>3.1.1</b> Base R Violin Plot</a></li>
<li class="chapter" data-level="3.1.2" data-path="distributions.html"><a href="distributions.html#basic-ggplot-violin-plot"><i class="fa fa-check"></i><b>3.1.2</b> Basic ggplot Violin Plot</a></li>
<li class="chapter" data-level="3.1.3" data-path="distributions.html"><a href="distributions.html#note-on-input-format"><i class="fa fa-check"></i><b>3.1.3</b> Note on Input Format</a></li>
<li class="chapter" data-level="3.1.4" data-path="distributions.html"><a href="distributions.html#from-wide-format"><i class="fa fa-check"></i><b>3.1.4</b> From Wide Format</a></li>
<li class="chapter" data-level="3.1.5" data-path="distributions.html"><a href="distributions.html#reorder-a-variable-with-ggplot2"><i class="fa fa-check"></i><b>3.1.5</b> Reorder a variable with <code>ggplot2</code></a></li>
<li class="chapter" data-level="3.1.6" data-path="distributions.html"><a href="distributions.html#method-1-the-forcats-library"><i class="fa fa-check"></i><b>3.1.6</b> Method 1: the <code>forcats</code> library</a></li>
<li class="chapter" data-level="3.1.7" data-path="distributions.html"><a href="distributions.html#method-2-using-dplyr-only"><i class="fa fa-check"></i><b>3.1.7</b> Method 2: Using Dplyr Only</a></li>
<li class="chapter" data-level="3.1.8" data-path="distributions.html"><a href="distributions.html#method-3-the-reorder-function-of-base-r"><i class="fa fa-check"></i><b>3.1.8</b> Method 3: the <code>reorder()</code> Function of Base R</a></li>
<li class="chapter" data-level="3.1.9" data-path="distributions.html"><a href="distributions.html#horizontal-violin-plot-with-ggplot2"><i class="fa fa-check"></i><b>3.1.9</b> Horizontal Violin Plot with <code>ggplot2</code></a></li>
<li class="chapter" data-level="3.1.10" data-path="distributions.html"><a href="distributions.html#violin-plot-with-included-boxplot-and-sample-size-in-ggplot2"><i class="fa fa-check"></i><b>3.1.10</b> Violin Plot with included Boxplot and Sample Size in ggplot2</a></li>
<li class="chapter" data-level="3.1.11" data-path="distributions.html"><a href="distributions.html#grouped-violin-chart-with-ggplot2"><i class="fa fa-check"></i><b>3.1.11</b> Grouped Violin Chart with ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="distributions.html"><a href="distributions.html#density"><i class="fa fa-check"></i><b>3.2</b> Density</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="distributions.html"><a href="distributions.html#basic-density-chart-with-ggplot2"><i class="fa fa-check"></i><b>3.2.1</b> Basic density chart with ggplot2</a></li>
<li class="chapter" data-level="3.2.2" data-path="distributions.html"><a href="distributions.html#custom-with-theme_ipsum"><i class="fa fa-check"></i><b>3.2.2</b> Custom with <code>theme_ipsum</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="distributions.html"><a href="distributions.html#mirror-density-chart-with-ggplot2"><i class="fa fa-check"></i><b>3.2.3</b> Mirror Density Chart with ggplot2</a></li>
<li class="chapter" data-level="3.2.4" data-path="distributions.html"><a href="distributions.html#density-with-geom_density"><i class="fa fa-check"></i><b>3.2.4</b> Density with <code>geom_density</code></a></li>
<li class="chapter" data-level="3.2.5" data-path="distributions.html"><a href="distributions.html#histogram-with-geom_histogram"><i class="fa fa-check"></i><b>3.2.5</b> Histogram with <code>geom_histogram</code></a></li>
<li class="chapter" data-level="3.2.6" data-path="distributions.html"><a href="distributions.html#density-chart-with-several-groups"><i class="fa fa-check"></i><b>3.2.6</b> Density Chart with Several Groups</a></li>
<li class="chapter" data-level="3.2.7" data-path="distributions.html"><a href="distributions.html#multi-density-chart"><i class="fa fa-check"></i><b>3.2.7</b> Multi density chart</a></li>
<li class="chapter" data-level="3.2.8" data-path="distributions.html"><a href="distributions.html#small-multiple-with-facet_wrap"><i class="fa fa-check"></i><b>3.2.8</b> Small Multiple with <code>facet_wrap()</code></a></li>
<li class="chapter" data-level="3.2.9" data-path="distributions.html"><a href="distributions.html#stacked-density-chart"><i class="fa fa-check"></i><b>3.2.9</b> Stacked Density Chart</a></li>
<li class="chapter" data-level="3.2.10" data-path="distributions.html"><a href="distributions.html#marginal-distribution-with-ggplot2-and-ggextra"><i class="fa fa-check"></i><b>3.2.10</b> Marginal distribution with ggplot2 and ggExtra</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="distributions.html"><a href="distributions.html#histogram"><i class="fa fa-check"></i><b>3.3</b> Histogram</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="distributions.html"><a href="distributions.html#ggplot2"><i class="fa fa-check"></i><b>3.3.1</b> GGPLOT2</a></li>
<li class="chapter" data-level="3.3.2" data-path="distributions.html"><a href="distributions.html#basic-histogram-with-ggplot2"><i class="fa fa-check"></i><b>3.3.2</b> Basic histogram with ggplot2</a></li>
<li class="chapter" data-level="3.3.3" data-path="distributions.html"><a href="distributions.html#basic-histogram-with-geom_histogram"><i class="fa fa-check"></i><b>3.3.3</b> Basic Histogram with <code>geom_histogram</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="distributions.html"><a href="distributions.html#control-bin-size-with-binwidth"><i class="fa fa-check"></i><b>3.3.4</b> Control Bin Size with <code>binwidth</code></a></li>
<li class="chapter" data-level="3.3.5" data-path="distributions.html"><a href="distributions.html#histogram-with-several-groups---ggplot2"><i class="fa fa-check"></i><b>3.3.5</b> Histogram with Several Groups - ggplot2</a></li>
<li class="chapter" data-level="3.3.6" data-path="distributions.html"><a href="distributions.html#using-small-multiple"><i class="fa fa-check"></i><b>3.3.6</b> Using Small Multiple</a></li>
<li class="chapter" data-level="3.3.7" data-path="distributions.html"><a href="distributions.html#base-r"><i class="fa fa-check"></i><b>3.3.7</b> Base R</a></li>
<li class="chapter" data-level="3.3.8" data-path="distributions.html"><a href="distributions.html#two-histograms-with-melt-colors"><i class="fa fa-check"></i><b>3.3.8</b> Two Histograms with Melt Colors</a></li>
<li class="chapter" data-level="3.3.9" data-path="distributions.html"><a href="distributions.html#boxplot-on-top-of-histogram"><i class="fa fa-check"></i><b>3.3.9</b> Boxplot on top of Histogram</a></li>
<li class="chapter" data-level="3.3.10" data-path="distributions.html"><a href="distributions.html#histogram-with-colored-tail"><i class="fa fa-check"></i><b>3.3.10</b> Histogram with Colored Tail</a></li>
<li class="chapter" data-level="3.3.11" data-path="distributions.html"><a href="distributions.html#mirrored-histogram-in-base-r"><i class="fa fa-check"></i><b>3.3.11</b> Mirrored Histogram in Base R</a></li>
<li class="chapter" data-level="3.3.12" data-path="distributions.html"><a href="distributions.html#histogram-without-border"><i class="fa fa-check"></i><b>3.3.12</b> Histogram without Border</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="distributions.html"><a href="distributions.html#boxplot"><i class="fa fa-check"></i><b>3.4</b> Boxplot</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="distributions.html"><a href="distributions.html#ggplot2-1"><i class="fa fa-check"></i><b>3.4.1</b> Ggplot2</a></li>
<li class="chapter" data-level="3.4.2" data-path="distributions.html"><a href="distributions.html#ggplot2-boxplot-parameters"><i class="fa fa-check"></i><b>3.4.2</b> Ggplot2 Boxplot Parameters</a></li>
<li class="chapter" data-level="3.4.3" data-path="distributions.html"><a href="distributions.html#control-ggplot2-boxplot-colors"><i class="fa fa-check"></i><b>3.4.3</b> Control ggplot2 Boxplot Colors</a></li>
<li class="chapter" data-level="3.4.4" data-path="distributions.html"><a href="distributions.html#highlighting-a-group"><i class="fa fa-check"></i><b>3.4.4</b> Highlighting a Group</a></li>
<li class="chapter" data-level="3.4.5" data-path="distributions.html"><a href="distributions.html#grouped-boxplot"><i class="fa fa-check"></i><b>3.4.5</b> Grouped Boxplot</a></li>
<li class="chapter" data-level="3.4.6" data-path="distributions.html"><a href="distributions.html#using-small-multiple-1"><i class="fa fa-check"></i><b>3.4.6</b> Using Small Multiple</a></li>
<li class="chapter" data-level="3.4.7" data-path="distributions.html"><a href="distributions.html#ggplot2-boxplot-with-variable-width"><i class="fa fa-check"></i><b>3.4.7</b> Ggplot2 Boxplot with Variable Width</a></li>
<li class="chapter" data-level="3.4.8" data-path="distributions.html"><a href="distributions.html#ggplot2-boxplot-from-continuous-variable"><i class="fa fa-check"></i><b>3.4.8</b> Ggplot2 Boxplot from Continuous Variable</a></li>
<li class="chapter" data-level="3.4.9" data-path="distributions.html"><a href="distributions.html#ggplot2-boxplot-with-mean-value"><i class="fa fa-check"></i><b>3.4.9</b> Ggplot2 Boxplot with Mean Value</a></li>
<li class="chapter" data-level="3.4.10" data-path="distributions.html"><a href="distributions.html#basic-r"><i class="fa fa-check"></i><b>3.4.10</b> Basic R</a></li>
<li class="chapter" data-level="3.4.11" data-path="distributions.html"><a href="distributions.html#basic-r-x-axis-labels-on-several-lines"><i class="fa fa-check"></i><b>3.4.11</b> Basic R: X Axis Labels on Several Lines</a></li>
<li class="chapter" data-level="3.4.12" data-path="distributions.html"><a href="distributions.html#boxplot-with-jitter-in-base-r"><i class="fa fa-check"></i><b>3.4.12</b> Boxplot with Jitter in Base R</a></li>
<li class="chapter" data-level="3.4.13" data-path="distributions.html"><a href="distributions.html#ordering-boxplots-in-base-r"><i class="fa fa-check"></i><b>3.4.13</b> Ordering Boxplots in Base R</a></li>
<li class="chapter" data-level="3.4.14" data-path="distributions.html"><a href="distributions.html#give-a-specific-order"><i class="fa fa-check"></i><b>3.4.14</b> Give a Specific Order</a></li>
<li class="chapter" data-level="3.4.15" data-path="distributions.html"><a href="distributions.html#grouped-and-ordered-boxplot"><i class="fa fa-check"></i><b>3.4.15</b> Grouped and Ordered Boxplot</a></li>
<li class="chapter" data-level="3.4.16" data-path="distributions.html"><a href="distributions.html#add-text-over-boxplot-in-base-r"><i class="fa fa-check"></i><b>3.4.16</b> Add Text over Boxplot in Base R</a></li>
<li class="chapter" data-level="3.4.17" data-path="distributions.html"><a href="distributions.html#tukey-test-and-boxplot-in-r"><i class="fa fa-check"></i><b>3.4.17</b> Tukey Test and Boxplot in R</a></li>
<li class="chapter" data-level="3.4.18" data-path="distributions.html"><a href="distributions.html#tukey-test-result-on-top-of-boxplot"><i class="fa fa-check"></i><b>3.4.18</b> Tukey test result on top of boxplot</a></li>
<li class="chapter" data-level="3.4.19" data-path="distributions.html"><a href="distributions.html#control-box-type-with-the-bty-option"><i class="fa fa-check"></i><b>3.4.19</b> Control Box Type with the bty Option</a></li>
<li class="chapter" data-level="3.4.20" data-path="distributions.html"><a href="distributions.html#split-base-r-plot-window-with-layout"><i class="fa fa-check"></i><b>3.4.20</b> Split Base R Plot Window with <code>layout()</code></a></li>
<li class="chapter" data-level="3.4.21" data-path="distributions.html"><a href="distributions.html#subdivide-second-row"><i class="fa fa-check"></i><b>3.4.21</b> Subdivide Second Row</a></li>
<li class="chapter" data-level="3.4.22" data-path="distributions.html"><a href="distributions.html#custom-proportions"><i class="fa fa-check"></i><b>3.4.22</b> Custom Proportions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="distributions.html"><a href="distributions.html#ridgeline-chart"><i class="fa fa-check"></i><b>3.5</b> Ridgeline Chart</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="distributions.html"><a href="distributions.html#basic-ridgeline-plot"><i class="fa fa-check"></i><b>3.5.1</b> Basic Ridgeline Plot</a></li>
<li class="chapter" data-level="3.5.2" data-path="distributions.html"><a href="distributions.html#shape-variation"><i class="fa fa-check"></i><b>3.5.2</b> Shape Variation</a></li>
<li class="chapter" data-level="3.5.3" data-path="distributions.html"><a href="distributions.html#color-relative-to-numeric-value"><i class="fa fa-check"></i><b>3.5.3</b> Color Relative to Numeric Value</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>4</b> Correlation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="correlation.html"><a href="correlation.html#scatterplot"><i class="fa fa-check"></i><b>4.1</b> Scatterplot</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="correlation.html"><a href="correlation.html#custom-ggplot2-scatterplot"><i class="fa fa-check"></i><b>4.1.1</b> Custom <code>ggplot2</code> Scatterplot</a></li>
<li class="chapter" data-level="4.1.2" data-path="correlation.html"><a href="correlation.html#using-theme_ipsum"><i class="fa fa-check"></i><b>4.1.2</b> Using <code>theme_ipsum</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="correlation.html"><a href="correlation.html#map-a-variable-to-marker-feature-in-ggplot2-scatterplot"><i class="fa fa-check"></i><b>4.1.3</b> Map a Variable to Marker Feature in <code>ggplot2</code> Scatterplot</a></li>
<li class="chapter" data-level="4.1.4" data-path="correlation.html"><a href="correlation.html#works-with-any-aesthetics"><i class="fa fa-check"></i><b>4.1.4</b> Works with any Aesthetics</a></li>
<li class="chapter" data-level="4.1.5" data-path="correlation.html"><a href="correlation.html#mapping-to-several-features"><i class="fa fa-check"></i><b>4.1.5</b> Mapping to Several Features</a></li>
<li class="chapter" data-level="4.1.6" data-path="correlation.html"><a href="correlation.html#add-text-labels-with-ggplot2"><i class="fa fa-check"></i><b>4.1.6</b> Add Text Labels with <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.1.7" data-path="correlation.html"><a href="correlation.html#add-labels-with-geom_label"><i class="fa fa-check"></i><b>4.1.7</b> Add Labels with <code>geom_label()</code></a></li>
<li class="chapter" data-level="4.1.8" data-path="correlation.html"><a href="correlation.html#add-one-text-label-only"><i class="fa fa-check"></i><b>4.1.8</b> Add One Text Label Only</a></li>
<li class="chapter" data-level="4.1.9" data-path="correlation.html"><a href="correlation.html#add-labels-for-a-selection-of-marker"><i class="fa fa-check"></i><b>4.1.9</b> Add Labels for a Selection of Marker</a></li>
<li class="chapter" data-level="4.1.10" data-path="correlation.html"><a href="correlation.html#ggplot2-scatterplot-with-rug"><i class="fa fa-check"></i><b>4.1.10</b> Ggplot2 Scatterplot with Rug</a></li>
<li class="chapter" data-level="4.1.11" data-path="distributions.html"><a href="distributions.html#marginal-distribution-with-ggplot2-and-ggextra"><i class="fa fa-check"></i><b>4.1.11</b> Marginal Distribution with <code>ggplot2</code> and <code>ggExtra</code></a></li>
<li class="chapter" data-level="4.1.12" data-path="distributions.html"><a href="distributions.html#more-customization"><i class="fa fa-check"></i><b>4.1.12</b> More Customization</a></li>
<li class="chapter" data-level="4.1.13" data-path="correlation.html"><a href="correlation.html#linear-model-and-confidence-interval-in-ggplot2"><i class="fa fa-check"></i><b>4.1.13</b> Linear Model and Confidence Interval in <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.1.14" data-path="correlation.html"><a href="correlation.html#using-base-r"><i class="fa fa-check"></i><b>4.1.14</b> Using Base R</a></li>
<li class="chapter" data-level="4.1.15" data-path="correlation.html"><a href="correlation.html#map-the-marker-color-to-a-categorical-variable"><i class="fa fa-check"></i><b>4.1.15</b> Map the Marker Color to a Categorical Variable</a></li>
<li class="chapter" data-level="4.1.16" data-path="correlation.html"><a href="correlation.html#map-the-marker-color-to-a-numeric-variable"><i class="fa fa-check"></i><b>4.1.16</b> Map the Marker Color to a Numeric Variable</a></li>
<li class="chapter" data-level="4.1.17" data-path="correlation.html"><a href="correlation.html#scatterplot-with-polynomial-curve-fitting"><i class="fa fa-check"></i><b>4.1.17</b> Scatterplot with Polynomial Curve Fitting</a></li>
<li class="chapter" data-level="4.1.18" data-path="correlation.html"><a href="correlation.html#polynomial-curve-fitting-and-confidence-interval"><i class="fa fa-check"></i><b>4.1.18</b> Polynomial Curve Fitting and Confidence Interval</a></li>
<li class="chapter" data-level="4.1.19" data-path="correlation.html"><a href="correlation.html#lattice-xy-plot-function"><i class="fa fa-check"></i><b>4.1.19</b> Lattice XY Plot Function</a></li>
<li class="chapter" data-level="4.1.20" data-path="correlation.html"><a href="correlation.html#correlation-between-discrete-variable"><i class="fa fa-check"></i><b>4.1.20</b> Correlation between Discrete Variable</a></li>
<li class="chapter" data-level="4.1.21" data-path="correlation.html"><a href="correlation.html#use-mtext-to-write-text-in-margin"><i class="fa fa-check"></i><b>4.1.21</b> Use <code>mtext()</code> to Write Text in Margin</a></li>
<li class="chapter" data-level="4.1.22" data-path="correlation.html"><a href="correlation.html#customizations-1"><i class="fa fa-check"></i><b>4.1.22</b> Customizations</a></li>
<li class="chapter" data-level="4.1.23" data-path="correlation.html"><a href="correlation.html#the-split_screen-function-of-r"><i class="fa fa-check"></i><b>4.1.23</b> The <code>split_screen()</code> Function of R</a></li>
<li class="chapter" data-level="4.1.24" data-path="correlation.html"><a href="correlation.html#use-par-mfrow-to-split-screen"><i class="fa fa-check"></i><b>4.1.24</b> Use par mfrow to Split Screen</a></li>
<li class="chapter" data-level="4.1.25" data-path="correlation.html"><a href="correlation.html#base-r-graph-parameters-a-cheatsheet."><i class="fa fa-check"></i><b>4.1.25</b> Base R Graph Parameters: A Cheatsheet.</a></li>
<li class="chapter" data-level="4.1.26" data-path="correlation.html"><a href="correlation.html#special-use-case-manhattan-plots"><i class="fa fa-check"></i><b>4.1.26</b> Special Use Case: Manhattan Plots</a></li>
<li class="chapter" data-level="4.1.27" data-path="correlation.html"><a href="correlation.html#highly-customizable-with-ggplot2"><i class="fa fa-check"></i><b>4.1.27</b> Highly Customizable with <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.1.28" data-path="correlation.html"><a href="correlation.html#switch-to-an-interactive-version-with-plotly"><i class="fa fa-check"></i><b>4.1.28</b> Switch to an Interactive Version with <code>plotly</code></a></li>
<li class="chapter" data-level="4.1.29" data-path="correlation.html"><a href="correlation.html#circular-version-with-cmplot"><i class="fa fa-check"></i><b>4.1.29</b> Circular Version with CMplot</a></li>
<li class="chapter" data-level="4.1.30" data-path="correlation.html"><a href="correlation.html#snp-density-plot"><i class="fa fa-check"></i><b>4.1.30</b> SNP-Density Plot</a></li>
<li class="chapter" data-level="4.1.31" data-path="correlation.html"><a href="correlation.html#circular-manhattan-plot"><i class="fa fa-check"></i><b>4.1.31</b> Circular-Manhattan Plot</a></li>
<li class="chapter" data-level="4.1.32" data-path="correlation.html"><a href="correlation.html#single_track-rectangular-manhattan-plot"><i class="fa fa-check"></i><b>4.1.32</b> Single_track Rectangular-Manhattan Plot</a></li>
<li class="chapter" data-level="4.1.33" data-path="correlation.html"><a href="correlation.html#multi_tracks-rectangular-manhattan-plot"><i class="fa fa-check"></i><b>4.1.33</b> Multi_tracks Rectangular-Manhattan Plot</a></li>
<li class="chapter" data-level="4.1.34" data-path="correlation.html"><a href="correlation.html#single_track-q-q-plot"><i class="fa fa-check"></i><b>4.1.34</b> Single_track Q-Q Plot</a></li>
<li class="chapter" data-level="4.1.35" data-path="correlation.html"><a href="correlation.html#multi_tracks-q-q-plot"><i class="fa fa-check"></i><b>4.1.35</b> Multi_tracks Q-Q plot</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="correlation.html"><a href="correlation.html#heatmap"><i class="fa fa-check"></i><b>4.2</b> Heatmap</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="correlation.html"><a href="correlation.html#normalization"><i class="fa fa-check"></i><b>4.2.1</b> Normalization</a></li>
<li class="chapter" data-level="4.2.2" data-path="correlation.html"><a href="correlation.html#dendrogram-and-reordering"><i class="fa fa-check"></i><b>4.2.2</b> Dendrogram and Reordering</a></li>
<li class="chapter" data-level="4.2.3" data-path="correlation.html"><a href="correlation.html#color-palette"><i class="fa fa-check"></i><b>4.2.3</b> Color Palette</a></li>
<li class="chapter" data-level="4.2.4" data-path="correlation.html"><a href="correlation.html#custom-layout"><i class="fa fa-check"></i><b>4.2.4</b> Custom Layout</a></li>
<li class="chapter" data-level="4.2.5" data-path="correlation.html"><a href="correlation.html#add-color-beside-heatmap"><i class="fa fa-check"></i><b>4.2.5</b> Add Color beside Heatmap</a></li>
<li class="chapter" data-level="4.2.6" data-path="correlation.html"><a href="correlation.html#using-geom_title-from-ggplot2"><i class="fa fa-check"></i><b>4.2.6</b> Using <code>geom_title()</code> from <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.2.7" data-path="correlation.html"><a href="correlation.html#ggplot2-heatmap"><i class="fa fa-check"></i><b>4.2.7</b> <code>ggplot2</code> Heatmap</a></li>
<li class="chapter" data-level="4.2.8" data-path="correlation.html"><a href="correlation.html#control-color-palette"><i class="fa fa-check"></i><b>4.2.8</b> Control Color Palette</a></li>
<li class="chapter" data-level="4.2.9" data-path="correlation.html"><a href="correlation.html#from-wide-input-format"><i class="fa fa-check"></i><b>4.2.9</b> From Wide Input Format</a></li>
<li class="chapter" data-level="4.2.10" data-path="correlation.html"><a href="correlation.html#turn-it-interactive-with-plotly"><i class="fa fa-check"></i><b>4.2.10</b> Turn it Interactive with <code>plotly</code></a></li>
<li class="chapter" data-level="4.2.11" data-path="correlation.html"><a href="correlation.html#interactive-heatmaps-from-r"><i class="fa fa-check"></i><b>4.2.11</b> Interactive Heatmaps from R</a></li>
<li class="chapter" data-level="4.2.12" data-path="correlation.html"><a href="correlation.html#heatmap-for-time-series"><i class="fa fa-check"></i><b>4.2.12</b> Heatmap for Time Series</a></li>
<li class="chapter" data-level="4.2.13" data-path="correlation.html"><a href="correlation.html#the-hourly-heatmap"><i class="fa fa-check"></i><b>4.2.13</b> The Hourly Heatmap</a></li>
<li class="chapter" data-level="4.2.14" data-path="correlation.html"><a href="correlation.html#using-the-levelplot-function-of-lattice"><i class="fa fa-check"></i><b>4.2.14</b> Using the <code>levelplot()</code> Function of <code>Lattice</code></a></li>
<li class="chapter" data-level="4.2.15" data-path="correlation.html"><a href="correlation.html#from-wide-input-matrix"><i class="fa fa-check"></i><b>4.2.15</b> From Wide Input Matrix</a></li>
<li class="chapter" data-level="4.2.16" data-path="correlation.html"><a href="correlation.html#flip-and-reorder-axis"><i class="fa fa-check"></i><b>4.2.16</b> Flip and Reorder Axis</a></li>
<li class="chapter" data-level="4.2.17" data-path="correlation.html"><a href="correlation.html#custom-colors"><i class="fa fa-check"></i><b>4.2.17</b> Custom Colors</a></li>
<li class="chapter" data-level="4.2.18" data-path="correlation.html"><a href="correlation.html#heatmap-with-smoothing---latticeextra"><i class="fa fa-check"></i><b>4.2.18</b> Heatmap with Smoothing - LatticeExtra</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="correlation.html"><a href="correlation.html#correlogram"><i class="fa fa-check"></i><b>4.3</b> Correlogram</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="correlation.html"><a href="correlation.html#visualize-correlation-with-ggcorr"><i class="fa fa-check"></i><b>4.3.1</b> Visualize Correlation with <code>ggcorr()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="correlation.html"><a href="correlation.html#change-plot-types"><i class="fa fa-check"></i><b>4.3.2</b> Change Plot Types</a></li>
<li class="chapter" data-level="4.3.3" data-path="correlation.html"><a href="correlation.html#split-by-group"><i class="fa fa-check"></i><b>4.3.3</b> Split by Group</a></li>
<li class="chapter" data-level="4.3.4" data-path="correlation.html"><a href="correlation.html#using-the-corrgram-package"><i class="fa fa-check"></i><b>4.3.4</b> Using the <code>corrgram</code> Package</a></li>
<li class="chapter" data-level="4.3.5" data-path="correlation.html"><a href="correlation.html#visualize-correlation-with-ggcorr-1"><i class="fa fa-check"></i><b>4.3.5</b> Visualize Correlation with <code>ggcorr()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="correlation.html"><a href="correlation.html#split-by-group-1"><i class="fa fa-check"></i><b>4.3.6</b> Split by Group</a></li>
<li class="chapter" data-level="4.3.7" data-path="correlation.html"><a href="correlation.html#change-plot-types-1"><i class="fa fa-check"></i><b>4.3.7</b> Change plot types</a></li>
<li class="chapter" data-level="4.3.8" data-path="correlation.html"><a href="correlation.html#other-methods"><i class="fa fa-check"></i><b>4.3.8</b> Other Methods</a></li>
<li class="chapter" data-level="4.3.9" data-path="correlation.html"><a href="correlation.html#basic-scatterplot-matrix"><i class="fa fa-check"></i><b>4.3.9</b> Basic Scatterplot Matrix</a></li>
<li class="chapter" data-level="4.3.10" data-path="correlation.html"><a href="correlation.html#correlogram-with-the-car-package"><i class="fa fa-check"></i><b>4.3.10</b> Correlogram with the <code>car</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="correlation.html"><a href="correlation.html#bubble-plot"><i class="fa fa-check"></i><b>4.4</b> Bubble Plot</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="correlation.html"><a href="correlation.html#most-basic-bubble-chart-with-geom_point"><i class="fa fa-check"></i><b>4.4.1</b> Most Basic bubble Chart with <code>geom_point()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="correlation.html"><a href="correlation.html#control-circle-size-with-scale_size"><i class="fa fa-check"></i><b>4.4.2</b> Control Circle Size with <code>scale_size()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="correlation.html"><a href="correlation.html#add-a-fourth-dimension-color"><i class="fa fa-check"></i><b>4.4.3</b> Add a Fourth Dimension: Color</a></li>
<li class="chapter" data-level="4.4.4" data-path="correlation.html"><a href="correlation.html#make-it-pretty"><i class="fa fa-check"></i><b>4.4.4</b> Make it Pretty</a></li>
<li class="chapter" data-level="4.4.5" data-path="correlation.html"><a href="correlation.html#interactive-version"><i class="fa fa-check"></i><b>4.4.5</b> Interactive Version</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="correlation.html"><a href="correlation.html#connected-scatterplot"><i class="fa fa-check"></i><b>4.5</b> Connected Scatterplot</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-with-r-and-ggplot2"><i class="fa fa-check"></i><b>4.5.1</b> Connected Scatterplot with R and Ggplot2</a></li>
<li class="chapter" data-level="4.5.2" data-path="correlation.html"><a href="correlation.html#customize-the-connected-scatterplot"><i class="fa fa-check"></i><b>4.5.2</b> Customize the Connected Scatterplot</a></li>
<li class="chapter" data-level="4.5.3" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-to-show-an-evolution"><i class="fa fa-check"></i><b>4.5.3</b> Connected Scatterplot to show an Evolution</a></li>
<li class="chapter" data-level="4.5.4" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-for-time-series"><i class="fa fa-check"></i><b>4.5.4</b> Connected Scatterplot for <code>Time Series</code></a></li>
<li class="chapter" data-level="4.5.5" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-using-base-r"><i class="fa fa-check"></i><b>4.5.5</b> Connected Scatterplot using Base R</a></li>
<li class="chapter" data-level="4.5.6" data-path="correlation.html"><a href="correlation.html#manage-dates-data-with-base-r"><i class="fa fa-check"></i><b>4.5.6</b> Manage Dates Data with Base R</a></li>
<li class="chapter" data-level="4.5.7" data-path="correlation.html"><a href="correlation.html#switch-to-date-format"><i class="fa fa-check"></i><b>4.5.7</b> Switch to Date Format</a></li>
<li class="chapter" data-level="4.5.8" data-path="correlation.html"><a href="correlation.html#base-r-graph-parameters-cheatsheet"><i class="fa fa-check"></i><b>4.5.8</b> Base R Graph Parameters: Cheatsheet</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="correlation.html"><a href="correlation.html#density-2d"><i class="fa fa-check"></i><b>4.6</b> Density 2D</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="correlation.html"><a href="correlation.html#the-issue-with-geom_point"><i class="fa fa-check"></i><b>4.6.1</b> The Issue with <code>geom_point()</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="correlation.html"><a href="correlation.html#d-histogram-with-geom_bin2d-1"><i class="fa fa-check"></i><b>4.6.2</b> 2d Histogram with <code>geom_bin2d()</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="correlation.html"><a href="correlation.html#hexbin-chart-with-geom_hex"><i class="fa fa-check"></i><b>4.6.3</b> Hexbin Chart with <code>geom_hex()</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="correlation.html"><a href="correlation.html#d-distribution-with-geom_density_2d-or-stat_density_2d"><i class="fa fa-check"></i><b>4.6.4</b> 2d Distribution with <code>geom_density_2d</code> or <code>stat_density_2d</code></a></li>
<li class="chapter" data-level="4.6.5" data-path="correlation.html"><a href="correlation.html#customize-the-color-palette"><i class="fa fa-check"></i><b>4.6.5</b> Customize the Color Palette</a></li>
<li class="chapter" data-level="4.6.6" data-path="correlation.html"><a href="correlation.html#hexbin-chart-with-the-hexbin-package"><i class="fa fa-check"></i><b>4.6.6</b> Hexbin Chart with the Hexbin Package</a></li>
<li class="chapter" data-level="4.6.7" data-path="correlation.html"><a href="correlation.html#hexbin-chart-and-scatterplot-with-ggplot2"><i class="fa fa-check"></i><b>4.6.7</b> Hexbin Chart and Scatterplot with Ggplot2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ranking.html"><a href="ranking.html"><i class="fa fa-check"></i><b>5</b> Ranking</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ranking.html"><a href="ranking.html#barplot"><i class="fa fa-check"></i><b>5.1</b> Barplot</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="ranking.html"><a href="ranking.html#basic-barplot-with-ggplot2"><i class="fa fa-check"></i><b>5.1.1</b> Basic Barplot with Ggplot2</a></li>
<li class="chapter" data-level="5.1.2" data-path="ranking.html"><a href="ranking.html#control-bar-color"><i class="fa fa-check"></i><b>5.1.2</b> Control Bar Color</a></li>
<li class="chapter" data-level="5.1.3" data-path="ranking.html"><a href="ranking.html#horizontal-barplot-with-coord_flip"><i class="fa fa-check"></i><b>5.1.3</b> Horizontal Barplot with <code>coord_flip()</code></a></li>
<li class="chapter" data-level="5.1.4" data-path="ranking.html"><a href="ranking.html#control-bar-width-with-width"><i class="fa fa-check"></i><b>5.1.4</b> Control Bar Width with <code>width</code></a></li>
<li class="chapter" data-level="5.1.5" data-path="distributions.html"><a href="distributions.html#reorder-a-variable-with-ggplot2"><i class="fa fa-check"></i><b>5.1.5</b> Reorder a Variable with Ggplot2</a></li>
<li class="chapter" data-level="5.1.6" data-path="ranking.html"><a href="ranking.html#method-1-the-forecats-library"><i class="fa fa-check"></i><b>5.1.6</b> Method 1: the <code>Forecats</code> Library</a></li>
<li class="chapter" data-level="5.1.7" data-path="distributions.html"><a href="distributions.html#method-2-using-dplyr-only"><i class="fa fa-check"></i><b>5.1.7</b> Method 2: Using <code>dplyr</code> Only</a></li>
<li class="chapter" data-level="5.1.8" data-path="distributions.html"><a href="distributions.html#method-3-the-reorder-function-of-base-r"><i class="fa fa-check"></i><b>5.1.8</b> Method 3: the <code>reorder()</code> Function of Base R</a></li>
<li class="chapter" data-level="5.1.9" data-path="ranking.html"><a href="ranking.html#barplot-with-variable-width---ggplot2"><i class="fa fa-check"></i><b>5.1.9</b> Barplot with Variable Width - Ggplot2</a></li>
<li class="chapter" data-level="5.1.10" data-path="ranking.html"><a href="ranking.html#barplot-with-error-bars"><i class="fa fa-check"></i><b>5.1.10</b> Barplot with Error Bars</a></li>
<li class="chapter" data-level="5.1.11" data-path="ranking.html"><a href="ranking.html#customization"><i class="fa fa-check"></i><b>5.1.11</b> Customization</a></li>
<li class="chapter" data-level="5.1.12" data-path="ranking.html"><a href="ranking.html#basic-r-and-the-barplot-function"><i class="fa fa-check"></i><b>5.1.12</b> Basic R and the <code>barplot()</code> Function</a></li>
<li class="chapter" data-level="5.1.13" data-path="ranking.html"><a href="ranking.html#custom-color"><i class="fa fa-check"></i><b>5.1.13</b> Custom Color</a></li>
<li class="chapter" data-level="5.1.14" data-path="ranking.html"><a href="ranking.html#title-axis-label-custom-limits"><i class="fa fa-check"></i><b>5.1.14</b> Title, Axis label, Custom Limits</a></li>
<li class="chapter" data-level="5.1.15" data-path="ranking.html"><a href="ranking.html#horizontal-barplot"><i class="fa fa-check"></i><b>5.1.15</b> Horizontal Barplot</a></li>
<li class="chapter" data-level="5.1.16" data-path="ranking.html"><a href="ranking.html#bar-width-space-between-bars"><i class="fa fa-check"></i><b>5.1.16</b> Bar Width &amp; Space between Bars</a></li>
<li class="chapter" data-level="5.1.17" data-path="ranking.html"><a href="ranking.html#barplot-texture"><i class="fa fa-check"></i><b>5.1.17</b> Barplot Texture</a></li>
<li class="chapter" data-level="5.1.18" data-path="ranking.html"><a href="ranking.html#advanced-r-barplot-customization"><i class="fa fa-check"></i><b>5.1.18</b> Advanced R Barplot Customization</a></li>
<li class="chapter" data-level="5.1.19" data-path="ranking.html"><a href="ranking.html#axis-labels-orientation-with-las"><i class="fa fa-check"></i><b>5.1.19</b> Axis Labels Orientation with <code>las()</code></a></li>
<li class="chapter" data-level="5.1.20" data-path="ranking.html"><a href="ranking.html#change-group-labels-with-names.arg"><i class="fa fa-check"></i><b>5.1.20</b> Change Group Labels with <strong>names.arg</strong></a></li>
<li class="chapter" data-level="5.1.21" data-path="ranking.html"><a href="ranking.html#axis-labels-axis-title-style"><i class="fa fa-check"></i><b>5.1.21</b> Axis Labels &amp; Axis Title Style</a></li>
<li class="chapter" data-level="5.1.22" data-path="ranking.html"><a href="ranking.html#increase-margin-size"><i class="fa fa-check"></i><b>5.1.22</b> Increase Margin Size</a></li>
<li class="chapter" data-level="5.1.23" data-path="ranking.html"><a href="ranking.html#barplot-with-error-bars-1"><i class="fa fa-check"></i><b>5.1.23</b> Barplot with Error Bars</a></li>
<li class="chapter" data-level="5.1.24" data-path="ranking.html"><a href="ranking.html#customization-1"><i class="fa fa-check"></i><b>5.1.24</b> Customization</a></li>
<li class="chapter" data-level="5.1.25" data-path="ranking.html"><a href="ranking.html#standard-deviation-standard-error-or-confidence-interval"><i class="fa fa-check"></i><b>5.1.25</b> Standard Deviation, Standard Error or Confidence Interval?</a></li>
<li class="chapter" data-level="5.1.26" data-path="ranking.html"><a href="ranking.html#basic-r-use-the-arrows-function"><i class="fa fa-check"></i><b>5.1.26</b> Basic R: Use the <code>arrows()</code> Function</a></li>
<li class="chapter" data-level="5.1.27" data-path="ranking.html"><a href="ranking.html#barplot-with-number-of-observation"><i class="fa fa-check"></i><b>5.1.27</b> Barplot with Number of Observation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ranking.html"><a href="ranking.html#radar-chart"><i class="fa fa-check"></i><b>5.2</b> Radar Chart</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="ranking.html"><a href="ranking.html#one-group-only---fmsb-library"><i class="fa fa-check"></i><b>5.2.1</b> One Group Only - <code>FMSB</code> Library</a></li>
<li class="chapter" data-level="5.2.2" data-path="ranking.html"><a href="ranking.html#customization-2"><i class="fa fa-check"></i><b>5.2.2</b> Customization</a></li>
<li class="chapter" data-level="5.2.3" data-path="ranking.html"><a href="ranking.html#several-groups"><i class="fa fa-check"></i><b>5.2.3</b> Several Groups</a></li>
<li class="chapter" data-level="5.2.4" data-path="ranking.html"><a href="ranking.html#customization-3"><i class="fa fa-check"></i><b>5.2.4</b> Customization</a></li>
<li class="chapter" data-level="5.2.5" data-path="ranking.html"><a href="ranking.html#about-axis-limits"><i class="fa fa-check"></i><b>5.2.5</b> About Axis Limits</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ranking.html"><a href="ranking.html#wordcloud"><i class="fa fa-check"></i><b>5.3</b> Wordcloud</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="ranking.html"><a href="ranking.html#wordcloud2"><i class="fa fa-check"></i><b>5.3.1</b> <code>wordcloud2</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="ranking.html"><a href="ranking.html#the-wordcloud2-library"><i class="fa fa-check"></i><b>5.3.2</b> The <strong>Wordcloud2</strong> Library</a></li>
<li class="chapter" data-level="5.3.3" data-path="ranking.html"><a href="ranking.html#color-background-color"><i class="fa fa-check"></i><b>5.3.3</b> Color &amp; Background Color</a></li>
<li class="chapter" data-level="5.3.4" data-path="ranking.html"><a href="ranking.html#shape"><i class="fa fa-check"></i><b>5.3.4</b> Shape</a></li>
<li class="chapter" data-level="5.3.5" data-path="ranking.html"><a href="ranking.html#word-orientation"><i class="fa fa-check"></i><b>5.3.5</b> Word Orientation</a></li>
<li class="chapter" data-level="5.3.6" data-path="ranking.html"><a href="ranking.html#chinese-version"><i class="fa fa-check"></i><b>5.3.6</b> Chinese Version</a></li>
<li class="chapter" data-level="5.3.7" data-path="ranking.html"><a href="ranking.html#use-letter-or-text-as-shape"><i class="fa fa-check"></i><b>5.3.7</b> Use Letter or Text as Shape</a></li>
<li class="chapter" data-level="5.3.8" data-path="ranking.html"><a href="ranking.html#export-the-wordcloud"><i class="fa fa-check"></i><b>5.3.8</b> Export the Wordcloud</a></li>
<li class="chapter" data-level="5.3.9" data-path="ranking.html"><a href="ranking.html#basic-wordcloud-in-r"><i class="fa fa-check"></i><b>5.3.9</b> Basic <code>wordcloud</code> in R</a></li>
<li class="chapter" data-level="5.3.10" data-path="ranking.html"><a href="ranking.html#text-mining-and-wordcloud-with-r"><i class="fa fa-check"></i><b>5.3.10</b> Text mining and <code>wordcloud</code> with R</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ranking.html"><a href="ranking.html#parallel-coordinates-chart"><i class="fa fa-check"></i><b>5.4</b> Parallel Coordinates Chart</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="ranking.html"><a href="ranking.html#parallel-coordinates-chart-with-ggally"><i class="fa fa-check"></i><b>5.4.1</b> Parallel Coordinates Chart with ggally</a></li>
<li class="chapter" data-level="5.4.2" data-path="ranking.html"><a href="ranking.html#custom-color-theme-general-appearance"><i class="fa fa-check"></i><b>5.4.2</b> Custom Color, Theme, General Appearance</a></li>
<li class="chapter" data-level="5.4.3" data-path="ranking.html"><a href="ranking.html#scaling"><i class="fa fa-check"></i><b>5.4.3</b> Scaling</a></li>
<li class="chapter" data-level="5.4.4" data-path="ranking.html"><a href="ranking.html#highlight-a-group"><i class="fa fa-check"></i><b>5.4.4</b> Highlight a Group</a></li>
<li class="chapter" data-level="5.4.5" data-path="ranking.html"><a href="ranking.html#parallel-chart-with-the-mass-library"><i class="fa fa-check"></i><b>5.4.5</b> Parallel Chart with the <code>MASS</code> Library</a></li>
<li class="chapter" data-level="5.4.6" data-path="ranking.html"><a href="ranking.html#reorder-variables"><i class="fa fa-check"></i><b>5.4.6</b> Reorder Variables</a></li>
<li class="chapter" data-level="5.4.7" data-path="ranking.html"><a href="ranking.html#highlight-a-group-1"><i class="fa fa-check"></i><b>5.4.7</b> Highlight a Group</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="ranking.html"><a href="ranking.html#lollipop-plot"><i class="fa fa-check"></i><b>5.5</b> Lollipop Plot</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="ranking.html"><a href="ranking.html#most-basic-lollipop-plot"><i class="fa fa-check"></i><b>5.5.1</b> Most Basic Lollipop Plot</a></li>
<li class="chapter" data-level="5.5.2" data-path="ranking.html"><a href="ranking.html#from-1-numeric-and-1-categorical-variable"><i class="fa fa-check"></i><b>5.5.2</b> From 1 Numeric and 1 Categorical Variable</a></li>
<li class="chapter" data-level="5.5.3" data-path="ranking.html"><a href="ranking.html#custom-lollipop-chart"><i class="fa fa-check"></i><b>5.5.3</b> Custom Lollipop Chart</a></li>
<li class="chapter" data-level="5.5.4" data-path="ranking.html"><a href="ranking.html#stem"><i class="fa fa-check"></i><b>5.5.4</b> Stem</a></li>
<li class="chapter" data-level="5.5.5" data-path="ranking.html"><a href="ranking.html#general-appearance-with-theme"><i class="fa fa-check"></i><b>5.5.5</b> General Appearance with <code>theme()</code></a></li>
<li class="chapter" data-level="5.5.6" data-path="ranking.html"><a href="ranking.html#horizontal-version"><i class="fa fa-check"></i><b>5.5.6</b> Horizontal Version</a></li>
<li class="chapter" data-level="5.5.7" data-path="ranking.html"><a href="ranking.html#baseline"><i class="fa fa-check"></i><b>5.5.7</b> Baseline</a></li>
<li class="chapter" data-level="5.5.8" data-path="ranking.html"><a href="ranking.html#lollipop-chart-with-2-groups"><i class="fa fa-check"></i><b>5.5.8</b> Lollipop Chart with 2 Groups</a></li>
<li class="chapter" data-level="5.5.9" data-path="ranking.html"><a href="ranking.html#highlight-a-group-in-a-lollipop-chart"><i class="fa fa-check"></i><b>5.5.9</b> Highlight a Group in a Lollipop Chart</a></li>
<li class="chapter" data-level="5.5.10" data-path="ranking.html"><a href="ranking.html#lollipop-chart-with-conditional-color"><i class="fa fa-check"></i><b>5.5.10</b> Lollipop Chart with Conditional Color</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ranking.html"><a href="ranking.html#circular-barplot"><i class="fa fa-check"></i><b>5.6</b> Circular Barplot</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="ranking.html"><a href="ranking.html#most-basic-circular-barplot"><i class="fa fa-check"></i><b>5.6.1</b> Most Basic Circular Barplot</a></li>
<li class="chapter" data-level="5.6.2" data-path="ranking.html"><a href="ranking.html#add-labels-to-circular-barplot"><i class="fa fa-check"></i><b>5.6.2</b> Add Labels to Circular Barplot</a></li>
<li class="chapter" data-level="5.6.3" data-path="ranking.html"><a href="ranking.html#circular-barplot-with-groups"><i class="fa fa-check"></i><b>5.6.3</b> Circular Barplot with Groups</a></li>
<li class="chapter" data-level="5.6.4" data-path="ranking.html"><a href="ranking.html#space-between-groups"><i class="fa fa-check"></i><b>5.6.4</b> Space between Groups</a></li>
<li class="chapter" data-level="5.6.5" data-path="ranking.html"><a href="ranking.html#order-bars"><i class="fa fa-check"></i><b>5.6.5</b> Order Bars</a></li>
<li class="chapter" data-level="5.6.6" data-path="ranking.html"><a href="ranking.html#circular-barchart-customization"><i class="fa fa-check"></i><b>5.6.6</b> Circular Barchart Customization</a></li>
<li class="chapter" data-level="5.6.7" data-path="ranking.html"><a href="ranking.html#circular-stacked-barplot"><i class="fa fa-check"></i><b>5.6.7</b> Circular Stacked Barplot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="part.html"><a href="part.html"><i class="fa fa-check"></i><b>6</b> Part of a Whole</a>
<ul>
<li class="chapter" data-level="6.1" data-path="part.html"><a href="part.html#grouped-and-stacked-barplot"><i class="fa fa-check"></i><b>6.1</b> Grouped and Stacked Barplot</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="part.html"><a href="part.html#grouped-stacked-and-percent-stacked-barplot-in-ggplot2"><i class="fa fa-check"></i><b>6.1.1</b> Grouped, Stacked and Percent Stacked Barplot in <code>ggplot2</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="part.html"><a href="part.html#stacked-barchart"><i class="fa fa-check"></i><b>6.1.2</b> Stacked Barchart</a></li>
<li class="chapter" data-level="6.1.3" data-path="part.html"><a href="part.html#percent-stacked-barchart"><i class="fa fa-check"></i><b>6.1.3</b> Percent Stacked Barchart</a></li>
<li class="chapter" data-level="6.1.4" data-path="part.html"><a href="part.html#grouped-barchart-customization"><i class="fa fa-check"></i><b>6.1.4</b> Grouped Barchart Customization</a></li>
<li class="chapter" data-level="6.1.5" data-path="part.html"><a href="part.html#small-multiple"><i class="fa fa-check"></i><b>6.1.5</b> Small Multiple</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="part.html"><a href="part.html#circular-stacked-barchart"><i class="fa fa-check"></i><b>6.2</b> Circular Stacked Barchart</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ranking.html"><a href="ranking.html#circular-stacked-barplot"><i class="fa fa-check"></i><b>6.2.1</b> Circular Stacked Barplot</a></li>
<li class="chapter" data-level="6.2.2" data-path="part.html"><a href="part.html#stacked-barplot-for-evolution"><i class="fa fa-check"></i><b>6.2.2</b> Stacked Barplot for Evolution</a></li>
<li class="chapter" data-level="6.2.3" data-path="distributions.html"><a href="distributions.html#base-r"><i class="fa fa-check"></i><b>6.2.3</b> Base R</a></li>
<li class="chapter" data-level="6.2.4" data-path="part.html"><a href="part.html#stacking-barplot"><i class="fa fa-check"></i><b>6.2.4</b> Stacking Barplot</a></li>
<li class="chapter" data-level="6.2.5" data-path="part.html"><a href="part.html#three-periods-stacked-barplot"><i class="fa fa-check"></i><b>6.2.5</b> Three Periods Stacked Barplot</a></li>
<li class="chapter" data-level="6.2.6" data-path="part.html"><a href="part.html#base-r-1"><i class="fa fa-check"></i><b>6.2.6</b> Base R</a></li>
<li class="chapter" data-level="6.2.7" data-path="part.html"><a href="part.html#grouped-stacked-and-percent-stacked-barplot-in-base-r"><i class="fa fa-check"></i><b>6.2.7</b> Grouped, Stacked and Percent Stacked Barplot in Base R</a></li>
<li class="chapter" data-level="6.2.8" data-path="part.html"><a href="part.html#grouped-stacked-barchart"><i class="fa fa-check"></i><b>6.2.8</b> Grouped Stacked Barchart</a></li>
<li class="chapter" data-level="6.2.9" data-path="part.html"><a href="part.html#percent-stacked-barplot"><i class="fa fa-check"></i><b>6.2.9</b> Percent Stacked Barplot</a></li>
<li class="chapter" data-level="6.2.10" data-path="part.html"><a href="part.html#barplot-for-likert-type-items"><i class="fa fa-check"></i><b>6.2.10</b> Barplot for <code>likert</code> Type Items</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="part.html"><a href="part.html#treemap"><i class="fa fa-check"></i><b>6.3</b> Treemap</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="part.html"><a href="part.html#most-basic-treemap-with-r"><i class="fa fa-check"></i><b>6.3.1</b> Most Basic Treemap with R</a></li>
<li class="chapter" data-level="6.3.2" data-path="part.html"><a href="part.html#treemap-with-subgroups"><i class="fa fa-check"></i><b>6.3.2</b> Treemap with Subgroups</a></li>
<li class="chapter" data-level="6.3.3" data-path="part.html"><a href="part.html#customize-your-r-treemap"><i class="fa fa-check"></i><b>6.3.3</b> Customize your R Treemap</a></li>
<li class="chapter" data-level="6.3.4" data-path="part.html"><a href="part.html#borders"><i class="fa fa-check"></i><b>6.3.4</b> Borders</a></li>
<li class="chapter" data-level="6.3.5" data-path="part.html"><a href="part.html#general-features"><i class="fa fa-check"></i><b>6.3.5</b> General Features</a></li>
<li class="chapter" data-level="6.3.6" data-path="part.html"><a href="part.html#interactive-treemap-in-r"><i class="fa fa-check"></i><b>6.3.6</b> Interactive Treemap in R</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="part.html"><a href="part.html#donut-chart"><i class="fa fa-check"></i><b>6.4</b> Donut Chart</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="part.html"><a href="part.html#most-basic-doughnut-chart-with-ggplot2"><i class="fa fa-check"></i><b>6.4.1</b> Most Basic Doughnut Chart with <code>ggplot2</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="ranking.html"><a href="ranking.html#customization"><i class="fa fa-check"></i><b>6.4.2</b> Customization</a></li>
<li class="chapter" data-level="6.4.3" data-path="part.html"><a href="part.html#donut-thickness"><i class="fa fa-check"></i><b>6.4.3</b> Donut Thickness</a></li>
<li class="chapter" data-level="6.4.4" data-path="part.html"><a href="part.html#donut-chart-with-base-r"><i class="fa fa-check"></i><b>6.4.4</b> Donut Chart with Base R</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="part.html"><a href="part.html#piechart"><i class="fa fa-check"></i><b>6.5</b> Piechart</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="part.html"><a href="part.html#most-basic-piechart-with-pie"><i class="fa fa-check"></i><b>6.5.1</b> Most Basic Piechart with <code>pie()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="part.html"><a href="part.html#change-labels-with-labels"><i class="fa fa-check"></i><b>6.5.2</b> Change Labels with <code>labels</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="part.html"><a href="part.html#non-circular-piechart-with-edges"><i class="fa fa-check"></i><b>6.5.3</b> Non-Circular Piechart with <code>edges</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="part.html"><a href="part.html#add-stripes-with-density"><i class="fa fa-check"></i><b>6.5.4</b> Add Stripes with <code>density</code></a></li>
<li class="chapter" data-level="6.5.5" data-path="part.html"><a href="part.html#color-with-col-and-border"><i class="fa fa-check"></i><b>6.5.5</b> Color with <code>col</code> and <code>border</code></a></li>
<li class="chapter" data-level="6.5.6" data-path="part.html"><a href="part.html#ggplot2-piechart"><i class="fa fa-check"></i><b>6.5.6</b> Ggplot2 Piechart</a></li>
<li class="chapter" data-level="6.5.7" data-path="part.html"><a href="part.html#improve-appearance"><i class="fa fa-check"></i><b>6.5.7</b> Improve Appearance</a></li>
<li class="chapter" data-level="6.5.8" data-path="part.html"><a href="part.html#adding-labels-with-geom_text"><i class="fa fa-check"></i><b>6.5.8</b> Adding Labels with <code>geom_text()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="part.html"><a href="part.html#dendrogram"><i class="fa fa-check"></i><b>6.6</b> Dendrogram</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="part.html"><a href="part.html#dendrogram-fromn-hierarchical-data"><i class="fa fa-check"></i><b>6.6.1</b> Dendrogram fromn Hierarchical Data</a></li>
<li class="chapter" data-level="6.6.2" data-path="part.html"><a href="part.html#dendrogram-from-edge-list"><i class="fa fa-check"></i><b>6.6.2</b> Dendrogram from Edge List</a></li>
<li class="chapter" data-level="6.6.3" data-path="part.html"><a href="part.html#dendrogram-from-a-nested-dataframe"><i class="fa fa-check"></i><b>6.6.3</b> Dendrogram from a Nested Dataframe</a></li>
<li class="chapter" data-level="6.6.4" data-path="part.html"><a href="part.html#dendrogram-customization-with-r-and-ggraph"><i class="fa fa-check"></i><b>6.6.4</b> Dendrogram Customization with R and <code>ggraph</code></a></li>
<li class="chapter" data-level="6.6.5" data-path="part.html"><a href="part.html#circular-or-linear-layout"><i class="fa fa-check"></i><b>6.6.5</b> Circular or Linear <code>layout</code></a></li>
<li class="chapter" data-level="6.6.6" data-path="part.html"><a href="part.html#edge-style"><i class="fa fa-check"></i><b>6.6.6</b> Edge Style</a></li>
<li class="chapter" data-level="6.6.7" data-path="part.html"><a href="part.html#labels-and-nodes"><i class="fa fa-check"></i><b>6.6.7</b> Labels and Nodes</a></li>
<li class="chapter" data-level="6.6.8" data-path="part.html"><a href="part.html#customize-aesthetics"><i class="fa fa-check"></i><b>6.6.8</b> Customize Aesthetics</a></li>
<li class="chapter" data-level="6.6.9" data-path="part.html"><a href="part.html#circular-dendrogram-with-r-and-ggraph"><i class="fa fa-check"></i><b>6.6.9</b> Circular Dendrogram with R and ggraph</a></li>
<li class="chapter" data-level="6.6.10" data-path="part.html"><a href="part.html#interactive-dendrogram-with-r"><i class="fa fa-check"></i><b>6.6.10</b> Interactive Dendrogram with R</a></li>
<li class="chapter" data-level="6.6.11" data-path="part.html"><a href="part.html#dendrogram-from-clustering-result"><i class="fa fa-check"></i><b>6.6.11</b> Dendrogram from <code>Clustering</code> Result</a></li>
<li class="chapter" data-level="6.6.12" data-path="part.html"><a href="part.html#zoom-on-a-group"><i class="fa fa-check"></i><b>6.6.12</b> Zoom on a Group</a></li>
<li class="chapter" data-level="6.6.13" data-path="part.html"><a href="part.html#dendrogram-with-color-and-legend-in-r"><i class="fa fa-check"></i><b>6.6.13</b> Dendrogram with Color and Legend in R</a></li>
<li class="chapter" data-level="6.6.14" data-path="part.html"><a href="part.html#more-customization-with-dendextend"><i class="fa fa-check"></i><b>6.6.14</b> More Customization with <code>Dendextend</code></a></li>
<li class="chapter" data-level="6.6.15" data-path="part.html"><a href="part.html#customized-dendrogram-with-r-and-the-dendextend-package"><i class="fa fa-check"></i><b>6.6.15</b> Customized Dendrogram with R and the Dendextend Package</a></li>
<li class="chapter" data-level="6.6.16" data-path="part.html"><a href="part.html#the-set-function"><i class="fa fa-check"></i><b>6.6.16</b> The <code>set()</code> Function</a></li>
<li class="chapter" data-level="6.6.17" data-path="part.html"><a href="part.html#highlight-clusters"><i class="fa fa-check"></i><b>6.6.17</b> Highlight Clusters</a></li>
<li class="chapter" data-level="6.6.18" data-path="part.html"><a href="part.html#comparing-with-an-expected-clustering"><i class="fa fa-check"></i><b>6.6.18</b> Comparing with an Expected Clustering</a></li>
<li class="chapter" data-level="6.6.19" data-path="part.html"><a href="part.html#comparing-2-dendrograms-with-tanglegram"><i class="fa fa-check"></i><b>6.6.19</b> Comparing 2 Dendrograms with <code>tanglegram()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="part.html"><a href="part.html#circular-packing"><i class="fa fa-check"></i><b>6.7</b> Circular Packing</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="part.html"><a href="part.html#basic-circle-packing-with-one-level"><i class="fa fa-check"></i><b>6.7.1</b> Basic Circle Packing with One Level</a></li>
<li class="chapter" data-level="6.7.2" data-path="part.html"><a href="part.html#circle-packing-customization-with-r"><i class="fa fa-check"></i><b>6.7.2</b> Circle Packing Customization with R</a></li>
<li class="chapter" data-level="6.7.3" data-path="part.html"><a href="part.html#map-color-to-bubble-value"><i class="fa fa-check"></i><b>6.7.3</b> Map Color to Bubble Value</a></li>
<li class="chapter" data-level="6.7.4" data-path="part.html"><a href="part.html#background-customization"><i class="fa fa-check"></i><b>6.7.4</b> Background Customization</a></li>
<li class="chapter" data-level="6.7.5" data-path="part.html"><a href="part.html#space-between-bubbles"><i class="fa fa-check"></i><b>6.7.5</b> Space between Bubbles</a></li>
<li class="chapter" data-level="6.7.6" data-path="part.html"><a href="part.html#interactive-circle-packing-with-r"><i class="fa fa-check"></i><b>6.7.6</b> Interactive Circle Packing with R</a></li>
<li class="chapter" data-level="6.7.7" data-path="part.html"><a href="part.html#basic-circle-packing-with-several-hierarchy-level"><i class="fa fa-check"></i><b>6.7.7</b> Basic Circle Packing with Several Hierarchy Level</a></li>
<li class="chapter" data-level="6.7.8" data-path="part.html"><a href="part.html#input-concept"><i class="fa fa-check"></i><b>6.7.8</b> Input &amp; Concept</a></li>
<li class="chapter" data-level="6.7.9" data-path="part.html"><a href="part.html#switching-to-another-chart-type"><i class="fa fa-check"></i><b>6.7.9</b> Switching to another Chart Type</a></li>
<li class="chapter" data-level="6.7.10" data-path="part.html"><a href="part.html#customized-circle-packing-with-r-and-ggraph"><i class="fa fa-check"></i><b>6.7.10</b> Customized Circle Packing with R and ggraph</a></li>
<li class="chapter" data-level="6.7.11" data-path="part.html"><a href="part.html#map-color-to-hierarchy-depth"><i class="fa fa-check"></i><b>6.7.11</b> Map Color to Hierarchy Depth</a></li>
<li class="chapter" data-level="6.7.12" data-path="part.html"><a href="part.html#map-color-to-hierarchy-depth-1"><i class="fa fa-check"></i><b>6.7.12</b> Map Color to Hierarchy Depth</a></li>
<li class="chapter" data-level="6.7.13" data-path="part.html"><a href="part.html#circular-packing-with-hidden-first-level-of-hierarchy"><i class="fa fa-check"></i><b>6.7.13</b> Circular Packing with Hidden First Level of Hierarchy</a></li>
<li class="chapter" data-level="6.7.14" data-path="part.html"><a href="part.html#hiding-the-first-level-for-better-styling"><i class="fa fa-check"></i><b>6.7.14</b> Hiding the First Level for Better Styling</a></li>
<li class="chapter" data-level="6.7.15" data-path="part.html"><a href="part.html#add-labels-to-a-specific-level-of-the-hierarchy"><i class="fa fa-check"></i><b>6.7.15</b> Add Labels to a Specific Level of the Hierarchy</a></li>
<li class="chapter" data-level="6.7.16" data-path="part.html"><a href="part.html#zoomable-circle-packing-with-r-and-circlepacker"><i class="fa fa-check"></i><b>6.7.16</b> Zoomable Circle Packing with R and circlePacker</a></li>
<li class="chapter" data-level="6.7.17" data-path="part.html"><a href="part.html#circular-packing-fom-edge-list"><i class="fa fa-check"></i><b>6.7.17</b> Circular Packing fom Edge List</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="evolution.html"><a href="evolution.html"><i class="fa fa-check"></i><b>7</b> Evolution</a>
<ul>
<li class="chapter" data-level="7.1" data-path="evolution.html"><a href="evolution.html#line-chart"><i class="fa fa-check"></i><b>7.1</b> Line Chart</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="evolution.html"><a href="evolution.html#line-chart-with-r-and-ggplot2"><i class="fa fa-check"></i><b>7.1.1</b> Line Chart with R and ggplot2</a></li>
<li class="chapter" data-level="7.1.2" data-path="evolution.html"><a href="evolution.html#customize-the-line-chart"><i class="fa fa-check"></i><b>7.1.2</b> Customize the Line Chart</a></li>
<li class="chapter" data-level="7.1.3" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-with-r-and-ggplot2"><i class="fa fa-check"></i><b>7.1.3</b> Connected scatterplot with R and ggplot2</a></li>
<li class="chapter" data-level="7.1.4" data-path="correlation.html"><a href="correlation.html#most-basic-connected-scatterplot-geom_point-and-geom_line"><i class="fa fa-check"></i><b>7.1.4</b> Most Basic Connected Scatterplot: <code>geom_point()</code> and <code>geom_line()</code></a></li>
<li class="chapter" data-level="7.1.5" data-path="correlation.html"><a href="correlation.html#customize-the-connected-scatterplot"><i class="fa fa-check"></i><b>7.1.5</b> Customize the Connected Scatterplot</a></li>
<li class="chapter" data-level="7.1.6" data-path="correlation.html"><a href="correlation.html#connected-scatterplot-to-show-an-evolution"><i class="fa fa-check"></i><b>7.1.6</b> Connected Scatterplot to Show an Evolution</a></li>
<li class="chapter" data-level="7.1.7" data-path="evolution.html"><a href="evolution.html#line-plot-with-log-scale"><i class="fa fa-check"></i><b>7.1.7</b> Line Plot with Log Scale</a></li>
<li class="chapter" data-level="7.1.8" data-path="evolution.html"><a href="evolution.html#without-log-transform"><i class="fa fa-check"></i><b>7.1.8</b> Without Log Transform</a></li>
<li class="chapter" data-level="7.1.9" data-path="evolution.html"><a href="evolution.html#multi-groups-line-chart-with-ggplot2"><i class="fa fa-check"></i><b>7.1.9</b> Multi Groups Line Chart with ggplot2</a></li>
<li class="chapter" data-level="7.1.10" data-path="evolution.html"><a href="evolution.html#customize-the-grouped-line-chart"><i class="fa fa-check"></i><b>7.1.10</b> Customize the Grouped Line Chart</a></li>
<li class="chapter" data-level="7.1.11" data-path="correlation.html"><a href="correlation.html#linear-model-and-confidence-interval-in-ggplot2"><i class="fa fa-check"></i><b>7.1.11</b> Linear Model and Confidence Interval in ggplot2</a></li>
<li class="chapter" data-level="7.1.12" data-path="evolution.html"><a href="evolution.html#line-chart-annotation-with-ggplot2"><i class="fa fa-check"></i><b>7.1.12</b> Line Chart Annotation with ggplot2</a></li>
<li class="chapter" data-level="7.1.13" data-path="evolution.html"><a href="evolution.html#dual-y-axis-with-r-and-ggplot2"><i class="fa fa-check"></i><b>7.1.13</b> Dual Y Axis with R and ggplot2</a></li>
<li class="chapter" data-level="7.1.14" data-path="evolution.html"><a href="evolution.html#adding-a-second-y-axis-with-sec.axis-the-idea"><i class="fa fa-check"></i><b>7.1.14</b> Adding a Second Y Axis with <code>sec.axis()</code>: The Idea</a></li>
<li class="chapter" data-level="7.1.15" data-path="evolution.html"><a href="evolution.html#show-2-series-on-the-same-line-chart-with-sec.axis"><i class="fa fa-check"></i><b>7.1.15</b> Show 2 Series on the Same Line Chart with <code>sec.axis()</code></a></li>
<li class="chapter" data-level="7.1.16" data-path="evolution.html"><a href="evolution.html#dual-y-axis-customization-with-ggplot2"><i class="fa fa-check"></i><b>7.1.16</b> Dual Y Axis Customization with <code>ggplot2</code></a></li>
<li class="chapter" data-level="7.1.17" data-path="evolution.html"><a href="evolution.html#barplot-with-overlapping-line-chart"><i class="fa fa-check"></i><b>7.1.17</b> Barplot with Overlapping Line Chart</a></li>
<li class="chapter" data-level="7.1.18" data-path="evolution.html"><a href="evolution.html#line-chart-with-error-envelop-ggplot2-and-geom_ribbon"><i class="fa fa-check"></i><b>7.1.18</b> Line Chart with Error Envelop: ggplot2 and geom_ribbon()</a></li>
<li class="chapter" data-level="7.1.19" data-path="evolution.html"><a href="evolution.html#spaghetti-plot"><i class="fa fa-check"></i><b>7.1.19</b> Spaghetti Plot</a></li>
<li class="chapter" data-level="7.1.20" data-path="evolution.html"><a href="evolution.html#change-line-chart-color-according-to-y-value"><i class="fa fa-check"></i><b>7.1.20</b> Change Line Chart Color according to Y Value</a></li>
<li class="chapter" data-level="7.1.21" data-path="correlation.html"><a href="correlation.html#add-a-legend-to-a-base-r-chart"><i class="fa fa-check"></i><b>7.1.21</b> Add a Legend to a Base R Chart</a></li>
<li class="chapter" data-level="7.1.22" data-path="evolution.html"><a href="evolution.html#reversed-y-axis-in-base-r"><i class="fa fa-check"></i><b>7.1.22</b> Reversed Y Axis in Base R</a></li>
<li class="chapter" data-level="7.1.23" data-path="correlation.html"><a href="correlation.html#scatterplot-with-polynomial-curve-fitting"><i class="fa fa-check"></i><b>7.1.23</b> Scatterplot with Polynomial Curve Fitting</a></li>
<li class="chapter" data-level="7.1.24" data-path="correlation.html"><a href="correlation.html#base-r-graph-parameters-a-cheatsheet."><i class="fa fa-check"></i><b>7.1.24</b> Base R Graph Parameters: a cheatsheet.</a></li>
<li class="chapter" data-level="7.1.25" data-path="evolution.html"><a href="evolution.html#dual-y-axis-in-r"><i class="fa fa-check"></i><b>7.1.25</b> Dual Y Axis in R</a></li>
<li class="chapter" data-level="7.1.26" data-path="evolution.html"><a href="evolution.html#adding-a-second-y-axis-with-sec.axis-the-idea-1"><i class="fa fa-check"></i><b>7.1.26</b> Adding a Second Y axis with <code>sec.axis()</code>: The Idea</a></li>
<li class="chapter" data-level="7.1.27" data-path="evolution.html"><a href="evolution.html#show-2-series-on-the-same-line-chart-with-sec.axis-1"><i class="fa fa-check"></i><b>7.1.27</b> Show 2 Series on the Same Line Chart with <code>sec.axis()</code></a></li>
<li class="chapter" data-level="7.1.28" data-path="evolution.html"><a href="evolution.html#dual-y-axis-customization-with-ggplot2-1"><i class="fa fa-check"></i><b>7.1.28</b> Dual Y Axis Customization with <code>ggplot2</code></a></li>
<li class="chapter" data-level="7.1.29" data-path="evolution.html"><a href="evolution.html#barplot-with-overlapping-line-chart-1"><i class="fa fa-check"></i><b>7.1.29</b> Barplot with Overlapping Line Chart</a></li>
<li class="chapter" data-level="7.1.30" data-path="evolution.html"><a href="evolution.html#dual-y-axis-in-r-1"><i class="fa fa-check"></i><b>7.1.30</b> Dual Y axis in R</a></li>
<li class="chapter" data-level="7.1.31" data-path="evolution.html"><a href="evolution.html#dual-y-axis-line-chart"><i class="fa fa-check"></i><b>7.1.31</b> Dual Y Axis Line Chart</a></li>
<li class="chapter" data-level="7.1.32" data-path="evolution.html"><a href="evolution.html#add-legend"><i class="fa fa-check"></i><b>7.1.32</b> Add Legend</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="evolution.html"><a href="evolution.html#area-chart"><i class="fa fa-check"></i><b>7.2</b> Area Chart</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="evolution.html"><a href="evolution.html#area-chart-with-r-and-ggplot2"><i class="fa fa-check"></i><b>7.2.1</b> Area Chart with R and ggplot2</a></li>
<li class="chapter" data-level="7.2.2" data-path="evolution.html"><a href="evolution.html#customize-the-line-chart-1"><i class="fa fa-check"></i><b>7.2.2</b> Customize the Line Chart</a></li>
<li class="chapter" data-level="7.2.3" data-path="evolution.html"><a href="evolution.html#basic-stacked-area-chart-with-r"><i class="fa fa-check"></i><b>7.2.3</b> Basic Stacked Area Chart with R</a></li>
<li class="chapter" data-level="7.2.4" data-path="evolution.html"><a href="evolution.html#control-stacking-order-with-ggplot2"><i class="fa fa-check"></i><b>7.2.4</b> Control Stacking Order with <code>ggplot2</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="evolution.html"><a href="evolution.html#proportional-stacked-area-chart"><i class="fa fa-check"></i><b>7.2.5</b> Proportional Stacked Area Chart</a></li>
<li class="chapter" data-level="7.2.6" data-path="evolution.html"><a href="evolution.html#color-style"><i class="fa fa-check"></i><b>7.2.6</b> Color &amp; Style</a></li>
<li class="chapter" data-level="7.2.7" data-path="evolution.html"><a href="evolution.html#stacking-area-charts"><i class="fa fa-check"></i><b>7.2.7</b> Stacking Area Charts</a></li>
<li class="chapter" data-level="7.2.8" data-path="evolution.html"><a href="evolution.html#example-mental-arithmetic"><i class="fa fa-check"></i><b>7.2.8</b> Example: Mental Arithmetic</a></li>
<li class="chapter" data-level="7.2.9" data-path="evolution.html"><a href="evolution.html#interactive-area-chart-with-r-and-plotly"><i class="fa fa-check"></i><b>7.2.9</b> Interactive Area Chart with R and plotly</a></li>
<li class="chapter" data-level="7.2.10" data-path="evolution.html"><a href="evolution.html#basic-line-chart-with-ggplot2-and-geom_line-3"><i class="fa fa-check"></i><b>7.2.10</b> Basic Line Chart with ggplot2 and <code>geom_line()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="evolution.html"><a href="evolution.html#streamgraph"><i class="fa fa-check"></i><b>7.3</b> Streamgraph</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="evolution.html"><a href="evolution.html#most-basic-streamgraph"><i class="fa fa-check"></i><b>7.3.1</b> Most Basic Streamgraph</a></li>
<li class="chapter" data-level="7.3.2" data-path="evolution.html"><a href="evolution.html#control-streamgraph-offset"><i class="fa fa-check"></i><b>7.3.2</b> Control Streamgraph Offset</a></li>
<li class="chapter" data-level="7.3.3" data-path="evolution.html"><a href="evolution.html#change-streamgraph-shape"><i class="fa fa-check"></i><b>7.3.3</b> Change Streamgraph Shape</a></li>
<li class="chapter" data-level="7.3.4" data-path="evolution.html"><a href="evolution.html#change-streamgraph-color"><i class="fa fa-check"></i><b>7.3.4</b> Change Streamgraph Color</a></li>
<li class="chapter" data-level="7.3.5" data-path="evolution.html"><a href="evolution.html#streamgraph-with-dropdown-button"><i class="fa fa-check"></i><b>7.3.5</b> Streamgraph with Dropdown Button</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="evolution.html"><a href="evolution.html#time-series"><i class="fa fa-check"></i><b>7.4</b> Time Series</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="evolution.html"><a href="evolution.html#time-series-with-ggplot2"><i class="fa fa-check"></i><b>7.4.1</b> Time Series with <code>Ggplot2</code></a></li>
<li class="chapter" data-level="7.4.2" data-path="evolution.html"><a href="evolution.html#format-used-on-the-x-axis"><i class="fa fa-check"></i><b>7.4.2</b> Format used on the X Axis</a></li>
<li class="chapter" data-level="7.4.3" data-path="evolution.html"><a href="evolution.html#breaks-and-minor-breaks"><i class="fa fa-check"></i><b>7.4.3</b> Breaks and Minor Breaks</a></li>
<li class="chapter" data-level="7.4.4" data-path="evolution.html"><a href="evolution.html#add-angle-to-x-axis-labels"><i class="fa fa-check"></i><b>7.4.4</b> Add Angle to X Axis Labels</a></li>
<li class="chapter" data-level="7.4.5" data-path="evolution.html"><a href="evolution.html#select-time-frame"><i class="fa fa-check"></i><b>7.4.5</b> Select Time Frame</a></li>
<li class="chapter" data-level="7.4.6" data-path="evolution.html"><a href="evolution.html#line-chart-annotation-with-ggplot2-1"><i class="fa fa-check"></i><b>7.4.6</b> Line Chart Annotation with ggplot2</a></li>
<li class="chapter" data-level="7.4.7" data-path="evolution.html"><a href="evolution.html#dual-y-axis-with-r-and-ggplot2-1"><i class="fa fa-check"></i><b>7.4.7</b> Dual Y Axis with R and ggplot2</a></li>
<li class="chapter" data-level="7.4.8" data-path="evolution.html"><a href="evolution.html#using-the-ggplotly-function"><i class="fa fa-check"></i><b>7.4.8</b> Using the <code>ggplotly()</code> Function</a></li>
<li class="chapter" data-level="7.4.9" data-path="evolution.html"><a href="evolution.html#using-plot_ly"><i class="fa fa-check"></i><b>7.4.9</b> Using <code>plot_ly()</code></a></li>
<li class="chapter" data-level="7.4.10" data-path="evolution.html"><a href="evolution.html#an-introduction-to-interactive-time-series-with-r-and-dygraphs"><i class="fa fa-check"></i><b>7.4.10</b> An Introduction to Interactive Time Series with R and Dygraphs</a></li>
<li class="chapter" data-level="7.4.11" data-path="evolution.html"><a href="evolution.html#if-time-is-a-numeric-variable"><i class="fa fa-check"></i><b>7.4.11</b> If Time is a <code>numeric</code> Variable</a></li>
<li class="chapter" data-level="7.4.12" data-path="evolution.html"><a href="evolution.html#if-time-is-a-date-variable"><i class="fa fa-check"></i><b>7.4.12</b> If Time is a <code>date</code> Variable</a></li>
<li class="chapter" data-level="7.4.13" data-path="evolution.html"><a href="evolution.html#several-series"><i class="fa fa-check"></i><b>7.4.13</b> Several Series</a></li>
<li class="chapter" data-level="7.4.14" data-path="evolution.html"><a href="evolution.html#getting-the-date-format"><i class="fa fa-check"></i><b>7.4.14</b> Getting the Date Format</a></li>
<li class="chapter" data-level="7.4.15" data-path="evolution.html"><a href="evolution.html#time-series-with-dygraph"><i class="fa fa-check"></i><b>7.4.15</b> Time Series With Dygraph</a></li>
<li class="chapter" data-level="7.4.16" data-path="evolution.html"><a href="evolution.html#area-chart-1"><i class="fa fa-check"></i><b>7.4.16</b> Area Chart</a></li>
<li class="chapter" data-level="7.4.17" data-path="evolution.html"><a href="evolution.html#step-chart"><i class="fa fa-check"></i><b>7.4.17</b> Step Chart</a></li>
<li class="chapter" data-level="7.4.18" data-path="ranking.html"><a href="ranking.html#lollipop-plot"><i class="fa fa-check"></i><b>7.4.18</b> Lollipop Plot</a></li>
<li class="chapter" data-level="7.4.19" data-path="evolution.html"><a href="evolution.html#candlestick-chart"><i class="fa fa-check"></i><b>7.4.19</b> Candlestick Chart</a></li>
<li class="chapter" data-level="7.4.20" data-path="evolution.html"><a href="evolution.html#line-chart-with-interval"><i class="fa fa-check"></i><b>7.4.20</b> Line Chart with Interval</a></li>
<li class="chapter" data-level="7.4.21" data-path="evolution.html"><a href="evolution.html#custom-dygraphs-time-series-example"><i class="fa fa-check"></i><b>7.4.21</b> Custom Dygraphs Time Series Example</a></li>
<li class="chapter" data-level="7.4.22" data-path="correlation.html"><a href="correlation.html#heatmap-for-time-series"><i class="fa fa-check"></i><b>7.4.22</b> Heatmap for Time Series</a></li>
<li class="chapter" data-level="7.4.23" data-path="evolution.html"><a href="evolution.html#dual-y-axis-in-r-2"><i class="fa fa-check"></i><b>7.4.23</b> Dual Y Axis in R</a></li>
<li class="chapter" data-level="7.4.24" data-path="evolution.html"><a href="evolution.html#dual-y-axis-line-chart-1"><i class="fa fa-check"></i><b>7.4.24</b> Dual Y Axis Line Chart</a></li>
<li class="chapter" data-level="7.4.25" data-path="evolution.html"><a href="evolution.html#add-legend-1"><i class="fa fa-check"></i><b>7.4.25</b> Add Legend</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="map.html"><a href="map.html"><i class="fa fa-check"></i><b>8</b> Map</a>
<ul>
<li class="chapter" data-level="8.1" data-path="map.html"><a href="map.html#basic-maps"><i class="fa fa-check"></i><b>8.1</b> Basic Maps</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="map.html"><a href="map.html#background-map-in-r"><i class="fa fa-check"></i><b>8.1.1</b> Background map in R</a></li>
<li class="chapter" data-level="8.1.2" data-path="map.html"><a href="map.html#most-basic-background-map-with-r-and-leaflet"><i class="fa fa-check"></i><b>8.1.2</b> Most Basic Background Map with R and Leaflet</a></li>
<li class="chapter" data-level="8.1.3" data-path="map.html"><a href="map.html#change-background-tile-with-leaflet-and-r"><i class="fa fa-check"></i><b>8.1.3</b> Change Background Tile with <code>leaflet</code> and R</a></li>
<li class="chapter" data-level="8.1.4" data-path="map.html"><a href="map.html#the-ggmap-package-for-static-maps-with-background-titles"><i class="fa fa-check"></i><b>8.1.4</b> The <code>ggmap</code> Package for Static Maps with Background Titles</a></li>
<li class="chapter" data-level="8.1.5" data-path="map.html"><a href="map.html#calling-stamen-background"><i class="fa fa-check"></i><b>8.1.5</b> Calling Stamen Background</a></li>
<li class="chapter" data-level="8.1.6" data-path="map.html"><a href="map.html#the-maps-mapdata-and-oz-packages-to-get-most-common-boundaries"><i class="fa fa-check"></i><b>8.1.6</b> The <code>Maps</code>, <code>Mapdata</code> and <code>Oz</code> Packages to get Most Common Boundaries</a></li>
<li class="chapter" data-level="8.1.7" data-path="map.html"><a href="map.html#mapdata-package"><i class="fa fa-check"></i><b>8.1.7</b> <code>mapdata</code> Package</a></li>
<li class="chapter" data-level="8.1.8" data-path="map.html"><a href="map.html#oz-package"><i class="fa fa-check"></i><b>8.1.8</b> <code>oz</code> Package</a></li>
<li class="chapter" data-level="8.1.9" data-path="map.html"><a href="map.html#rgdal-and-geojsonio-to-read-shapefiles-and-.geojson-files"><i class="fa fa-check"></i><b>8.1.9</b> <code>Rgdal</code> and <code>Geojsonio</code> to Read Shapefiles and .geojson Files</a></li>
<li class="chapter" data-level="8.1.10" data-path="map.html"><a href="map.html#find-and-download-a-shapefile"><i class="fa fa-check"></i><b>8.1.10</b> Find and Download a Shapefile</a></li>
<li class="chapter" data-level="8.1.11" data-path="map.html"><a href="map.html#read-it-with-rgdal"><i class="fa fa-check"></i><b>8.1.11</b> Read it with <code>rgdal</code></a></li>
<li class="chapter" data-level="8.1.12" data-path="map.html"><a href="map.html#plot-it-with-base-r"><i class="fa fa-check"></i><b>8.1.12</b> Plot it with <code>base R</code></a></li>
<li class="chapter" data-level="8.1.13" data-path="map.html"><a href="map.html#plot-it-with-ggplot2"><i class="fa fa-check"></i><b>8.1.13</b> Plot it with <code>ggplot2</code></a></li>
<li class="chapter" data-level="8.1.14" data-path="map.html"><a href="map.html#open-and-plot-geojson-files-in-r"><i class="fa fa-check"></i><b>8.1.14</b> Open and Plot Geojson files in R</a></li>
<li class="chapter" data-level="8.1.15" data-path="map.html"><a href="map.html#find-and-download-a-.geojson-file"><i class="fa fa-check"></i><b>8.1.15</b> Find and download a <code>.geoJSON</code> file</a></li>
<li class="chapter" data-level="8.1.16" data-path="map.html"><a href="map.html#plot-it-with-base-r-1"><i class="fa fa-check"></i><b>8.1.16</b> Plot it with <code>base R</code></a></li>
<li class="chapter" data-level="8.1.17" data-path="map.html"><a href="map.html#plot-it-with-ggplot2-1"><i class="fa fa-check"></i><b>8.1.17</b> Plot it with <code>ggplot2</code></a></li>
<li class="chapter" data-level="8.1.18" data-path="map.html"><a href="map.html#geospatial-data-manipulation"><i class="fa fa-check"></i><b>8.1.18</b> Geospatial Data Manipulation</a></li>
<li class="chapter" data-level="8.1.19" data-path="map.html"><a href="map.html#simplify-geospatial-object"><i class="fa fa-check"></i><b>8.1.19</b> Simplify Geospatial Object</a></li>
<li class="chapter" data-level="8.1.20" data-path="map.html"><a href="map.html#compute-region-centroid"><i class="fa fa-check"></i><b>8.1.20</b> Compute Region Centroid</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="map.html"><a href="map.html#choropleth-maps"><i class="fa fa-check"></i><b>8.2</b> Choropleth Maps</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="map.html"><a href="map.html#choropleth-map-with-r-and-ggplot2"><i class="fa fa-check"></i><b>8.2.1</b> Choropleth map with R and <code>ggplot2</code></a></li>
<li class="chapter" data-level="8.2.2" data-path="map.html"><a href="map.html#basic-background-map"><i class="fa fa-check"></i><b>8.2.2</b> Basic Background Map</a></li>
<li class="chapter" data-level="8.2.3" data-path="map.html"><a href="map.html#read-the-numeric-variable"><i class="fa fa-check"></i><b>8.2.3</b> Read the Numeric Variable</a></li>
<li class="chapter" data-level="8.2.4" data-path="map.html"><a href="map.html#merge-geospatial-and-numeric-data"><i class="fa fa-check"></i><b>8.2.4</b> Merge Geospatial and Numeric Data</a></li>
<li class="chapter" data-level="8.2.5" data-path="map.html"><a href="map.html#read-the-numeric-variable-1"><i class="fa fa-check"></i><b>8.2.5</b> Read the Numeric Variable</a></li>
<li class="chapter" data-level="8.2.6" data-path="map.html"><a href="map.html#customized-choropleth-map-with-r-and-ggplot2"><i class="fa fa-check"></i><b>8.2.6</b> Customized Choropleth Map with R and <code>ggplot2</code></a></li>
<li class="chapter" data-level="8.2.7" data-path="map.html"><a href="map.html#choropleth-map-with-r"><i class="fa fa-check"></i><b>8.2.7</b> Choropleth Map with R</a></li>
<li class="chapter" data-level="8.2.8" data-path="map.html"><a href="map.html#find-and-download-a-shape-file"><i class="fa fa-check"></i><b>8.2.8</b> Find and Download a Shape File</a></li>
<li class="chapter" data-level="8.2.9" data-path="map.html"><a href="map.html#plot-the-map"><i class="fa fa-check"></i><b>8.2.9</b> Plot the Map</a></li>
<li class="chapter" data-level="8.2.10" data-path="map.html"><a href="map.html#visualize-the-numeric-variable"><i class="fa fa-check"></i><b>8.2.10</b> Visualize the Numeric Variable</a></li>
<li class="chapter" data-level="8.2.11" data-path="map.html"><a href="map.html#build-the-choropleth"><i class="fa fa-check"></i><b>8.2.11</b> Build the Choropleth</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="map.html"><a href="map.html#interactive-choropleth-map-with-r-and-leaflet"><i class="fa fa-check"></i><b>8.3</b> Interactive Choropleth Map with R and leaflet</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="map.html"><a href="map.html#find-download-and-load-geospatial-data"><i class="fa fa-check"></i><b>8.3.1</b> Find, Download and Load Geospatial Data</a></li>
<li class="chapter" data-level="8.3.2" data-path="map.html"><a href="map.html#default-choropleth"><i class="fa fa-check"></i><b>8.3.2</b> Default Choropleth</a></li>
<li class="chapter" data-level="8.3.3" data-path="map.html"><a href="map.html#visualize-the-numeric-variable-1"><i class="fa fa-check"></i><b>8.3.3</b> Visualize the Numeric Variable</a></li>
<li class="chapter" data-level="8.3.4" data-path="map.html"><a href="map.html#change-color-scale"><i class="fa fa-check"></i><b>8.3.4</b> Change Color Scale</a></li>
<li class="chapter" data-level="8.3.5" data-path="map.html"><a href="map.html#customizied-leaflet-choropleth-map"><i class="fa fa-check"></i><b>8.3.5</b> Customizied <code>leaflet</code> Choropleth Map</a></li>
<li class="chapter" data-level="8.3.6" data-path="map.html"><a href="map.html#basic-choropleth-map-with-the-cartography-package"><i class="fa fa-check"></i><b>8.3.6</b> Basic Choropleth Map with the Cartography Package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html"><i class="fa fa-check"></i><b>9</b> Use the cartography library to do the choropleth map</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#data-provided-in-a-shape-file"><i class="fa fa-check"></i><b>9.0.1</b> Data Provided in a Shape File</a></li>
<li class="chapter" data-level="9.0.2" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#customized-choropleth-map-with-the-cartography-package"><i class="fa fa-check"></i><b>9.0.2</b> Customized Choropleth Map with the Cartography Package</a></li>
<li class="chapter" data-level="9.1" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#hexbin-maps"><i class="fa fa-check"></i><b>9.1</b> Hexbin Maps</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#hexbin-map-in-r-example-with-us-states"><i class="fa fa-check"></i><b>9.1.1</b> Hexbin Map in R: Example with US states</a></li>
<li class="chapter" data-level="9.1.2" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#ggplot2-and-state-name"><i class="fa fa-check"></i><b>9.1.2</b> <code>ggplot2</code> and State Name</a></li>
<li class="chapter" data-level="9.1.3" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#basic-choropleth"><i class="fa fa-check"></i><b>9.1.3</b> Basic Choropleth</a></li>
<li class="chapter" data-level="9.1.4" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#customized-hexbin-choropleth-map"><i class="fa fa-check"></i><b>9.1.4</b> Customized Hexbin Choropleth Map</a></li>
<li class="chapter" data-level="9.1.5" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#hexbin-map-from-list-of-coordinates"><i class="fa fa-check"></i><b>9.1.5</b> Hexbin Map from List of Coordinates</a></li>
<li class="chapter" data-level="9.1.6" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#hexbin-map-for-2d-density-visualization"><i class="fa fa-check"></i><b>9.1.6</b> Hexbin Map for 2D Density Visualization</a></li>
<li class="chapter" data-level="9.1.7" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#hexbin-maps-1"><i class="fa fa-check"></i><b>9.1.7</b> Hexbin Maps</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cartogram"><i class="fa fa-check"></i><b>9.2</b> Cartogram</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#basic-cartogram-with-r"><i class="fa fa-check"></i><b>9.2.1</b> Basic Cartogram with R</a></li>
<li class="chapter" data-level="9.2.2" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#distort-country-size-with-cartogram"><i class="fa fa-check"></i><b>9.2.2</b> Distort Country Size with <code>cartogram</code></a></li>
<li class="chapter" data-level="9.2.3" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cartogram-and-choropleth"><i class="fa fa-check"></i><b>9.2.3</b> Cartogram and Choropleth</a></li>
<li class="chapter" data-level="9.2.4" data-path="correlation.html"><a href="correlation.html#make-it-pretty"><i class="fa fa-check"></i><b>9.2.4</b> Make it Pretty</a></li>
<li class="chapter" data-level="9.2.5" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#application-on-hexbin-map"><i class="fa fa-check"></i><b>9.2.5</b> Application on Hexbin Map</a></li>
<li class="chapter" data-level="9.2.6" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#basic-cartogram-with-r-1"><i class="fa fa-check"></i><b>9.2.6</b> Basic Cartogram with R</a></li>
<li class="chapter" data-level="9.2.7" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#distort-hexagone-size-with-cartogram"><i class="fa fa-check"></i><b>9.2.7</b> Distort Hexagone Size with <code>cartogram</code></a></li>
<li class="chapter" data-level="9.2.8" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cartogram-and-choropleth-1"><i class="fa fa-check"></i><b>9.2.8</b> Cartogram and Choropleth</a></li>
<li class="chapter" data-level="9.2.9" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#a-smooth-transition-between-choropleth-and-cartogram"><i class="fa fa-check"></i><b>9.2.9</b> A Smooth Transition between Choropleth and Cartogram</a></li>
<li class="chapter" data-level="9.2.10" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#a-basic-map-of-africa"><i class="fa fa-check"></i><b>9.2.10</b> A Basic Map of Africa</a></li>
<li class="chapter" data-level="9.2.11" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#compute-cartogram-boundaries"><i class="fa fa-check"></i><b>9.2.11</b> Compute Cartogram Boundaries</a></li>
<li class="chapter" data-level="9.2.12" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#a-nicer-representation-using-ggplot2"><i class="fa fa-check"></i><b>9.2.12</b> A Nicer Representation using <code>ggplot2</code></a></li>
<li class="chapter" data-level="9.2.13" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#compute-several-intermediate-maps"><i class="fa fa-check"></i><b>9.2.13</b> Compute Several Intermediate Maps</a></li>
<li class="chapter" data-level="9.2.14" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#make-the-animation-with-gganimate"><i class="fa fa-check"></i><b>9.2.14</b> Make the Animation with <code>gganimate</code></a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#connection-map"><i class="fa fa-check"></i><b>9.3</b> Connection Map</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#how-to-draw-connecting-routes-on-map-with-r"><i class="fa fa-check"></i><b>9.3.1</b> How to Draw Connecting Routes on Map with R</a></li>
<li class="chapter" data-level="9.3.2" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#add-3-cities"><i class="fa fa-check"></i><b>9.3.2</b> Add 3 Cities</a></li>
<li class="chapter" data-level="9.3.3" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#show-connection-between-cities"><i class="fa fa-check"></i><b>9.3.3</b> Show Connection between Cities</a></li>
<li class="chapter" data-level="9.3.4" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#correcting-gcintermediate"><i class="fa fa-check"></i><b>9.3.4</b> Correcting <code>gcIntermediate</code></a></li>
<li class="chapter" data-level="9.3.5" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#apply-it-to-several-pairs-of-cities"><i class="fa fa-check"></i><b>9.3.5</b> Apply it to Several Pairs of Cities</a></li>
<li class="chapter" data-level="9.3.6" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#an-alternative-using-the-greatcircle-function"><i class="fa fa-check"></i><b>9.3.6</b> An Alternative using the <code>greatCircle</code> Function</a></li>
<li class="chapter" data-level="9.3.7" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#visualizing-geographic-connections"><i class="fa fa-check"></i><b>9.3.7</b> Visualizing Geographic Connections</a></li>
<li class="chapter" data-level="9.3.8" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#showing-few-connections-on-a-map"><i class="fa fa-check"></i><b>9.3.8</b> Showing Few Connections on a Map</a></li>
<li class="chapter" data-level="9.3.9" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#showing-many-connections-on-a-map"><i class="fa fa-check"></i><b>9.3.9</b> Showing Many Connections on a Map</a></li>
<li class="chapter" data-level="9.3.10" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#bubble-map"><i class="fa fa-check"></i><b>9.3.10</b> Bubble Map</a></li>
<li class="chapter" data-level="9.3.11" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#use-leaflet-control-widget"><i class="fa fa-check"></i><b>9.3.11</b> Use leaflet control widget</a></li>
<li class="chapter" data-level="9.3.12" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#interactive-earthquake-bubble-map-with-r-and-leaflet"><i class="fa fa-check"></i><b>9.3.12</b> Interactive Earthquake Bubble Map with R and leaflet</a></li>
<li class="chapter" data-level="9.3.13" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#bubble-map-with-ggplot2"><i class="fa fa-check"></i><b>9.3.13</b> Bubble map with <code>ggplot2</code></a></li>
<li class="chapter" data-level="9.3.14" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#basic-scatterplot-map"><i class="fa fa-check"></i><b>9.3.14</b> Basic Scatterplot Map</a></li>
<li class="chapter" data-level="9.3.15" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#basic-bubble-map"><i class="fa fa-check"></i><b>9.3.15</b> Basic Bubble Map</a></li>
<li class="chapter" data-level="9.3.16" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#customized-bubble-map"><i class="fa fa-check"></i><b>9.3.16</b> Customized Bubble Map</a></li>
<li class="chapter" data-level="9.3.17" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#interactive-bubble-map-with-plotly"><i class="fa fa-check"></i><b>9.3.17</b> Interactive Bubble Map with Plotly</a></li>
<li class="chapter" data-level="9.3.18" data-path="use-the-cartography-library-to-do-the-choropleth-map.html"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#proportional-symbol-map-with-the-cartography-package"><i class="fa fa-check"></i><b>9.3.18</b> Proportional Symbol Map with the Cartography Package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="flow.html"><a href="flow.html"><i class="fa fa-check"></i><b>10</b> Flow</a>
<ul>
<li class="chapter" data-level="10.1" data-path="flow.html"><a href="flow.html#chord-diagram"><i class="fa fa-check"></i><b>10.1</b> Chord diagram</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="flow.html"><a href="flow.html#introduction-to-the-circlize-package-circular-chart-customization-for-thecirclizer-package-most-basic-circular-chart-customization-available-circular-chart-types-with-circlize-circular-scatterplot-circular-line-chart-vertical-ablines-circular-histogram-circular-chart-with-several-tracks-display-several-chord-diagrams-on-same-figure-draw-part-of-the-circular-chart-only-input-data-node-and-connection-color-advanced-chord-diagram-with-r-and-circlize-chord-diagram-from-adjacency-matrix-chord-diagram-from-edge-list-chord-diagram-from-adjacency-matrix-chord-diagram-variations-static-chord-diagram-introduction-to-chord-diagram-chord-diagram-from-adjacency-matrix-network-graph-input-format-and-introduction-toigraph-network-chart-with-r-and-igraph-from-any-type-of-input-adjacency-matrix-incidence-matrix-edge-list-literal-list-of-connections-default-network-chart-withigraph-customize-node-features-customize-label-features-customize-link-features-all-customization-network-layouts-map-variable-to-node-and-links-feature-in-rigraphnetwork-map-variable-to-node-features-map-variable-to-link-features-clustering-result-visualization-with-network-diagram-compute-the-correlation-matrix-basic-network-diagram-customization-customize-link-features-all-customization-network-with-node-size-based-on-edge-number-basic-network-diagram-most-basic-network-diagram-interactive-network-customization-sankey-diagram-most-basic-sankey-diagram-from-connection-data-frame-from-incidence-matrix-customize-colors-in-sankey-diagram-custom-color-of-individual-nodes-set-color-for-groups-of-nodes-set-color-of-connections-sankey-diagram-interactive-definition-what-for-variation-arc-diagram-definition-arc-diagrams-common-mistakes-hierarchical-edge-bundling-what-is-hierarchical-edge-bundling-introduction-to-hierarchical-edge-bundling-with-r-input-data-visualizing-the-hierarchy-add-a-few-connections-hierarchical-edge-bundling-customize-hierarchical-edge-bundling-basic-hierarchical-edge-bundling-playing-withtension"><i class="fa fa-check"></i><b>10.1.1</b> Introduction to the <code>circlize Package ### Circular Chart Customization for the</code>Circlize<code>R package ### Most Basic Circular Chart ### Customization ### Available Circular Chart Types with Circlize #### Circular Scatterplot ### Circular Line Chart ### Vertical Ablines ### Circular Histogram ### Circular Chart with Several Tracks ### Display Several Chord Diagrams on same Figure ### Draw Part of the Circular Chart Only #### Input Data #### Node and Connection Color ### Advanced Chord Diagram with R and Circlize #### Chord Diagram from Adjacency Matrix ### Chord Diagram from Edge List ### Chord diagram from Adjacency Matrix ### Chord Diagram  ### Variations ### Static Chord Diagram ### Introduction to Chord Diagram ### Chord Diagram from Adjacency Matrix ## Network Graph #### Input Format and Introduction to</code>igraph<code>### Network Chart with R and igraph from any Type of Input #### Adjacency Matrix ### Incidence Matrix ### Edge List ### Literal List of Connections ### Default Network Chart with</code>igraph<code>### Customize Node Features ### Customize Label Features ### Customize Link Features ### All Customization ### Network Layouts ### Map Variable to Node and Links Feature in R</code>igraph<code>Network #### Map Variable to Node Features ### Map Variable to Link Features ### Clustering Result Visualization with Network Diagram #### Compute the Correlation Matrix ### Basic Network Diagram ### Customization ### Customize Link Features ### All Customization ### Network with Node Size Based on Edge Number #### Basic Network Diagram ### Most Basic Network Diagram ### Interactive Network Customization ## Sankey Diagram ### Most Basic Sankey Diagram #### From Connection Data Frame ### From Incidence Matrix ### Customize Colors in Sankey Diagram #### Custom Color of Individual Nodes ### Set Color for Groups of Nodes ### Set Color of Connections ### Sankey Diagram Interactive #### Definition ### What For ### Variation ### Arc Diagram #### Definition ### Arc Diagrams  ### Common Mistakes ### Hierarchical Edge Bundling #### What is Hierarchical Edge Bundling? ### Introduction to Hierarchical Edge Bundling with R #### Input Data #### Visualizing the Hierarchy ### Add a Few Connections ### Hierarchical Edge Bundling ### Customize Hierarchical Edge Bundling #### Basic Hierarchical Edge Bundling ### Playing with</code>tension`</a></li>
<li class="chapter" data-level="10.1.2" data-path="flow.html"><a href="flow.html#connection-features"><i class="fa fa-check"></i><b>10.1.2</b> Connection Features</a></li>
<li class="chapter" data-level="10.1.3" data-path="flow.html"><a href="flow.html#node-features"><i class="fa fa-check"></i><b>10.1.3</b> Node Features</a></li>
<li class="chapter" data-level="10.1.4" data-path="flow.html"><a href="flow.html#without-labels"><i class="fa fa-check"></i><b>10.1.4</b> Without Labels</a></li>
<li class="chapter" data-level="10.1.5" data-path="flow.html"><a href="flow.html#create-the-labels"><i class="fa fa-check"></i><b>10.1.5</b> Create the Labels</a></li>
<li class="chapter" data-level="10.1.6" data-path="flow.html"><a href="flow.html#plot-the-labels"><i class="fa fa-check"></i><b>10.1.6</b> Plot the Labels</a></li>
<li class="chapter" data-level="10.1.7" data-path="flow.html"><a href="flow.html#with-customization"><i class="fa fa-check"></i><b>10.1.7</b> With Customization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="general.html"><a href="general.html"><i class="fa fa-check"></i><b>11</b> General Knowledge</a>
<ul>
<li class="chapter" data-level="11.1" data-path="distributions.html"><a href="distributions.html#ggplot2"><i class="fa fa-check"></i><b>11.1</b> ggplot2</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="correlation.html"><a href="correlation.html#add-text-labels-with-ggplot2"><i class="fa fa-check"></i><b>11.1.1</b> Add Text Labels with ggplot2</a></li>
<li class="chapter" data-level="11.1.2" data-path="correlation.html"><a href="correlation.html#add-labels-with-geom_label"><i class="fa fa-check"></i><b>11.1.2</b> Add Labels with <code>geom_label()</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="correlation.html"><a href="correlation.html#add-one-text-label-only"><i class="fa fa-check"></i><b>11.1.3</b> Add One Text Label Only</a></li>
<li class="chapter" data-level="11.1.4" data-path="correlation.html"><a href="correlation.html#add-labels-for-a-selection-of-marker"><i class="fa fa-check"></i><b>11.1.4</b> Add Labels for a Selection of Marker</a></li>
<li class="chapter" data-level="11.1.5" data-path="general.html"><a href="general.html#how-to-annotate-a-plot-in-ggplot2"><i class="fa fa-check"></i><b>11.1.5</b> How to Annotate a Plot in <code>ggplot2</code></a></li>
<li class="chapter" data-level="11.1.6" data-path="general.html"><a href="general.html#add-shapes-with-annotate"><i class="fa fa-check"></i><b>11.1.6</b> Add Shapes with <code>annotate()</code></a></li>
<li class="chapter" data-level="11.1.7" data-path="general.html"><a href="general.html#add-ablines-with-geom_hline-and-geom_vline"><i class="fa fa-check"></i><b>11.1.7</b> Add Ablines with <code>geom_hline()</code> and <code>geom_vline()</code></a></li>
<li class="chapter" data-level="11.1.8" data-path="general.html"><a href="general.html#add-a-point-and-a-range-with-pointrange"><i class="fa fa-check"></i><b>11.1.8</b> Add a Point and a Range with <code>pointrange()</code></a></li>
<li class="chapter" data-level="11.1.9" data-path="correlation.html"><a href="correlation.html#ggplot2-scatterplot-with-rug"><i class="fa fa-check"></i><b>11.1.9</b> Ggplot2 Scatterplot with Rug</a></li>
<li class="chapter" data-level="11.1.10" data-path="distributions.html"><a href="distributions.html#marginal-distribution-with-ggplot2-and-ggextra"><i class="fa fa-check"></i><b>11.1.10</b> Marginal Distribution with ggplot2 and ggExtra</a></li>
<li class="chapter" data-level="11.1.11" data-path="distributions.html"><a href="distributions.html#more-customization"><i class="fa fa-check"></i><b>11.1.11</b> More Customization</a></li>
<li class="chapter" data-level="11.1.12" data-path="general.html"><a href="general.html#axis-manipulation-with-r-and-ggplot2"><i class="fa fa-check"></i><b>11.1.12</b> Axis Manipulation with R and ggplot2</a></li>
<li class="chapter" data-level="11.1.13" data-path="general.html"><a href="general.html#set-axis-title-and-limits-with-xlab-and-xlim"><i class="fa fa-check"></i><b>11.1.13</b> Set Axis Title and Limits with <code>xlab()</code> and <code>xlim()</code></a></li>
<li class="chapter" data-level="11.1.14" data-path="general.html"><a href="general.html#customize-axis-title-appearance-axis.title"><i class="fa fa-check"></i><b>11.1.14</b> Customize Axis Title Appearance: <strong>axis.title</strong></a></li>
<li class="chapter" data-level="11.1.15" data-path="general.html"><a href="general.html#customize-axis-labels-axis.text"><i class="fa fa-check"></i><b>11.1.15</b> Customize Axis Labels: <strong>axis.text</strong></a></li>
<li class="chapter" data-level="11.1.16" data-path="general.html"><a href="general.html#customize-axis-ticks-and-axis-line-with-axis.ticks-and-axis.line"><i class="fa fa-check"></i><b>11.1.16</b> Customize Axis Ticks and Axis Line with <code>axis.ticks()</code> and <code>axis.line()</code></a></li>
<li class="chapter" data-level="11.1.17" data-path="general.html"><a href="general.html#background-manipulation-with-r-and-ggplot2"><i class="fa fa-check"></i><b>11.1.17</b> Background Manipulation with R and ggplot2</a></li>
<li class="chapter" data-level="11.1.18" data-path="general.html"><a href="general.html#background-color-plot.background-and-panel.background"><i class="fa fa-check"></i><b>11.1.18</b> Background Color: <strong>plot.background</strong> and <strong>panel.background</strong></a></li>
<li class="chapter" data-level="11.1.19" data-path="general.html"><a href="general.html#customize-the-grid-panel.grid.major-and-panel.grid.minor"><i class="fa fa-check"></i><b>11.1.19</b> Customize the Grid: <code>panel.grid.major</code> and <code>panel.grid.minor</code></a></li>
<li class="chapter" data-level="11.1.20" data-path="general.html"><a href="general.html#building-a-nice-legend-with-r-and-ggplot2"><i class="fa fa-check"></i><b>11.1.20</b> Building a Nice Legend with R and ggplot2</a></li>
<li class="chapter" data-level="11.1.21" data-path="general.html"><a href="general.html#change-legend-title-with-labs"><i class="fa fa-check"></i><b>11.1.21</b> Change Legend Title with <code>labs()</code></a></li>
<li class="chapter" data-level="11.1.22" data-path="general.html"><a href="general.html#get-rid-of-the-legend-guides-and-theme"><i class="fa fa-check"></i><b>11.1.22</b> Get Rid of the Legend: <code>guides()</code> and <code>theme()</code></a></li>
<li class="chapter" data-level="11.1.23" data-path="general.html"><a href="general.html#control-legend-position-with-legend.position"><i class="fa fa-check"></i><b>11.1.23</b> Control Legend Position with legend.position</a></li>
<li class="chapter" data-level="11.1.24" data-path="general.html"><a href="general.html#legend-appearance"><i class="fa fa-check"></i><b>11.1.24</b> Legend Appearance</a></li>
<li class="chapter" data-level="11.1.25" data-path="general.html"><a href="general.html#title-manipulation-with-r-and-ggplot2"><i class="fa fa-check"></i><b>11.1.25</b> Title Manipulation with R and ggplot2</a></li>
<li class="chapter" data-level="11.1.26" data-path="general.html"><a href="general.html#title-on-several-lines"><i class="fa fa-check"></i><b>11.1.26</b> Title on Several Lines</a></li>
<li class="chapter" data-level="11.1.27" data-path="general.html"><a href="general.html#title-appearance-and-position"><i class="fa fa-check"></i><b>11.1.27</b> Title Appearance and Position</a></li>
<li class="chapter" data-level="11.1.28" data-path="general.html"><a href="general.html#customize-a-specific-word-only"><i class="fa fa-check"></i><b>11.1.28</b> Customize a Specific Word Only</a></li>
<li class="chapter" data-level="11.1.29" data-path="general.html"><a href="general.html#faceting-with-ggplot2"><i class="fa fa-check"></i><b>11.1.29</b> Faceting with ggplot2</a></li>
<li class="chapter" data-level="11.1.30" data-path="general.html"><a href="general.html#faceting-with-facet_wrap"><i class="fa fa-check"></i><b>11.1.30</b> Faceting with <code>facet_wrap()</code></a></li>
<li class="chapter" data-level="11.1.31" data-path="general.html"><a href="general.html#facet_grid"><i class="fa fa-check"></i><b>11.1.31</b> <code>facet_grid()</code></a></li>
<li class="chapter" data-level="11.1.32" data-path="general.html"><a href="general.html#multiple-ggplot2-charts-on-a-single-page"><i class="fa fa-check"></i><b>11.1.32</b> Multiple ggplot2 Charts on a Single Page</a></li>
<li class="chapter" data-level="11.1.33" data-path="general.html"><a href="general.html#using-r-and-ggplot2-for-data-art."><i class="fa fa-check"></i><b>11.1.33</b> Using R and ggplot2 for Data Art.</a></li>
<li class="chapter" data-level="11.1.34" data-path="general.html"><a href="general.html#r-snail"><i class="fa fa-check"></i><b>11.1.34</b> R Snail</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="general.html"><a href="general.html#caveats"><i class="fa fa-check"></i><b>11.2</b> Caveats</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/kyle-w-brown" target="blank">Kyle W. Brown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Gallery Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="use-the-cartography-library-to-do-the-choropleth-map" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Use the cartography library to do the choropleth map</h1>
<p>library(cartography)</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb41-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nuts2006)</span>
<span id="cb41-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a choropleth</span></span>
<span id="cb41-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">choroLayer</span>(<span class="at">spdf =</span> nuts2.spdf, <span class="at">df =</span> nuts2.df, <span class="at">var =</span> <span class="st">&quot;pop2008&quot;</span> , <span class="at">legend.pos =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb41-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Population in 2008&quot;</span>)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/175-choropleth-map-cartography-pkg_files/figure-html/thecode-1.png" /></p>
<div id="data-provided-in-a-shape-file" class="section level3" number="9.0.1">
<h3><span class="header-section-number">9.0.1</span> Data Provided in a Shape File</h3>
<p>The <code>cartography</code> package is a very good alternative to the <a href="https://www.r-graph-gallery.com/bubble-map.html">other tools</a> presented in the gallery for building maps.</p>
<p>It notably allows to:</p>
<ul>
<li>Display a legend with embedded circles</li>
<li>Add data sources on the bottom of the chart</li>
<li>Show north / south</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the shape file from the web and unzip it:</span></span>
<span id="cb42-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#download.file(&quot;http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip&quot; , destfile=&quot;world_shape_file.zip&quot;)</span></span>
<span id="cb42-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;unzip world_shape_file.zip&quot;)</span></span>
<span id="cb42-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load it as a geospatial object in R</span></span>
<span id="cb42-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb42-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb42-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-9" aria-hidden="true" tabindex="-1"></a>my_spdf <span class="ot">&lt;-</span> <span class="fu">shapefile</span>(<span class="st">&quot;C:/Users/kwilliam/Downloads/world_shape_file/TM_WORLD_BORDERS_SIMPL-0.3.shp&quot;</span>)</span>
<span id="cb42-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-11" aria-hidden="true" tabindex="-1"></a>africa <span class="ot">&lt;-</span> my_spdf[my_spdf<span class="sc">@</span>data<span class="sc">$</span>REGION<span class="sc">==</span><span class="dv">2</span> , ]</span>
<span id="cb42-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-13" aria-hidden="true" tabindex="-1"></a>africa<span class="sc">@</span>data<span class="sc">$</span>POP2005 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(africa<span class="sc">@</span>data<span class="sc">$</span>POP2005)</span>
<span id="cb42-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the cartography library to do the choropleth map</span></span>
<span id="cb42-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartography)</span>
<span id="cb42-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="fu">choroLayer</span>(<span class="at">spdf =</span> africa, <span class="at">df =</span> africa<span class="sc">@</span>data, <span class="at">var =</span> <span class="st">&quot;POP2005&quot;</span>)</span>
<span id="cb42-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Number of people living in Africa in 2005&quot;</span>)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/175-choropleth-map-cartography-pkg_files/figure-html/thecode2-1.png" /></p>
</div>
<div id="customized-choropleth-map-with-the-cartography-package" class="section level3" number="9.0.2">
<h3><span class="header-section-number">9.0.2</span> Customized Choropleth Map with the Cartography Package</h3>
<p>The <code>cartography</code> package is a great alternative to make maps with R. This section explains how to build a customized <a href="https://www.r-graph-gallery.com/choropleth-map.html">choropleth</a> map using it, with explanation and reproducible code.</p>
<p>The <code>cartography</code> package is a very good alternative to the <a href="https://www.r-graph-gallery.com/bubble-map.html">other tools</a> presented in the gallery for building maps.</p>
<p>It notably allows to:</p>
<ul>
<li>Display a legend with embedded circles</li>
<li>Add data sources on the bottom of the chart</li>
<li>Show north / south</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cartography Library</span></span>
<span id="cb43-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartography)</span>
<span id="cb43-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb43-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Upload data attached with the package.</span></span>
<span id="cb43-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nuts2006)</span>
<span id="cb43-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb43-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have a spdf file (shape file) called nuts2.spdf with shape of european regions.</span></span>
<span id="cb43-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We also have a dataframe with information concerning every region.Both object have a first column &quot;id&quot; that makes the link between them.</span></span>
<span id="cb43-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nuts2.df)</span></code></pre></div>
<pre><code>##        id emp2008 act2008 unemp2008 birth_2008 death_2008 gdppps1999 gdppps2008
## 383  AT11   137.0   142.1       5.1       2215       3067       4139       5695
## 384  AT12   792.3   820.3      28.0      14085      15616      28799      40998
## 385  AT13   784.6   841.4      56.7      17375      15702      51431      68722
## 789  AT21   263.4   272.8       9.4       4718       5385      10886      14632
## 1192 AT22   586.5   607.0      20.5      10255      11725      23436      32457
## 368  AT31   714.1   733.4      19.2      13540      11966      30468      43300
##      pop1999 pop2008
## 383   276732  281185
## 384  1530745 1596538
## 385  1542252 1674909
## 789   560938  560322
## 1192 1183374 1204947
## 368  1366578 1406664</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Annual growth per region</span></span>
<span id="cb45-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-2" aria-hidden="true" tabindex="-1"></a>nuts2.df<span class="sc">$</span>cagr <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> (((nuts2.df<span class="sc">$</span>pop2008<span class="sc">/</span>nuts2.df<span class="sc">$</span>pop1999)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>)) <span class="sc">-</span>  <span class="dv">1</span>)</span>
<span id="cb45-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a color palette</span></span>
<span id="cb45-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-5" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">carto.pal</span>(<span class="at">pal1 =</span> <span class="st">&quot;green.pal&quot;</span>, <span class="at">n1 =</span> <span class="dv">2</span>, <span class="at">pal2 =</span> <span class="st">&quot;red.pal&quot;</span>, <span class="at">n2 =</span> <span class="dv">4</span>)</span>
<span id="cb45-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot backgroud shapes (sea and world)</span></span>
<span id="cb45-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nuts0.spdf, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="st">&quot;#A6CAE0&quot;</span>)</span>
<span id="cb45-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world.spdf, <span class="at">col =</span> <span class="st">&quot;#E3DEBF&quot;</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add annual growth</span></span>
<span id="cb45-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">choroLayer</span>(<span class="at">spdf =</span> nuts2.spdf, <span class="at">df =</span> nuts2.df, <span class="at">var =</span> <span class="st">&quot;cagr&quot;</span>, </span>
<span id="cb45-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.43</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">3.1</span>), <span class="at">col =</span> cols, </span>
<span id="cb45-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">border =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>, <span class="at">legend.pos =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb45-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title.txt =</span> <span class="st">&quot;taux de croissance</span><span class="sc">\n</span><span class="st">annuel moyen&quot;</span>, </span>
<span id="cb45-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.values.rnd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add borders</span></span>
<span id="cb45-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nuts0.spdf, <span class="at">border =</span> <span class="st">&quot;grey20&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.75</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add titles, legend ...</span></span>
<span id="cb45-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="fu">layoutLayer</span>(<span class="at">title =</span> <span class="st">&quot;Growth rate in Europe&quot;</span>, </span>
<span id="cb45-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">author =</span> <span class="st">&quot;cartography&quot;</span>, <span class="at">sources =</span> <span class="st">&quot;Eurostat, 2008&quot;</span>, </span>
<span id="cb45-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">coltitle =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb45-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">south =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="hexbin-maps" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Hexbin Maps</h2>
<hr />
<p>A <a href="https://www.data-to-viz.com/graph/hexbinmap.html">hexbin</a> map refers to two different concepts. It can be based on a geospatial object where all regions of the map are represented as hexagons. Or it can refer to a 2d density technique described in <a href="https://www.r-graph-gallery.com/2d-density-chart.html">this section</a>. This section of the gallery provides several examples with step by step explanations.</p>
<div id="hexbin-map-from-geospatial-object" class="section level4" number="9.1.0.1">
<h4><span class="header-section-number">9.1.0.1</span> Hexbin Map from Geospatial Object</h4>
<p>In this case, the technique is very close from a <a href="https://www.r-graph-gallery.com/choropleth.html">choropleth map</a>. Its actually exactly the same, except that the geoJson input gives hexagon boundaries instead of region boundaries. Thus, you probably want to visit the <a href="https://www.r-graph-gallery.com/choropleth.html">choropleth section</a> for more examples.</p>
</div>
<div id="hexbin-map-in-r-example-with-us-states" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Hexbin Map in R: Example with US states</h3>
<p>This section describes how to build a <a href="https://www.r-graph-gallery.com/hexbin-map.html">hexbin map</a>. It is based on a <code>geojson</code> file providing the boundaries of us states as hexagons.</p>
<div id="basic-hexbin-map" class="section level4" number="9.1.1.1">
<h4><span class="header-section-number">9.1.1.1</span> Basic Hexbin Map</h4>
<p>The first step is to build a basic <a href="https://www.r-graph-gallery.com/hexbin-map.html">hexbin map</a> of the US. Note that the gallery dedicates a <a href="https://www.r-graph-gallery.com/hexbin-map.html">whole section</a> to this kind of map.</p>
<p>Hexagones boundaries are provided <a href="https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map">here</a>. You have to download it at the <code>geojson</code> format and load it in R thanks to the <code>geojson_read()</code> function. You get a geospatial object that you can plot using the <code>plot()</code> function. This is widely explained in the <a href="https://www.r-graph-gallery.com/map.html">background map</a> section of the gallery.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library</span></span>
<span id="cb46-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span>
<span id="cb46-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb46-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb46-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the Hexagones boundaries at geojson format here: https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map.</span></span>
<span id="cb46-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load this file. (Note: I stored in a folder called DATA)</span></span>
<span id="cb46-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-10" aria-hidden="true" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">geojson_read</span>(<span class="st">&quot;C:/Users/kwilliam/Downloads/us_states_hexgrid.geojson&quot;</span>,  <span class="at">what =</span> <span class="st">&quot;sp&quot;</span>)</span>
<span id="cb46-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Bit of reformating</span></span>
<span id="cb46-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-13" aria-hidden="true" tabindex="-1"></a>spdf<span class="sc">@</span>data <span class="ot">=</span> spdf<span class="sc">@</span>data <span class="sc">%&gt;%</span></span>
<span id="cb46-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">google_name =</span> <span class="fu">gsub</span>(<span class="st">&quot; </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, google_name))</span>
<span id="cb46-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show it</span></span>
<span id="cb46-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spdf)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="ggplot2-and-state-name" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> <code>ggplot2</code> and State Name</h3>
<p>It is totally doable to plot this geospatial object using <code>ggplot2</code> and its <code>geom_polygon()</code> function, but we first need to <code>fortify</code> it using the <code>broom</code> package.</p>
<p>Moreover, the <code>rgeos</code> package is used here to compute the centroid of each region thanks to the <code>gCentroid</code> function.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I need to &#39;fortify&#39; the data to be able to show it with ggplot2 (we need a data frame format)</span></span>
<span id="cb47-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb47-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-3" aria-hidden="true" tabindex="-1"></a>spdf<span class="sc">@</span>data <span class="ot">=</span> spdf<span class="sc">@</span>data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">google_name =</span> <span class="fu">gsub</span>(<span class="st">&quot; </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, google_name))</span>
<span id="cb47-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-4" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">&lt;-</span> <span class="fu">tidy</span>(spdf, <span class="at">region =</span> <span class="st">&quot;google_name&quot;</span>)</span>
<span id="cb47-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the centroid of each hexagon to add the label:</span></span>
<span id="cb47-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span>
<span id="cb47-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-8" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">data.frame</span>(<span class="fu">gCentroid</span>(spdf, <span class="at">byid=</span><span class="cn">TRUE</span>), <span class="at">id=</span>spdf<span class="sc">@</span>data<span class="sc">$</span>iso3166_2))</span>
<span id="cb47-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Now I can plot this shape easily as described before:</span></span>
<span id="cb47-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> spdf_fortified, <span class="fu">aes</span>( <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;skyblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>centers, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">label=</span>id)) <span class="sc">+</span></span>
<span id="cb47-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb47-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="basic-choropleth" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Basic Choropleth</h3>
<p>Now you probably want to adjust the color of each hexagon, according to the value of a specific variable (we call it a <a href="https://www.r-graph-gallery.com/chloropleth-map.html">choropleth map</a>).</p>
<p>In this section a suggestion to represent the number of wedding per thousand people. The data have been found <a href="https://www.cdc.gov/nchs/nvss/marriage-divorce.html">here</a>, and stored on a clean format <a href="https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/State_mariage_rate.csv">here</a>.</p>
<p>Lets start by loading this information and represent its distribution:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load mariage data</span></span>
<span id="cb48-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/State_mariage_rate.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">na.strings=</span><span class="st">&quot;---&quot;</span>)</span>
<span id="cb48-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb48-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of the marriage rate?</span></span>
<span id="cb48-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-5" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>y_2015)) <span class="sc">+</span> </span>
<span id="cb48-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">fill=</span><span class="st">&#39;#69b3a2&#39;</span>, <span class="at">color=</span><span class="st">&#39;white&#39;</span>) <span class="sc">+</span> </span>
<span id="cb48-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">30</span>))</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Most of the state have between 5 and 10 weddings per 1000 inhabitants, but there are 2 outliers with high values (16 and 32).</p>
<p>Lets represent this information on a map. We have a column with the state id in both the geospatial and the numerical datasets. So we can merge both information and plot it.</p>
<p>Note the use of the <code>trans = "log"</code> option in the color scale to decrease the effect of the 2 outliers.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge geospatial and numerical information</span></span>
<span id="cb49-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-2" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">&lt;-</span> spdf_fortified <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(. , data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;state&quot;</span>)) </span>
<span id="cb49-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb49-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a first chloropleth map</span></span>
<span id="cb49-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> spdf_fortified, <span class="fu">aes</span>(<span class="at">fill =</span>  y_2015, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb49-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">trans =</span> <span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb49-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="customized-hexbin-choropleth-map" class="section level3" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Customized Hexbin Choropleth Map</h3>
<p>Here is a final version after applying a few customization:</p>
<ul>
<li>Use handmade binning for the colorscale with <code>scale_fill_manual</code>.</li>
<li>Use <code>viridis</code> for the color palette.</li>
<li>Add custom legend and title.</li>
<li>Change background color.</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare binning</span></span>
<span id="cb50-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-2" aria-hidden="true" tabindex="-1"></a>spdf_fortified<span class="sc">$</span>bin <span class="ot">&lt;-</span> <span class="fu">cut</span>( spdf_fortified<span class="sc">$</span>y_2015 , <span class="at">breaks=</span><span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="cn">Inf</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;5-6&quot;</span>, <span class="st">&quot;6-7&quot;</span>, <span class="st">&quot;7-8&quot;</span>, <span class="st">&quot;8-9&quot;</span>, <span class="st">&quot;9-10&quot;</span>, <span class="st">&quot;10+&quot;</span> ), <span class="at">include.lowest =</span> <span class="cn">TRUE</span> )</span>
<span id="cb50-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare a color scale coming from the viridis color palette</span></span>
<span id="cb50-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb50-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-6" aria-hidden="true" tabindex="-1"></a>my_palette <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">magma</span>(<span class="dv">8</span>))[<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">8</span>)]</span>
<span id="cb50-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb50-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> spdf_fortified, <span class="fu">aes</span>(<span class="at">fill =</span> bin, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>centers, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">label=</span>id), <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb50-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>( </span>
<span id="cb50-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values=</span>my_palette, </span>
<span id="cb50-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">name=</span><span class="st">&quot;Wedding per 1000 people in 2015&quot;</span>, </span>
<span id="cb50-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>) </span>
<span id="cb50-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">&quot;A map of marriage rates, state by state&quot;</span> ) <span class="sc">+</span></span>
<span id="cb50-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb50-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.9</span>),</span>
<span id="cb50-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb50-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb50-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb50-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb50-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">22</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb50-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb50-26" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="hexbin-map-from-list-of-coordinates" class="section level3" number="9.1.5">
<h3><span class="header-section-number">9.1.5</span> Hexbin Map from List of Coordinates</h3>
<p>In this case, the required input is a list of coordinates. The map area is split in a multitude of hexagons with <code>geom_hex()</code> (or squares with <code>geom_bin2d()</code>), the number of data point per hexagon is counted and represented as a color. It is actually a <a href="https://www.r-graph-gallery.com/2d-density-chart.html">density 2d</a> technique plotted on top of a map.</p>
</div>
<div id="hexbin-map-for-2d-density-visualization" class="section level3" number="9.1.6">
<h3><span class="header-section-number">9.1.6</span> Hexbin Map for 2D Density Visualization</h3>
<p>It is possible to apply <a href="https://www.r-graph-gallery.com/2d-density-chart.html">2d density</a> visualization methods on map to study the geographical distribution of a variable. The two most famous techniques beeing <a href="https://www.r-graph-gallery.com/hexbin-map.html">Hexbin maps</a> and 2d histogram maps. This section describes how to build it with R and <code>ggplot2</code>.</p>
<div id="d-histogram-maps" class="section level4" number="9.1.6.1">
<h4><span class="header-section-number">9.1.6.1</span> 2D Histogram Maps</h4>
<p>For 2d histogram maps the globe is split in several squares, the number of tweet per square is counted, and a color is attributed to each square.</p>
<ul>
<li><code>ggplot2</code> offers the <code>geom_bin2d()</code> function that does all the calculation for us and plot the squares.</li>
<li>The <code>geom_polygon()</code> function is used to show the world map in the background.</li>
<li><code>ggplot2::annotate()</code> is used to add a title.</li>
<li>The guide option of <code>scale_fill_viridis</code> is used to create a nice legend.</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb51-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb51-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb51-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb51-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapdata)</span>
<span id="cb51-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from github</span></span>
<span id="cb51-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/17_ListGPSCoordinates.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb51-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the world polygon</span></span>
<span id="cb51-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-11" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>)</span>
<span id="cb51-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb51-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>homelon, <span class="at">y=</span>homelat)) <span class="sc">+</span> </span>
<span id="cb51-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> world, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bin2d</span>(<span class="at">bins=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb51-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-17" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">175</span>, <span class="at">y =</span> <span class="dv">80</span>, <span class="at">label=</span><span class="st">&quot;Where people tweet about #Surf&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-18" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">100</span>, <span class="at">xend =</span> <span class="dv">175</span>, <span class="at">y =</span> <span class="dv">73</span>, <span class="at">yend =</span> <span class="dv">73</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb51-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">70</span>, <span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb51-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(</span>
<span id="cb51-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">trans =</span> <span class="st">&quot;log&quot;</span>, </span>
<span id="cb51-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">54</span>,<span class="dv">403</span>,<span class="dv">3000</span>),</span>
<span id="cb51-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">name=</span><span class="st">&quot;Tweet # recorded in 8 months&quot;</span>, </span>
<span id="cb51-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">2.5</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>) </span>
<span id="cb51-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-26" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">+</span></span>
<span id="cb51-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>( <span class="st">&quot;&quot;</span> ) <span class="sc">+</span></span>
<span id="cb51-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb51-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.09</span>),</span>
<span id="cb51-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb51-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb51-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">13</span>, <span class="at">hjust=</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb51-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb51-33" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
</div>
<div id="hexbin-maps-1" class="section level3" number="9.1.7">
<h3><span class="header-section-number">9.1.7</span> Hexbin Maps</h3>
<p>Hexbin maps are done using pretty much the same code.</p>
<p>Here, <code>geom_hex()</code> is used to create the hexagones. Note the bins option allowing to control the bin size, and thus the hexagone size on the map.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb52-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb52-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb52-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb52-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapdata)</span>
<span id="cb52-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from github</span></span>
<span id="cb52-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/17_ListGPSCoordinates.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb52-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb52-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-11" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(homecontinent<span class="sc">==</span><span class="st">&#39;Europe&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>homelon, <span class="at">y=</span>homelat)) <span class="sc">+</span> </span>
<span id="cb52-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hex</span>(<span class="at">bins=</span><span class="dv">59</span>) <span class="sc">+</span></span>
<span id="cb52-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-15" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">27</span>, <span class="at">y =</span> <span class="dv">72</span>, <span class="at">label=</span><span class="st">&quot;Where people tweet about #Surf&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">5</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-16" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">27</span>, <span class="at">xend =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">70</span>, <span class="at">yend =</span> <span class="dv">70</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb52-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb52-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">70</span>) <span class="sc">+</span></span>
<span id="cb52-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">24</span>, <span class="dv">72</span>) <span class="sc">+</span></span>
<span id="cb52-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(</span>
<span id="cb52-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">option=</span><span class="st">&quot;B&quot;</span>,</span>
<span id="cb52-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">trans =</span> <span class="st">&quot;log&quot;</span>, </span>
<span id="cb52-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">54</span>,<span class="dv">403</span>,<span class="dv">3000</span>),</span>
<span id="cb52-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">name=</span><span class="st">&quot;Tweet # recorded in 8 months&quot;</span>, </span>
<span id="cb52-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">2.5</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>) </span>
<span id="cb52-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-26" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">+</span></span>
<span id="cb52-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>( <span class="st">&quot;&quot;</span> ) <span class="sc">+</span></span>
<span id="cb52-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb52-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.09</span>),</span>
<span id="cb52-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb52-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb52-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb52-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb52-34"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb52-35"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">13</span>, <span class="at">hjust=</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb52-36"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb52-36" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="cartogram" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Cartogram</h2>
<hr />
<p>A <a href="https://www.data-to-viz.com/graph/cartogram.html">cartogram</a> is a map in which the geometry of regions is distorted in order to convey the information of an alternate variable. The region area will be inflated or deflated according to its numeric value. In R, the <code>cartogram</code> package is the best way to build it, as illustrated in the examples below.</p>
<div id="the-cartogram-package-step-by-step" class="section level4" number="9.2.0.1">
<h4><span class="header-section-number">9.2.0.1</span> The Cartogram Package: Step by Step</h4>
<p>The cartogram package allows to build cartograms in R. It requires a <code>geospatial object</code> as input, with a numeric variable in the data slot. This variable will be used to distort region shape. The following example will guide you through the process:</p>
</div>
<div id="basic-cartogram-with-r" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Basic Cartogram with R</h3>
<p>This section describes how to build a very simple <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a> with <code>R</code> and the <code>cartogram</code> package. It is a step a step approach leading to a choropleth map with distorted region size.</p>
<div id="very-basic-map" class="section level4" number="9.2.1.1">
<h4><span class="header-section-number">9.2.1.1</span> Very Basic Map</h4>
<p>A <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a> is a map in which the geometry of regions is distorted in order to convey the information of an alternate variable. In this section, we are going to draw a map of Africa where the size of each country is distorted proportionally to its population.</p>
<p>First of all, you need to understand what a geospatial object is, and how to plot it with <code>R</code>. See the <a href="https://www.r-graph-gallery.com/map.html">background map section</a> of the gallery!</p>
<p>Lets use the <code>maptools</code> library which provides a geospatial object with the Africas boundaries. Note that you can get a similar object from a shapefile, or from a geojson file!</p>
<p>We can plot the boundaries using the <code>plot()</code> function:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the shape file of Africa</span></span>
<span id="cb53-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptools)</span>
<span id="cb53-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(wrld_simpl)</span>
<span id="cb53-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-4" aria-hidden="true" tabindex="-1"></a>afr<span class="ot">=</span>wrld_simpl[wrld_simpl<span class="sc">$</span>REGION<span class="sc">==</span><span class="dv">2</span>,]</span>
<span id="cb53-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We can visualize the region&#39;s boundaries with the plot function</span></span>
<span id="cb53-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(afr)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
</div>
<div id="distort-country-size-with-cartogram" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Distort Country Size with <code>cartogram</code></h3>
<p>The geospatial object has a <code>data slot</code>: an attached data frame that provides several information for each region. It notably gives the population of each country in 2005.</p>
<p>We can thus use the <code>cartogram</code> library to distort the size of each country, proportionally to this column. The new geospatial object we get can be draw with the same <code>plot</code> function!</p>
<p>See how Nigeria is now bigger?</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We work with the cartogram library </span></span>
<span id="cb54-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartogram)</span>
<span id="cb54-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># construct a cartogram using the population in 2005</span></span>
<span id="cb54-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-5" aria-hidden="true" tabindex="-1"></a>afr_cartogram <span class="ot">&lt;-</span> <span class="fu">cartogram</span>(afr, <span class="st">&quot;POP2005&quot;</span>, <span class="at">itermax=</span><span class="dv">5</span>)</span>
<span id="cb54-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a new geospatial object, we can visualise it!</span></span>
<span id="cb54-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(afr_cartogram)</span></code></pre></div>
<center>
<img src="https://www.r-graph-gallery.com/331-basic-cartogram_files/figure-html/thecode2-1.png" />
</center>
</div>
<div id="cartogram-and-choropleth" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Cartogram and Choropleth</h3>
<p>Cartogram are very often used in combination with <a href="https://www.r-graph-gallery.com/chloropleth-map.html">choropleth map</a>. Since we have a spatial object and a numeric value associated with each region, it is possible to color each region according to its value.</p>
<p>Lets use <a href="https://www.r-graph-gallery.com/ggplot2-package.html">ggplot2</a> to add some color, title, legend, background and so on. We now have a nice cartogram chloropleth map of Africa!</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It is a new geospatial object: we can use all the usual techniques on it! Let&#39;s start with a basic ggplot2 chloropleth map:</span></span>
<span id="cb55-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb55-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb55-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-4" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">&lt;-</span> <span class="fu">tidy</span>(afr_cartogram)</span>
<span id="cb55-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-5" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">=</span> spdf_fortified <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(. , afr_cartogram<span class="sc">@</span>data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;ISO3&quot;</span>)) </span>
<span id="cb55-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> spdf_fortified, <span class="fu">aes</span>(<span class="at">fill =</span> POP2005, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb55-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>() <span class="sc">+</span></span>
<span id="cb55-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<center>
<img src="https://www.r-graph-gallery.com/331-basic-cartogram_files/figure-html/thecode3-1.png" />
</center>
</div>
<div id="make-it-pretty" class="section level3" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Make it Pretty</h3>
<p>Same thing with a tiny bit of customization. See more explanation in the <a href="https://www.r-graph-gallery.com/choropleth.html">choropleth</a> an <a href="https://www.r-graph-gallery.com/ggplot2-package.html">ggplot2</a> sections.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># As seen before, we can do better with a bit of customization</span></span>
<span id="cb56-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb56-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb56-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> spdf_fortified, <span class="fu">aes</span>(<span class="at">fill =</span> POP2005<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb56-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb56-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">name=</span><span class="st">&quot;Population (M)&quot;</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">140</span>), <span class="at">guide =</span> <span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb56-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Africa 2005 Population&quot;</span> ) <span class="sc">+</span></span>
<span id="cb56-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">35</span>,<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb56-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb56-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>), </span>
<span id="cb56-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb56-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb56-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb56-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">22</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="co">#margin(b = -0.1, t = 0.4, l = 2, unit = &quot;cm&quot;)),</span></span>
<span id="cb56-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.26</span>)</span>
<span id="cb56-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-16" aria-hidden="true" tabindex="-1"></a> ) <span class="sc">+</span></span>
<span id="cb56-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb56-17" aria-hidden="true" tabindex="-1"></a> <span class="fu">coord_map</span>()</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/331-basic-cartogram_files/figure-html/thecode4-1.png" />
&lt;</p>
</div>
<div id="application-on-hexbin-map" class="section level3" number="9.2.5">
<h3><span class="header-section-number">9.2.5</span> Application on Hexbin Map</h3>
<p>A <a href="https://www.r-graph-gallery.com/hexbin-map.html">hexbin map</a> is a map where each region is represented as an hexagon. It is possible to apply a cartogram algorithm to such a map, as suggested in the example below. Note that you probably want to explore the <a href="https://www.r-graph-gallery.com/hexbin-map.html">hexbin map</a> section before making a cartogram with it.</p>
</div>
<div id="basic-cartogram-with-r-1" class="section level3" number="9.2.6">
<h3><span class="header-section-number">9.2.6</span> Basic Cartogram with R</h3>
<p>This section describes how to apply the <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a> method to a <a href="https://www.r-graph-gallery.com/hexbin-map">hexbin map</a>. Each region is represented as a hexagon which size is distorted according to a numeric variable. It uses the <code>cartogram</code> package.</p>
<div id="basic-hexbin-map-1" class="section level4" number="9.2.6.1">
<h4><span class="header-section-number">9.2.6.1</span> Basic Hexbin Map</h4>
<p>The first step is to build a basic <a href="https://www.r-graph-gallery.com/hexbin-map.html">hexbin map</a> of the US. Note that the gallery dedicates a <a href="https://www.r-graph-gallery.com/hexbin-map.html">whole section</a> to this kind of map.</p>
<p>Hexagones boundaries are provided <a href="https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map">here</a>. You have to download it at the <code>geojson</code> format and load it in R thanks to the <code>geojson_read()</code> function. You get a geospatial object that you can plot using the <code>plot()</code> function. This is widely explained in the <a href="https://www.r-graph-gallery.com/map.html">background map</a> section of the gallery.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library</span></span>
<span id="cb57-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span>
<span id="cb57-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb57-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb57-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the Hexagones boundaries at geojson format here: https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map.</span></span>
<span id="cb57-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load this file. (Note: I stored in a folder called DATA)</span></span>
<span id="cb57-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-10" aria-hidden="true" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">geojson_read</span>(<span class="st">&quot;C:/Users/kwilliam/Downloads/us_states_hexgrid.geojson&quot;</span>,  <span class="at">what =</span> <span class="st">&quot;sp&quot;</span>)</span>
<span id="cb57-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Bit of reformating</span></span>
<span id="cb57-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-13" aria-hidden="true" tabindex="-1"></a>spdf<span class="sc">@</span>data <span class="ot">=</span> spdf<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb57-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">google_name =</span> <span class="fu">gsub</span>(<span class="st">&quot; </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, google_name))</span>
<span id="cb57-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show it</span></span>
<span id="cb57-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spdf)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
</div>
<div id="distort-hexagone-size-with-cartogram" class="section level3" number="9.2.7">
<h3><span class="header-section-number">9.2.7</span> Distort Hexagone Size with <code>cartogram</code></h3>
<p>The geospatial object has a <strong>data slot</strong>: an attached data frame that provides several information for each region. It is called <code>spdf@data</code> here.</p>
<p>We need to add a new column to this data frame. This column will provide the population per state, available at <code>.csv</code>format <a href="https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/pop_US.csv">here</a>.</p>
<p>We can thus use the <code>cartogram</code> library to distort the size of each state (=hexagon), proportionally to this column. The new geospatial object we get can be drawn with the same <code>plot</code> function.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb58-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartogram)</span>
<span id="cb58-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the population per states (source: https://www.census.gov/data/tables/2017/demo/popest/nation-total.html)</span></span>
<span id="cb58-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-5" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/pop_US.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb58-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-6" aria-hidden="true" tabindex="-1"></a>pop<span class="sc">$</span>pop <span class="ot">&lt;-</span> pop<span class="sc">$</span>pop <span class="sc">/</span> <span class="dv">1000000</span></span>
<span id="cb58-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb58-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># merge both</span></span>
<span id="cb58-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-9" aria-hidden="true" tabindex="-1"></a>spdf<span class="sc">@</span>data <span class="ot">&lt;-</span> spdf<span class="sc">@</span>data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(., pop, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;google_name&quot;</span><span class="ot">=</span><span class="st">&quot;state&quot;</span>))</span>
<span id="cb58-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cartogram, using this population information</span></span>
<span id="cb58-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-12" aria-hidden="true" tabindex="-1"></a>cartogram <span class="ot">&lt;-</span> <span class="fu">cartogram</span>(spdf, <span class="st">&#39;pop&#39;</span>)</span>
<span id="cb58-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb58-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># First look!</span></span>
<span id="cb58-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cartogram)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/332-hexbin-chloropleth-cartogram_files/figure-html/thecode2-1.png" /></p>
</div>
<div id="cartogram-and-choropleth-1" class="section level3" number="9.2.8">
<h3><span class="header-section-number">9.2.8</span> Cartogram and Choropleth</h3>
<p>To get a satisfying result, lets:</p>
<ul>
<li>Color hexagones according to their population</li>
<li>Add legend</li>
<li>Add background color</li>
<li>Add title</li>
<li>Add state name. Label position is computed thanks to the <code>gCentroid()</code> function.</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb59-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co"># for the tidy function</span></span>
<span id="cb59-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos) <span class="co"># for the gcentroid function</span></span>
<span id="cb59-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy data to be drawn by ggplot2 (broom library of the tidyverse)</span></span>
<span id="cb59-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-6" aria-hidden="true" tabindex="-1"></a>carto_fortified <span class="ot">&lt;-</span> <span class="fu">tidy</span>(cartogram, <span class="at">region =</span> <span class="st">&quot;google_name&quot;</span>)</span>
<span id="cb59-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-7" aria-hidden="true" tabindex="-1"></a>carto_fortified <span class="ot">&lt;-</span> carto_fortified <span class="sc">%&gt;%</span> </span>
<span id="cb59-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(. , cartogram<span class="sc">@</span>data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;google_name&quot;</span>)) </span>
<span id="cb59-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb59-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the position of state labels</span></span>
<span id="cb59-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-11" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">data.frame</span>(<span class="fu">gCentroid</span>(cartogram, <span class="at">byid=</span><span class="cn">TRUE</span>), <span class="at">id=</span>cartogram<span class="sc">@</span>data<span class="sc">$</span>iso3166_2))</span>
<span id="cb59-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb59-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb59-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> carto_fortified, <span class="fu">aes</span>(<span class="at">fill =</span> pop, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="fl">0.05</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb59-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours=</span><span class="fu">brewer.pal</span>(<span class="dv">7</span>,<span class="st">&quot;BuPu&quot;</span>), <span class="at">name=</span><span class="st">&quot;population (in M)&quot;</span>, </span>
<span id="cb59-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide=</span><span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), </span>
<span id="cb59-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), </span>
<span id="cb59-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, </span>
<span id="cb59-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>) </span>
<span id="cb59-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>centers, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">label=</span>id), <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb59-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb59-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">&quot;Another look on the US population&quot;</span> ) <span class="sc">+</span></span>
<span id="cb59-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb59-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.9</span>),</span>
<span id="cb59-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb59-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb59-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f9&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb59-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f9&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb59-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f9&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb59-34"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">22</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb59-35"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-36"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb59-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/332-hexbin-chloropleth-cartogram_files/figure-html/thecode3-1.png" /></p>
<div id="animated-version" class="section level4" number="9.2.8.1">
<h4><span class="header-section-number">9.2.8.1</span> Animated Version</h4>
<p>The following example describes extensively how to make a smooth transition between a <a href="https://www.r-graph-gallery.com/chloropleth-map">choropleth map</a> and a <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a>. This is possible thanks to the <code>tweenR</code> and the <code>gganimate</code> libraries. See the explanations <a href="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram.html">here</a>. See the <a href="https://www.r-graph-gallery.com/animation.html">animation section</a> for more examples of animation with <code>R</code>.</p>
</div>
</div>
<div id="a-smooth-transition-between-choropleth-and-cartogram" class="section level3" number="9.2.9">
<h3><span class="header-section-number">9.2.9</span> A Smooth Transition between Choropleth and Cartogram</h3>
<p>This section describes how to make a smooth transition GIF between a <a href="https://www.r-graph-gallery.com/choropleth-map.html">choropleth map</a> and a <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a>. It starts by doing a basic map of Africa and then distorts country size using the <code>cartogram</code> library. <code>ggplot2</code> is used to build a good looking <a href="https://www.r-graph-gallery.com/choropleth-map.html">choropleth</a> map. Animation is made possible thanks to the <code>tweenR</code> and <code>gganimate</code> packages.</p>
<div id="goal-and-packages" class="section level4" number="9.2.9.1">
<h4><span class="header-section-number">9.2.9.1</span> Goal and Packages</h4>
<p>At the end of this tutorial, you should get a <code>gif</code> file containing the following animation.</p>
<p>Before we start, make sure youve got the following libraries:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Please Ignore, specific to a bug in the gallery</span></span>
<span id="cb60-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb60-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_unload</span>(pacman<span class="sc">::</span><span class="fu">p_loaded</span>(), <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb60-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># data wrangling</span></span>
<span id="cb60-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartogram)    <span class="co"># for the cartogram</span></span>
<span id="cb60-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)      <span class="co"># to realize the plots</span></span>
<span id="cb60-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)        <span class="co"># from geospatial format to data frame</span></span>
<span id="cb60-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tweenr)       <span class="co"># to create transition dataframe between 2 states</span></span>
<span id="cb60-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)    <span class="co"># To realize the animation</span></span>
<span id="cb60-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptools)     <span class="co"># world boundaries coordinates</span></span>
<span id="cb60-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)      <span class="co"># for a nice color palette</span></span></code></pre></div>
</div>
</div>
<div id="a-basic-map-of-africa" class="section level3" number="9.2.10">
<h3><span class="header-section-number">9.2.10</span> A Basic Map of Africa</h3>
<p>The <a href="https://cran.r-project.org/web/packages/maptools/maptools.pdf">maptools library</a> provides all the information we need to draw a map of Africa.</p>
<p>All the country boundaries are stored in the <code>world_simpl</code> object. Lets load this object, keep only Africa, and draw a basic representation. This requires only 3 lines of code.</p>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode2-1.png" /></p>
</div>
<div id="compute-cartogram-boundaries" class="section level3" number="9.2.11">
<h3><span class="header-section-number">9.2.11</span> Compute Cartogram Boundaries</h3>
<p>The <code>afr</code> object is a spatial object. Thus it has a data slot that gives a few information concerning each region. You can visualise this info typing <code>afr@data</code> in our case.</p>
<p>You will see a column called <code>POP2005</code>, providing the number of inhabitants per country in 2005.</p>
<p>Using this information we can use the <code>cartogram</code> library to build. a <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a>! Basically, it will distort the shape of every country proportionally to its number of inhabitants.</p>
<p>The output is a new geospatial object that we can map like weve done before. As you can see, Nigeria appears way bigger on this map, since it has a population of about 141M inhabitants.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># construct a cartogram using the population in 2005</span></span>
<span id="cb61-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb61-2" aria-hidden="true" tabindex="-1"></a>afr_cartogram <span class="ot">&lt;-</span> <span class="fu">cartogram</span>(afr, <span class="st">&quot;POP2005&quot;</span>, <span class="at">itermax=</span><span class="dv">7</span>)</span>
<span id="cb61-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb61-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb61-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A basic representation</span></span>
<span id="cb61-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(afr_cartogram)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode3-1.png" /></p>
</div>
<div id="a-nicer-representation-using-ggplot2" class="section level3" number="9.2.12">
<h3><span class="header-section-number">9.2.12</span> A Nicer Representation using <code>ggplot2</code></h3>
<p>Lets improve the appearance of the previous maps using the <a href="https://www.r-graph-gallery.com/ggplot2-package.html">ggplot2</a> library.</p>
<p>Note that <code>ggplot2</code> uses data frame and not geospatial object. The transformation to a data frame is done using the <code>tidy()</code> function of the <code>broom</code> package. Since it does not transfer the data slot automatically, we merge it afterward.</p>
<p>The <code>geom_polygon()</code> function is used to draw map data. See the <a href="https://www.r-graph-gallery.com/327-chloropleth-map-from-geojson-with-ggplot2.html">graph #327</a> of the gallery for more explanation on <a href="https://www.r-graph-gallery.com/choropleth-map.html">choropleth</a> maps with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform these 2 objects in dataframe, plotable with ggplot2</span></span>
<span id="cb62-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-2" aria-hidden="true" tabindex="-1"></a>afr_cartogram_df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(afr_cartogram) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(. , afr_cartogram<span class="sc">@</span>data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;ISO3&quot;</span>)) </span>
<span id="cb62-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-3" aria-hidden="true" tabindex="-1"></a>afr_df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(afr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(. , afr<span class="sc">@</span>data, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;id&quot;</span><span class="ot">=</span><span class="st">&quot;ISO3&quot;</span>)) </span>
<span id="cb62-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb62-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># And using the advices of chart #331 we can custom it to get a better result:</span></span>
<span id="cb62-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> afr_df, <span class="fu">aes</span>(<span class="at">fill =</span> POP2005<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb62-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">name=</span><span class="st">&quot;Population (M)&quot;</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">140</span>), <span class="at">guide =</span> <span class="fu">guide_legend</span>( <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb62-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Africa&quot;</span>, <span class="at">subtitle=</span><span class="st">&quot;Population per country in 2005&quot;</span> ) <span class="sc">+</span></span>
<span id="cb62-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">35</span>,<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb62-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb62-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>), </span>
<span id="cb62-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb62-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb62-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb62-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">22</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb62-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">13</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb62-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.26</span>)</span>
<span id="cb62-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()</span>
<span id="cb62-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb62-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># You can do the same for afr_cartogram_df</span></span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode4-1.png" /></p>
</div>
<div id="compute-several-intermediate-maps" class="section level3" number="9.2.13">
<h3><span class="header-section-number">9.2.13</span> Compute Several Intermediate Maps</h3>
<p>The goal being to make a smooth animation between the 2 maps, we need to create a multitude of intermediate maps using interpolation.</p>
<p>This is possible thanks to the awesome <a href="https://github.com/thomasp85/tweenr">tweenr</a> library. (See a few examples in the <a href="https://www.r-graph-gallery.com/animation.html">animation section</a> of the gallery).</p>
<p>At the end weve got a big data frame which contains enough information to draw 30 maps. Three of these maps are presented above.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Give an id to every single point that compose the boundaries</span></span>
<span id="cb63-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-2" aria-hidden="true" tabindex="-1"></a>afr_cartogram_df<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(afr_cartogram_df))</span>
<span id="cb63-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-3" aria-hidden="true" tabindex="-1"></a>afr_df<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(afr_df))</span>
<span id="cb63-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind both map info in a data frame. 3 states: map --&gt; cartogram --&gt; map</span></span>
<span id="cb63-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(afr_df, afr_cartogram_df, afr_df)</span>
<span id="cb63-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set transformation type + time</span></span>
<span id="cb63-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ease <span class="ot">&lt;-</span> <span class="st">&quot;cubic-in-out&quot;</span></span>
<span id="cb63-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">each=</span><span class="fu">nrow</span>(afr_df))</span>
<span id="cb63-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the transition between these 2 objects?</span></span>
<span id="cb63-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-13" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">tween_elements</span>(data, <span class="at">time=</span><span class="st">&#39;time&#39;</span>, <span class="at">group=</span><span class="st">&#39;id&#39;</span>, <span class="at">ease=</span><span class="st">&#39;ease&#39;</span>, <span class="at">nframes =</span> <span class="dv">30</span>)</span>
<span id="cb63-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check a few frame</span></span>
<span id="cb63-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb63-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.frame<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(order), </span>
<span id="cb63-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> POP2005, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span></span>
<span id="cb63-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb63-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode5-1.png" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb64-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.frame<span class="sc">==</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(order), </span>
<span id="cb64-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> POP2005, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span></span>
<span id="cb64-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode5-2.png" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.frame<span class="sc">==</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(order), </span>
<span id="cb65-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> POP2005, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span></span>
<span id="cb65-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb65-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/a-smooth-transition-between-chloropleth-and-cartogram_files/figure-html/thecode5-3.png" /></p>
</div>
<div id="make-the-animation-with-gganimate" class="section level3" number="9.2.14">
<h3><span class="header-section-number">9.2.14</span> Make the Animation with <code>gganimate</code></h3>
<p>The last step consists at building the 30 maps and compile them in a .gif file. This is done using the gganimate library. This library uses another aesthetic: frame. A new plot is made for each frame, that allows us to build the gif afterwards.</p>
<p><u>Note</u>: This code uses the old version of <code>gganimate</code>. It needs to be updated. Please drop me a message if you can help me with that!</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb66-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb66-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> dt  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(order) , <span class="fu">aes</span>(<span class="at">fill =</span> POP2005<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">frame=</span>.frame) , <span class="at">size=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb66-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(</span>
<span id="cb66-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name=</span><span class="st">&quot;Population (M)&quot;</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">140</span>), </span>
<span id="cb66-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>( </span>
<span id="cb66-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), <span class="at">keywidth=</span><span class="fu">unit</span>(<span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>), </span>
<span id="cb66-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">title.position =</span> <span class="st">&#39;top&#39;</span>, <span class="at">nrow=</span><span class="dv">1</span>)</span>
<span id="cb66-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Africa&quot;</span>, <span class="at">subtitle=</span><span class="st">&quot;Population per country in 2005&quot;</span> ) <span class="sc">+</span></span>
<span id="cb66-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">35</span>,<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb66-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>), </span>
<span id="cb66-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb66-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb66-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f4&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb66-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">22</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb66-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">13</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb66-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.26</span>)</span>
<span id="cb66-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()</span>
<span id="cb66-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb66-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the animation</span></span>
<span id="cb66-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co">#animation::ani.options(interval = 1/9)</span></span>
<span id="cb66-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="fu">gganimate</span>(p, <span class="st">&quot;Animated_Africa.gif&quot;</span>,  <span class="at">title_frame =</span> F)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/img/graph/Animated_Cartogram_Africa.gif" /></p>
<div id="note-gganimate-in-this-example-deprecated.-check-httpsgithub.comthomasp85gganimate-for-current-usage." class="section level4" number="9.2.14.1">
<h4><span class="header-section-number">9.2.14.1</span> <u>Note</u>: gganimate in this example deprecated. Check <a href="https://github.com/thomasp85/gganimate">https://github.com/thomasp85/gganimate</a> for current usage.</h4>
</div>
<div id="conclusion" class="section level4" number="9.2.14.2">
<h4><span class="header-section-number">9.2.14.2</span> Conclusion</h4>
<p>This post uses several concepts that are extensively described in the <a href="https://www.r-graph-gallery.com/">R graph gallery</a>:</p>
<ul>
<li>The <a href="https://www.r-graph-gallery.com/choropleth-map.html">choropleth map</a> section gives several examples of choropleth maps, using different input types and several tools.</li>
<li>The <a href="https://www.r-graph-gallery.com/cartogram.html">cartogram</a> section gives further explanation about cartograms.</li>
<li>The <a href="https://www.r-graph-gallery.com/animation.html">animation</a> section explains more deeply how <code>tweenR</code> and <code>gganimate</code> work</li>
<li>The <a href="https://www.r-graph-gallery.com/map.html">map</a> section is a good starting point if you are lost in the map related packages jungle.</li>
</ul>
<p>If you are interested in dataviz, feel free to visit the <a href="https://www.r-graph-gallery.com/">gallery</a>, or to follow me on <a href="https://twitter.com/R_Graph_Gallery">twitter</a>!</p>
</div>
</div>
</div>
<div id="connection-map" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Connection Map</h2>
<hr />
<p>A <a href="https://www.data-to-viz.com/story/MapConnection.html">connection map</a> shows the connections between several positions on a map. The link between 2 locations is usually drawn using <a href="https://en.wikipedia.org/wiki/Great_circle">great circle</a>: the shortest route between them. It results in a rounded line that gives a really pleasant look to the map. In R, this is made possible thanks to libraries like geosphere.</p>
<div id="step-by-step" class="section level4" number="9.3.0.1">
<h4><span class="header-section-number">9.3.0.1</span> Step by Step</h4>
<p>The following example is a step by step approach to great circles in <code>R</code>. It will guides you through the use of the <code>gcintermediate()</code> function of the <code>geosphere</code> package. It notably tackles the issue that arises when 2 cities have their shortest distance passing behind the globe. Explore it <a href="https://www.r-graph-gallery.com/how-to-draw-connecting-routes-on-map-with-r-and-great-circles.html">here</a>.</p>
</div>
<div id="how-to-draw-connecting-routes-on-map-with-r" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> How to Draw Connecting Routes on Map with R</h3>
<p>This section explains how to draw connection lines between several locations on a map, using <code>R</code>. Method relies on the <code>gcIntermediate</code> function from the <code>geosphere</code> package. Instead of making straight lines, it draws the shortest routes, using <a href="https://en.wikipedia.org/wiki/Great_circle">great circles</a>.</p>
<div id="draw-an-empty-map" class="section level4" number="9.3.1.1">
<h4><span class="header-section-number">9.3.1.1</span> Draw an Empty Map</h4>
<p>Lets start by drawing a world map backgroud. Fortunately, the world shape is provided by the <code>maps</code> library. It can easily be plotted using the <code>map()</code> function that accepts a few arguments for customization.</p>
<p><u>Note</u>: visit the <a href="https://www.r-graph-gallery.com/map.html">background map</a> section if you want to discover more options to build map in <code>R</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># World map is available in the maps package</span></span>
<span id="cb67-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb67-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># No margin</span></span>
<span id="cb67-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb67-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># World map</span></span>
<span id="cb67-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,</span>
<span id="cb67-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,</span>
<span id="cb67-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) </span>
<span id="cb67-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb67-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
</div>
<div id="add-3-cities" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Add 3 Cities</h3>
<p>Its relatively straightforward to add circles at specific positions using the <code>points()</code> function. The hardest part is probably to find out the longitute and latitude of the cities you are interested in.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dplyr for data wrangling and pipe function</span></span>
<span id="cb68-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb68-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cities</span></span>
<span id="cb68-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-5" aria-hidden="true" tabindex="-1"></a>Buenos_aires <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">58</span>,<span class="sc">-</span><span class="dv">34</span>)</span>
<span id="cb68-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-6" aria-hidden="true" tabindex="-1"></a>Paris <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">49</span>)</span>
<span id="cb68-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-7" aria-hidden="true" tabindex="-1"></a>Melbourne <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">145</span>,<span class="sc">-</span><span class="dv">38</span>)</span>
<span id="cb68-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame</span></span>
<span id="cb68-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Buenos_aires, Paris, Melbourne) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb68-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;lat&quot;</span>)</span>
<span id="cb68-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the cities on the map</span></span>
<span id="cb68-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,</span>
<span id="cb68-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,</span>
<span id="cb68-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) </span>
<span id="cb68-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="show-connection-between-cities" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Show Connection between Cities</h3>
<p>Now we can connect cities drawing the shortest route between them. This is done using great circles, what gives a better visualization than using straight lines.</p>
<p>The <code>geosphere</code> package provides the <code>gcIntermediate()</code> function that computes the path. This path can then be plotted using the <code>lines()</code> function.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load geosphere</span></span>
<span id="cb69-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb69-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Background map</span></span>
<span id="cb69-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,</span>
<span id="cb69-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,</span>
<span id="cb69-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) </span>
<span id="cb69-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dot for cities</span></span>
<span id="cb69-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb69-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the connection between Buenos Aires and Paris</span></span>
<span id="cb69-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-14" aria-hidden="true" tabindex="-1"></a>inter <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(Paris,  Buenos_aires, <span class="at">n=</span><span class="dv">50</span>, <span class="at">addStartEnd=</span><span class="cn">TRUE</span>, <span class="at">breakAtDateLine=</span>F)</span>
<span id="cb69-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show this connection</span></span>
<span id="cb69-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(inter, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb69-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb69-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Between Paris and Melbourne</span></span>
<span id="cb69-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-20" aria-hidden="true" tabindex="-1"></a>inter <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(Melbourne,  Paris, <span class="at">n=</span><span class="dv">50</span>, <span class="at">addStartEnd=</span><span class="cn">TRUE</span>, <span class="at">breakAtDateLine=</span>F)             </span>
<span id="cb69-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(inter, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="correcting-gcintermediate" class="section level3" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Correcting <code>gcIntermediate</code></h3>
<p>Using the exact same method between Melbourne and Buenos Aires gives a pretty disapointing result as shown here.</p>
<p>Indeed, there is a long horizontal line that appears, when we expect the connection to be done on the other side of the globe (and thus invisible)</p>
<p>What happens is that <code>gcintermediate</code> follows the shortest path, which means it will go east from Australia until the date line, break the line and come back heading East from the pacific to South America.</p>
<p>Because we do not want to see the horizontal line, we need to plot this connection in 2 steps. To do so we can use the following function, which breaks the line in 2 sections when the distance between 2 points is longer than 180 degrees:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to plot connections</span></span>
<span id="cb70-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-2" aria-hidden="true" tabindex="-1"></a>plot_my_connection<span class="ot">=</span><span class="cf">function</span>( dep_lon, dep_lat, arr_lon, arr_lat, ...){</span>
<span id="cb70-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-3" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(<span class="fu">c</span>(dep_lon, dep_lat), <span class="fu">c</span>(arr_lon, arr_lat), <span class="at">n=</span><span class="dv">50</span>, <span class="at">addStartEnd=</span><span class="cn">TRUE</span>, <span class="at">breakAtDateLine=</span>F)             </span>
<span id="cb70-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-4" aria-hidden="true" tabindex="-1"></a>    inter<span class="ot">=</span><span class="fu">data.frame</span>(inter)</span>
<span id="cb70-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-5" aria-hidden="true" tabindex="-1"></a>    diff_of_lon<span class="ot">=</span><span class="fu">abs</span>(dep_lon) <span class="sc">+</span> <span class="fu">abs</span>(arr_lon)</span>
<span id="cb70-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(diff_of_lon <span class="sc">&gt;</span> <span class="dv">180</span>){</span>
<span id="cb70-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(<span class="fu">subset</span>(inter, lon<span class="sc">&gt;=</span><span class="dv">0</span>), ...)</span>
<span id="cb70-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(<span class="fu">subset</span>(inter, lon<span class="sc">&lt;</span><span class="dv">0</span>), ...)</span>
<span id="cb70-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-9" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb70-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(inter, ...)</span>
<span id="cb70-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb70-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb70-12" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Lets apply this function to plot the link between Melbourne and Buenos Aires. Better, isnt it?</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Background map</span></span>
<span id="cb71-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,<span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,<span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) )</span>
<span id="cb71-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Circles for cities</span></span>
<span id="cb71-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb71-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb71-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Connections</span></span>
<span id="cb71-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_my_connection</span>(Paris[<span class="dv">1</span>], Paris[<span class="dv">2</span>], Melbourne[<span class="dv">1</span>], Melbourne[<span class="dv">2</span>], <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb71-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_my_connection</span>(Buenos_aires[<span class="dv">1</span>], Buenos_aires[<span class="dv">2</span>], Melbourne[<span class="dv">1</span>], Melbourne[<span class="dv">2</span>], <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb71-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_my_connection</span>(Buenos_aires[<span class="dv">1</span>], Buenos_aires[<span class="dv">2</span>], Paris[<span class="dv">1</span>], Paris[<span class="dv">2</span>], <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="apply-it-to-several-pairs-of-cities" class="section level3" number="9.3.5">
<h3><span class="header-section-number">9.3.5</span> Apply it to Several Pairs of Cities</h3>
<p>If we want to plot many connections, it is totally doable to build a <code>for</code> loop that draws them one by one.</p>
<p>Moreover, note the use of the <code>text</code> function to add city names.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataset</span></span>
<span id="cb72-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb72-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Buenos_aires=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">58</span>,<span class="sc">-</span><span class="dv">34</span>),</span>
<span id="cb72-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Paris=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">49</span>),</span>
<span id="cb72-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Melbourne=</span><span class="fu">c</span>(<span class="dv">145</span>,<span class="sc">-</span><span class="dv">38</span>),</span>
<span id="cb72-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Saint.Petersburg=</span><span class="fu">c</span>(<span class="fl">30.32</span>, <span class="fl">59.93</span>),</span>
<span id="cb72-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Abidjan=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.03</span>, <span class="fl">5.33</span>),</span>
<span id="cb72-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Montreal=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.57</span>, <span class="fl">45.52</span>),</span>
<span id="cb72-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Nairobi=</span><span class="fu">c</span>(<span class="fl">36.82</span>, <span class="sc">-</span><span class="fl">1.29</span>),</span>
<span id="cb72-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Salvador=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">38.5</span>, <span class="sc">-</span><span class="fl">12.97</span>)</span>
<span id="cb72-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-11" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb72-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;lat&quot;</span>)</span>
<span id="cb72-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all pairs of coordinates</span></span>
<span id="cb72-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-15" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">t</span>(<span class="fu">combn</span>(data<span class="sc">$</span>long, <span class="dv">2</span>)), <span class="fu">t</span>(<span class="fu">combn</span>(data<span class="sc">$</span>lat, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb72-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_pairs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;long1&quot;</span>,<span class="st">&quot;long2&quot;</span>,<span class="st">&quot;lat1&quot;</span>,<span class="st">&quot;lat2&quot;</span>)</span>
<span id="cb72-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># background map</span></span>
<span id="cb72-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb72-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,<span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,<span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) )</span>
<span id="cb72-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co"># add every connections:</span></span>
<span id="cb72-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(all_pairs)){</span>
<span id="cb72-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_my_connection</span>(all_pairs<span class="sc">$</span>long1[i], all_pairs<span class="sc">$</span>lat1[i], all_pairs<span class="sc">$</span>long2[i], all_pairs<span class="sc">$</span>lat2[i], <span class="at">col=</span><span class="st">&quot;skyblue&quot;</span>, <span class="at">lwd=</span><span class="dv">1</span>)</span>
<span id="cb72-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="co"># add points and names of cities</span></span>
<span id="cb72-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb72-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">rownames</span>(data), <span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat,  <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="an-alternative-using-the-greatcircle-function" class="section level3" number="9.3.6">
<h3><span class="header-section-number">9.3.6</span> An Alternative using the <code>greatCircle</code> Function</h3>
<p>This is the method suggested by the <a href="http://simplystatistics.tumblr.com/post/14568185310/an-r-function-to-map-your-twitter-followers">Simply Statistics</a> Blog to draw a twitter connection map.</p>
<p>The idea is to calculate the whole great circle, and keep only the part that stays in front of the map, never going behind it.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A function that keeps the good part of the great circle, by Jeff Leek:</span></span>
<span id="cb73-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-2" aria-hidden="true" tabindex="-1"></a>getGreatCircle <span class="ot">&lt;-</span> <span class="cf">function</span>(userLL,relationLL){</span>
<span id="cb73-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  tmpCircle <span class="ot">=</span> <span class="fu">greatCircle</span>(userLL,relationLL, <span class="at">n=</span><span class="dv">200</span>)</span>
<span id="cb73-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(tmpCircle[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">data.frame</span>(userLL)[<span class="dv">1</span>,<span class="dv">1</span>]))</span>
<span id="cb73-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(tmpCircle[,<span class="dv">1</span>] <span class="sc">-</span> relationLL[<span class="dv">1</span>]))</span>
<span id="cb73-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-6" aria-hidden="true" tabindex="-1"></a>  greatC <span class="ot">=</span> tmpCircle[start<span class="sc">:</span>end,]</span>
<span id="cb73-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(greatC)</span>
<span id="cb73-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb73-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># background map</span></span>
<span id="cb73-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,<span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,<span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) )</span>
<span id="cb73-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># map 3 connections:</span></span>
<span id="cb73-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-14" aria-hidden="true" tabindex="-1"></a>great <span class="ot">&lt;-</span> <span class="fu">getGreatCircle</span>(Paris, Melbourne)</span>
<span id="cb73-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(great, <span class="at">col=</span><span class="st">&quot;skyblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-16" aria-hidden="true" tabindex="-1"></a>great <span class="ot">&lt;-</span> <span class="fu">getGreatCircle</span>(Buenos_aires, Melbourne)</span>
<span id="cb73-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(great, <span class="at">col=</span><span class="st">&quot;skyblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-18" aria-hidden="true" tabindex="-1"></a>great <span class="ot">&lt;-</span> <span class="fu">getGreatCircle</span>(Paris, Buenos_aires)</span>
<span id="cb73-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(great, <span class="at">col=</span><span class="st">&quot;skyblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="co"># City names and dots</span></span>
<span id="cb73-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb73-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">rownames</span>(data), <span class="at">x=</span>data<span class="sc">$</span>long, <span class="at">y=</span>data<span class="sc">$</span>lat,  <span class="at">col=</span><span class="st">&quot;slateblue&quot;</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div id="conclusion-1" class="section level4" number="9.3.6.1">
<h4><span class="header-section-number">9.3.6.1</span> Conclusion</h4>
<p>Note that the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> offers heaps of other <a href="https://www.r-graph-gallery.com/map.html">map examples</a> made with <code>R</code>. It also offers a whole section dedicated to <a href="https://www.r-graph-gallery.com/connection-map.html">connection maps</a>.</p>
<p>You can follow the gallery on <a href="https://twitter.com/R_Graph_Gallery">Twitter</a> to be aware or recent updates.</p>
</div>
</div>
<div id="visualizing-geographic-connections" class="section level3" number="9.3.7">
<h3><span class="header-section-number">9.3.7</span> Visualizing Geographic Connections</h3>
<p>This document provides a few suggestions for the visualization of geographical connections.</p>
<p>The dataset considered here is available on <a href="https://github.com/holtzy/data_to_viz/tree/master/Example_dataset">github</a>. It is based on about 13,000 tweets containing the <a href="https://twitter.com/search?q=%23surf&amp;src=typd&amp;lang=en">#surf</a> hashtag. These tweets have been recovered on a 10 months period, and those with both current geo location and correct city of origin have been kept. You can learn more on this project in this dedicated <a href="https://github.com/holtzy/About-Surfers-On-Twitter">github repository</a>.</p>
<p>The dataset provides longitude and latitude for both the home location of tweeters, and their instant geolocation as well. Basically it looks like that:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb74-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb74-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb74-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb74-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb74-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb74-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.table.format =</span> <span class="st">&quot;html&quot;</span>)</span>
<span id="cb74-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jpeg)</span>
<span id="cb74-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb74-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb74-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb74-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from github (Surfer project)</span></span>
<span id="cb74-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-16" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/19_MapConnection.csv&quot;</span>)</span>
<span id="cb74-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Show long format</span></span>
<span id="cb74-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-19" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb74-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">homename =</span> <span class="fu">gsub</span>( <span class="st">&quot;, Western Australia&quot;</span>, <span class="st">&quot;&quot;</span>, homename)) <span class="sc">%&gt;%</span></span>
<span id="cb74-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">homename =</span> <span class="fu">gsub</span>( <span class="st">&quot;, France&quot;</span>, <span class="st">&quot;&quot;</span>, homename)) <span class="sc">%&gt;%</span></span>
<span id="cb74-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">homename =</span> <span class="fu">gsub</span>( <span class="st">&quot; - Bali - Indonesia&quot;</span>, <span class="st">&quot;&quot;</span>, homename)) <span class="sc">%&gt;%</span></span>
<span id="cb74-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">homelat=</span><span class="fu">round</span>(homelat,<span class="dv">1</span>), <span class="at">homelon=</span><span class="fu">round</span>(homelon,<span class="dv">1</span>), <span class="at">travellat=</span><span class="fu">round</span>(travellat,<span class="dv">1</span>), <span class="at">travellon=</span><span class="fu">round</span>(travellon,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(homename, homelat, homelon, travelcountry, travellat, travellon)</span>
<span id="cb74-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb74-27" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">%&gt;%</span> <span class="fu">kable</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="at">full_width =</span> F)</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
homename
</th>
<th style="text-align:right;">
homelat
</th>
<th style="text-align:right;">
homelon
</th>
<th style="text-align:left;">
travelcountry
</th>
<th style="text-align:right;">
travellat
</th>
<th style="text-align:right;">
travellon
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Bridgetown
</td>
<td style="text-align:right;">
-34.0
</td>
<td style="text-align:right;">
116.1
</td>
<td style="text-align:left;">
Australia
</td>
<td style="text-align:right;">
-34.2
</td>
<td style="text-align:right;">
115.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Lille
</td>
<td style="text-align:right;">
50.6
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:left;">
France
</td>
<td style="text-align:right;">
45.0
</td>
<td style="text-align:right;">
-1.2
</td>
</tr>
<tr>
<td style="text-align:left;">
MX
</td>
<td style="text-align:right;">
23.6
</td>
<td style="text-align:right;">
-102.6
</td>
<td style="text-align:left;">
Mexico
</td>
<td style="text-align:right;">
21.0
</td>
<td style="text-align:right;">
-101.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Kuta
</td>
<td style="text-align:right;">
-8.7
</td>
<td style="text-align:right;">
115.2
</td>
<td style="text-align:left;">
Indonesia
</td>
<td style="text-align:right;">
-8.7
</td>
<td style="text-align:right;">
115.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Kuta
</td>
<td style="text-align:right;">
-8.7
</td>
<td style="text-align:right;">
115.2
</td>
<td style="text-align:left;">
Indonesia
</td>
<td style="text-align:right;">
-8.7
</td>
<td style="text-align:right;">
115.2
</td>
</tr>
</tbody>
</table>
</div>
<div id="showing-few-connections-on-a-map" class="section level3" number="9.3.8">
<h3><span class="header-section-number">9.3.8</span> Showing Few Connections on a Map</h3>
<p>Before showing all the relationships provided in this dataset, it is important to understand how to visualize a unique connection on a map. It is a common practice to link 2 points using the shortest route between them instead of a straight line. It is called <a href="https://en.wikipedia.org/wiki/Great_circle">great circles</a>. A special care is given for situations where cities are very far from each other and where the shortest connection thus passes behind the map.</p>
<p>Here are the connection between 7 major cities on a world map:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-1" aria-hidden="true" tabindex="-1"></a>don<span class="ot">=</span><span class="fu">rbind</span>(</span>
<span id="cb75-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Paris=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">49</span>),</span>
<span id="cb75-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Melbourne=</span><span class="fu">c</span>(<span class="dv">145</span>,<span class="sc">-</span><span class="dv">38</span>),</span>
<span id="cb75-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Saint.Petersburg=</span><span class="fu">c</span>(<span class="fl">30.32</span>, <span class="fl">59.93</span>),</span>
<span id="cb75-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Abidjan=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.03</span>, <span class="fl">5.33</span>),</span>
<span id="cb75-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Montreal=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.57</span>, <span class="fl">45.52</span>),</span>
<span id="cb75-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Nairobi=</span><span class="fu">c</span>(<span class="fl">36.82</span>, <span class="sc">-</span><span class="fl">1.29</span>),</span>
<span id="cb75-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Salvador=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">38.5</span>, <span class="sc">-</span><span class="fl">12.97</span>)</span>
<span id="cb75-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-9" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb75-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(don)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;lat&quot;</span>)</span>
<span id="cb75-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-13" aria-hidden="true" tabindex="-1"></a>all_pairs<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">t</span>(<span class="fu">combn</span>(don<span class="sc">$</span>long, <span class="dv">2</span>)), <span class="fu">t</span>(<span class="fu">combn</span>(don<span class="sc">$</span>lat, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb75-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_pairs)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;long1&quot;</span>,<span class="st">&quot;long2&quot;</span>,<span class="st">&quot;lat1&quot;</span>,<span class="st">&quot;lat2&quot;</span>)</span>
<span id="cb75-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-16" aria-hidden="true" tabindex="-1"></a>plot_my_connection<span class="ot">=</span><span class="cf">function</span>( dep_lon, dep_lat, arr_lon, arr_lat, ...){</span>
<span id="cb75-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-17" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(<span class="fu">c</span>(dep_lon, dep_lat), <span class="fu">c</span>(arr_lon, arr_lat), <span class="at">n=</span><span class="dv">50</span>, <span class="at">addStartEnd=</span><span class="cn">TRUE</span>, <span class="at">breakAtDateLine=</span>F)             </span>
<span id="cb75-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-18" aria-hidden="true" tabindex="-1"></a>    inter<span class="ot">=</span><span class="fu">data.frame</span>(inter)</span>
<span id="cb75-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-19" aria-hidden="true" tabindex="-1"></a>    diff_of_lon<span class="ot">=</span><span class="fu">abs</span>(dep_lon) <span class="sc">+</span> <span class="fu">abs</span>(arr_lon)</span>
<span id="cb75-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(diff_of_lon <span class="sc">&gt;</span> <span class="dv">180</span>){</span>
<span id="cb75-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(<span class="fu">subset</span>(inter, lon<span class="sc">&gt;=</span><span class="dv">0</span>), ...)</span>
<span id="cb75-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(<span class="fu">subset</span>(inter, lon<span class="sc">&lt;</span><span class="dv">0</span>), ...)</span>
<span id="cb75-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-23" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb75-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(inter, ...)</span>
<span id="cb75-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb75-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-28" aria-hidden="true" tabindex="-1"></a><span class="co"># background map</span></span>
<span id="cb75-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-29" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb75-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-30" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="st">&#39;world&#39;</span>,<span class="at">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>, <span class="at">bg=</span><span class="st">&quot;white&quot;</span>, <span class="at">lwd=</span><span class="fl">0.05</span>,<span class="at">mar=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="at">border=</span><span class="dv">0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="dv">80</span>) )</span>
<span id="cb75-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-31" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb75-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-32" aria-hidden="true" tabindex="-1"></a><span class="co"># add every connections:</span></span>
<span id="cb75-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(all_pairs)){</span>
<span id="cb75-34"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_my_connection</span>(all_pairs<span class="sc">$</span>long1[i], all_pairs<span class="sc">$</span>lat1[i], all_pairs<span class="sc">$</span>long2[i], all_pairs<span class="sc">$</span>lat2[i], <span class="at">col=</span><span class="st">&quot;#69b3a2&quot;</span>, <span class="at">lwd=</span><span class="dv">1</span>)</span>
<span id="cb75-35"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-36"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb75-37"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-37" aria-hidden="true" tabindex="-1"></a><span class="co"># add points and names of cities</span></span>
<span id="cb75-38"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-38" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>don<span class="sc">$</span>long, <span class="at">y=</span>don<span class="sc">$</span>lat, <span class="at">col=</span><span class="st">&quot;#69b3a2&quot;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb75-39"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb75-39" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">rownames</span>(don), <span class="at">x=</span>don<span class="sc">$</span>long, <span class="at">y=</span>don<span class="sc">$</span>lat,  <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/img/graph/196-the-wordcloud2-library1.png" /></p>
</div>
<div id="showing-many-connections-on-a-map" class="section level3" number="9.3.9">
<h3><span class="header-section-number">9.3.9</span> Showing Many Connections on a Map</h3>
<p>It is then possible to use the same method for the whole dataset composed of about 10,000 connections. With such a sample size, it makes sense to group the connections that have exactly the same starting and ending points. Then it is important to represent the connections with high volume on top of the graphic, and those with small volume below it. Indeed this will allow to highlight the most important pattern and hide the noise of rare connections.</p>
<p>Here I choosed to use a <a href="https://www.nasa.gov/specials/blackmarble/2016/globalmaps/BlackMarble_2016_01deg.jpg">NASA night lights</a> image as a background, inspired from this <a href="https://www.dataplanes.org/notes/2018/01/27/flight-routes-night-lights">blog post</a>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset from github (Surfer project)</span></span>
<span id="cb76-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/19_MapConnection.csv&quot;</span>)</span>
<span id="cb76-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download NASA night lights image</span></span>
<span id="cb76-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://www.nasa.gov/specials/blackmarble/2016/globalmaps/BlackMarble_2016_01deg.jpg&quot;</span>, </span>
<span id="cb76-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="at">destfile =</span> <span class="st">&quot;C:/Users/kwilliam/Downloads/BlackMarble_2016_01deg.jpg&quot;</span>, <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb76-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load picture and render</span></span>
<span id="cb76-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-8" aria-hidden="true" tabindex="-1"></a>earth <span class="ot">&lt;-</span> <span class="fu">readJPEG</span>(<span class="st">&quot;C:/Users/kwilliam/Downloads/BlackMarble_2016_01deg.jpg&quot;</span>, <span class="at">native =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-9" aria-hidden="true" tabindex="-1"></a>earth <span class="ot">&lt;-</span> <span class="fu">rasterGrob</span>(earth, <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Count how many times we have each unique connexion + order by importance</span></span>
<span id="cb76-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-12" aria-hidden="true" tabindex="-1"></a>summary<span class="ot">=</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb76-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(homelat,homelon,homecontinent, travellat,travellon,travelcontinent) <span class="sc">%&gt;%</span></span>
<span id="cb76-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n)</span>
<span id="cb76-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co"># A function that makes a dateframe per connection (we will use these connections to plot each lines)</span></span>
<span id="cb76-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-17" aria-hidden="true" tabindex="-1"></a>data_for_connection<span class="ot">=</span><span class="cf">function</span>( dep_lon, dep_lat, arr_lon, arr_lat, group){</span>
<span id="cb76-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-18" aria-hidden="true" tabindex="-1"></a>  inter <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(<span class="fu">c</span>(dep_lon, dep_lat), <span class="fu">c</span>(arr_lon, arr_lat), <span class="at">n=</span><span class="dv">50</span>, <span class="at">addStartEnd=</span><span class="cn">TRUE</span>, <span class="at">breakAtDateLine=</span>F)             </span>
<span id="cb76-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-19" aria-hidden="true" tabindex="-1"></a>  inter<span class="ot">=</span><span class="fu">data.frame</span>(inter)</span>
<span id="cb76-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-20" aria-hidden="true" tabindex="-1"></a>  inter<span class="sc">$</span>group<span class="ot">=</span><span class="cn">NA</span></span>
<span id="cb76-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-21" aria-hidden="true" tabindex="-1"></a>  diff_of_lon<span class="ot">=</span><span class="fu">abs</span>(dep_lon) <span class="sc">+</span> <span class="fu">abs</span>(arr_lon)</span>
<span id="cb76-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(diff_of_lon <span class="sc">&gt;</span> <span class="dv">180</span>){</span>
<span id="cb76-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-23" aria-hidden="true" tabindex="-1"></a>    inter<span class="sc">$</span>group[ <span class="fu">which</span>(inter<span class="sc">$</span>lon<span class="sc">&gt;=</span><span class="dv">0</span>)]<span class="ot">=</span><span class="fu">paste</span>(group, <span class="st">&quot;A&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb76-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-24" aria-hidden="true" tabindex="-1"></a>    inter<span class="sc">$</span>group[ <span class="fu">which</span>(inter<span class="sc">$</span>lon<span class="sc">&lt;</span><span class="dv">0</span>)]<span class="ot">=</span><span class="fu">paste</span>(group, <span class="st">&quot;B&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb76-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-25" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb76-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-26" aria-hidden="true" tabindex="-1"></a>    inter<span class="sc">$</span>group<span class="ot">=</span>group</span>
<span id="cb76-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(inter)</span>
<span id="cb76-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation d&#39;un dataframe complet avec les points de toutes les lignes faire.</span></span>
<span id="cb76-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-32" aria-hidden="true" tabindex="-1"></a>data_ready_plot<span class="ot">=</span><span class="fu">data.frame</span>()</span>
<span id="cb76-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(summary))){</span>
<span id="cb76-34"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-34" aria-hidden="true" tabindex="-1"></a>  tmp<span class="ot">=</span><span class="fu">data_for_connection</span>(summary<span class="sc">$</span>homelon[i], summary<span class="sc">$</span>homelat[i], summary<span class="sc">$</span>travellon[i], summary<span class="sc">$</span>travellat[i] , i)</span>
<span id="cb76-35"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-35" aria-hidden="true" tabindex="-1"></a>  tmp<span class="sc">$</span>homecontinent<span class="ot">=</span>summary<span class="sc">$</span>homecontinent[i]</span>
<span id="cb76-36"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-36" aria-hidden="true" tabindex="-1"></a>  tmp<span class="sc">$</span>n<span class="ot">=</span>summary<span class="sc">$</span>n[i]</span>
<span id="cb76-37"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-37" aria-hidden="true" tabindex="-1"></a>  data_ready_plot<span class="ot">=</span><span class="fu">rbind</span>(data_ready_plot, tmp)</span>
<span id="cb76-38"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-39"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-39" aria-hidden="true" tabindex="-1"></a>data_ready_plot<span class="sc">$</span>homecontinent<span class="ot">=</span><span class="fu">factor</span>(data_ready_plot<span class="sc">$</span>homecontinent, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>,<span class="st">&quot;Europe&quot;</span>,<span class="st">&quot;Australia&quot;</span>,<span class="st">&quot;Africa&quot;</span>,<span class="st">&quot;North America&quot;</span>,<span class="st">&quot;South America&quot;</span>,<span class="st">&quot;Antarctica&quot;</span>))</span>
<span id="cb76-40"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-41"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb76-42"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-42" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-43"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(earth, <span class="at">xmin =</span> <span class="sc">-</span><span class="dv">180</span>, <span class="at">xmax =</span> <span class="dv">180</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">90</span>, <span class="at">ymax =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb76-44"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>data_ready_plot, <span class="fu">aes</span>(<span class="at">x=</span>lon, <span class="at">y=</span>lat, <span class="at">group=</span>group, <span class="at">colour=</span>homecontinent, <span class="at">alpha=</span>n), <span class="at">size=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb76-45"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set3&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-46"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb76-47"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-48"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb76-49"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>), </span>
<span id="cb76-50"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing=</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;null&quot;</span>),</span>
<span id="cb76-51"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb76-52"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-53"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-53" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">150</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;Where surfers travel.&quot;</span>), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-54"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-54" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">150</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">51</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;data-to-viz.com | NASA.gov | 10,000 #surf tweets recovered&quot;</span>), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb76-55"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::annotate(&quot;text&quot;, x = 160, y = -51, hjust = 1, size = 7, label = paste(&quot;Cacededi Air-Guimzu 2018&quot;), color = &quot;white&quot;, alpha = 0.5) +</span></span>
<span id="cb76-56"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">180</span>,<span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb76-57"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">60</span>,<span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb76-58"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.006</span>, <span class="fl">0.006</span>)) <span class="sc">+</span></span>
<span id="cb76-59"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() </span>
<span id="cb76-60"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-60" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb76-61"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Save at PNG</span></span>
<span id="cb76-62"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb76-62" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(&quot;IMG/Surfer_travel.png&quot;, width = 36, height = 15.22, units = &quot;in&quot;, dpi = 90)</span></span></code></pre></div>
<p><img src="https://www.data-to-viz.com/story/IMG/Surfer_travel.png" /></p>
</div>
<div id="bubble-map" class="section level3" number="9.3.10">
<h3><span class="header-section-number">9.3.10</span> Bubble Map</h3>
<hr />
<p>This section is dedicated to map with markers displayed on top of it. These <u>markers</u> can be circles with size proportional to a numeric value, resulting in a <a href="https://www.data-to-viz.com/graph/bubblemap.html">bubble map</a>. Before exploring this section, learn how to build the <a href="https://www.r-graph-gallery.com/map.html">background map</a> with R.</p>
<div id="interactive-bubble-maps-with-leaflet" class="section level4" number="9.3.10.1">
<h4><span class="header-section-number">9.3.10.1</span> Interactive Bubble Maps with <code>leaflet</code></h4>
<p>The <a href="https://rstudio.github.io/leaflet/">leaflet</a> R package is a wrapper of the Javascript <a href="https://leafletjs.com/">leaflet.js</a> library. It allows to build stunning interactive maps in minutes with R. Maps can be exported and standalong html files, or be embeded in a R markdown file or a shiny application. Check the 3 examples below to get the basics of interactive bubble maps with R.</p>
<p>The leaflet R package is a wrapper of the Javascript leaflet.js library. It allows to build stunning interactive maps in minutes with R. Maps can be exported and standalong html files, or be embeded in a R markdown file or a shiny application. Check the 3 examples below to get the basics of interactive bubble maps with R.</p>
</div>
</div>
<div id="use-leaflet-control-widget" class="section level3" number="9.3.11">
<h3><span class="header-section-number">9.3.11</span> Use leaflet control widget</h3>
<p>This section explains how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a> with R and the <code>leaflet</code> package. It shows a set of earthquakes and their intensity in the Pacific Ocean.</p>
<p><code>leaflet</code> is a R package allowing to build interactive maps. This section follows the <a href="https://www.r-graph-gallery.com/179-show-a-map-with-leaflet-r.html">leaflet introduction</a> and explain how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a>.</p>
<p>The input required to build such a map is a list of GPS coordinates, with a numeric value attributed to each location to control the bubble size and color.</p>
<p>Markers are added using the <code>addCircleMarkers()</code> function, and bubble color is mapped to a color scale build with binning.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb77-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb77-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make data with several positions</span></span>
<span id="cb77-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-5" aria-hidden="true" tabindex="-1"></a>data_red <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">LONG=</span><span class="dv">42</span><span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="at">LAT=</span><span class="dv">23</span><span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="at">PLACE=</span><span class="fu">paste</span>(<span class="st">&quot;Red_place_&quot;</span>,<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)))</span>
<span id="cb77-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-6" aria-hidden="true" tabindex="-1"></a>data_blue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">LONG=</span><span class="dv">42</span><span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="at">LAT=</span><span class="dv">23</span><span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="at">PLACE=</span><span class="fu">paste</span>(<span class="st">&quot;Blue_place_&quot;</span>,<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)))</span>
<span id="cb77-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the leaflet map:</span></span>
<span id="cb77-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb77-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>(<span class="at">lng=</span><span class="dv">42</span>, <span class="at">lat=</span><span class="dv">23</span>, <span class="at">zoom=</span><span class="dv">6</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add two tiles</span></span>
<span id="cb77-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;Esri.WorldImagery&quot;</span>, <span class="at">group=</span><span class="st">&quot;background 1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>(<span class="at">options =</span> <span class="fu">providerTileOptions</span>(<span class="at">noWrap =</span> <span class="cn">TRUE</span>), <span class="at">group=</span><span class="st">&quot;background 2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add 2 marker groups</span></span>
<span id="cb77-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data=</span>data_red, <span class="at">lng=</span><span class="sc">~</span>LONG , <span class="at">lat=</span><span class="sc">~</span>LAT, <span class="at">radius=</span><span class="dv">8</span> , <span class="at">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb77-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fillColor=</span><span class="st">&quot;red&quot;</span>, <span class="at">stroke =</span> <span class="cn">TRUE</span>, <span class="at">fillOpacity =</span> <span class="fl">0.8</span>, <span class="at">group=</span><span class="st">&quot;Red&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data=</span>data_blue, <span class="at">lng=</span><span class="sc">~</span>LONG , <span class="at">lat=</span><span class="sc">~</span>LAT, <span class="at">radius=</span><span class="dv">8</span> , <span class="at">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb77-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fillColor=</span><span class="st">&quot;blue&quot;</span>, <span class="at">stroke =</span> <span class="cn">TRUE</span>, <span class="at">fillOpacity =</span> <span class="fl">0.8</span>, <span class="at">group=</span><span class="st">&quot;Blue&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the control widget</span></span>
<span id="cb77-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(<span class="at">overlayGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Red&quot;</span>,<span class="st">&quot;Blue&quot;</span>) , <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;background 1&quot;</span>,<span class="st">&quot;background 2&quot;</span>), </span>
<span id="cb77-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>))</span>
<span id="cb77-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-26" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb77-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co"># save the widget in a html file if needed.</span></span>
<span id="cb77-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmlwidgets)</span>
<span id="cb77-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(m, <span class="at">file=</span><span class="fu">paste0</span>( <span class="fu">getwd</span>(), <span class="st">&quot;/HtmlWidget/bubblemapControl.html&quot;</span>))</span></code></pre></div>
<center>
<iframe title="My embedded document" src="mapHtml/bubblemapControl.html" height="300px" width="100%"></iframe>
</center>
</div>
<div id="interactive-earthquake-bubble-map-with-r-and-leaflet" class="section level3" number="9.3.12">
<h3><span class="header-section-number">9.3.12</span> Interactive Earthquake Bubble Map with R and leaflet</h3>
<p>This post explains how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a> with R and the <code>leaflet</code> package. It shows a set of earthquakes and their intensity in the Pacific Ocean.</p>
<p><code>leaflet</code> is a R package allowing to build interactive maps. This post follows the <a href="https://www.r-graph-gallery.com/179-show-a-map-with-leaflet-r.html">leaflet introduction</a> and explain how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a>.</p>
<p>The input required to build such a map is a list of GPS coordinates, with a numeric value attributed to each location to control the bubble size and color.</p>
<p>Markers are added using the <code>addCircleMarkers()</code> function, and bubble color is mapped to a color scale build with binning.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb78-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb78-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load example data (Fiji Earthquakes) + keep only 100 first lines</span></span>
<span id="cb78-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(quakes)</span>
<span id="cb78-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-6" aria-hidden="true" tabindex="-1"></a>quakes <span class="ot">&lt;-</span>  <span class="fu">head</span>(quakes, <span class="dv">100</span>)</span>
<span id="cb78-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a color palette with handmade bins.</span></span>
<span id="cb78-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-9" aria-hidden="true" tabindex="-1"></a>mybins <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">4</span>, <span class="fl">6.5</span>, <span class="at">by=</span><span class="fl">0.5</span>)</span>
<span id="cb78-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-10" aria-hidden="true" tabindex="-1"></a>mypalette <span class="ot">&lt;-</span> <span class="fu">colorBin</span>( <span class="at">palette=</span><span class="st">&quot;YlOrBr&quot;</span>, <span class="at">domain=</span>quakes<span class="sc">$</span>mag, <span class="at">na.color=</span><span class="st">&quot;transparent&quot;</span>, <span class="at">bins=</span>mybins)</span>
<span id="cb78-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the text for the tooltip:</span></span>
<span id="cb78-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-13" aria-hidden="true" tabindex="-1"></a>mytext <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb78-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-14" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;Depth: &quot;</span>, quakes<span class="sc">$</span>depth, <span class="st">&quot;&lt;br/&gt;&quot;</span>, </span>
<span id="cb78-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-15" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;Stations: &quot;</span>, quakes<span class="sc">$</span>stations, <span class="st">&quot;&lt;br/&gt;&quot;</span>, </span>
<span id="cb78-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-16" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;Magnitude: &quot;</span>, quakes<span class="sc">$</span>mag, <span class="at">sep=</span><span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(htmltools<span class="sc">::</span>HTML)</span>
<span id="cb78-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Final Map</span></span>
<span id="cb78-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-20" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>(quakes) <span class="sc">%&gt;%</span> </span>
<span id="cb78-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb78-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>( <span class="at">lat=</span><span class="sc">-</span><span class="dv">27</span>, <span class="at">lng=</span><span class="dv">170</span> , <span class="at">zoom=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;Esri.WorldImagery&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="sc">~</span>long, <span class="sc">~</span>lat, </span>
<span id="cb78-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">mypalette</span>(mag), <span class="at">fillOpacity =</span> <span class="fl">0.7</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">radius=</span><span class="dv">8</span>, <span class="at">stroke=</span><span class="cn">FALSE</span>,</span>
<span id="cb78-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> mytext,</span>
<span id="cb78-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labelOptions =</span> <span class="fu">labelOptions</span>( <span class="at">style =</span> <span class="fu">list</span>(<span class="st">&quot;font-weight&quot;</span> <span class="ot">=</span> <span class="st">&quot;normal&quot;</span>, <span class="at">padding =</span> <span class="st">&quot;3px 8px&quot;</span>), <span class="at">textsize =</span> <span class="st">&quot;13px&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb78-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb78-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>( <span class="at">pal=</span>mypalette, <span class="at">values=</span><span class="sc">~</span>mag, <span class="at">opacity=</span><span class="fl">0.9</span>, <span class="at">title =</span> <span class="st">&quot;Magnitude&quot;</span>, <span class="at">position =</span> <span class="st">&quot;bottomright&quot;</span> )</span>
<span id="cb78-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-31" aria-hidden="true" tabindex="-1"></a>m </span>
<span id="cb78-32"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="co"># save the widget in a html file if needed.</span></span>
<span id="cb78-34"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmlwidgets)</span>
<span id="cb78-35"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb78-35" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(m, <span class="at">file=</span><span class="fu">paste0</span>( <span class="fu">getwd</span>(), <span class="st">&quot;/HtmlWidget/bubblemapQuakes.html&quot;</span>))</span></code></pre></div>
<center>
<iframe title="My embedded document" src="mapHtml/bubblemapQuakes.html" height="300px" width="100%"></iframe>
</center>
</div>
<div id="bubble-map-with-ggplot2" class="section level3" number="9.3.13">
<h3><span class="header-section-number">9.3.13</span> Bubble map with <code>ggplot2</code></h3>
<p>This section explains how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a> with <a href="https://www.r-graph-gallery.com/ggplot2-package.html">ggplot2</a>. It takes a list of GPS coordinates and plot them on top of a map, with size and color mapped to data.</p>
<p>This section explains how to make a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a> with <a href="https://www.r-graph-gallery.com/ggplot2-package.html">ggplot2</a>.</p>
<p>A bubble map is like a <a href="https://www.r-graph-gallery.com/bubble-chart.html">bubble chart</a>, but with a map in the background. As input you need:</p>
<ul>
<li>A list of GPS coordinates (longitude and latitude of the places you want to represent).</li>
<li>A numeric variable used for bubble color and size.</li>
</ul>
<p>This section provides a step-by-step approach to build the map beside, showing the 1000 biggest cities of the UK.</p>
<div id="load-data" class="section level4" number="9.3.13.1">
<h4><span class="header-section-number">9.3.13.1</span> Load Data</h4>
<p>The first step is to get the boundaries of the zone that interests you. Several option are available in R, as extensively described in the <a href="https://www.r-graph-gallery.com/map.html">background map</a> section of the gallery.</p>
<p>Briefly, you can find this information somewhere under the <a href="https://www.r-graph-gallery.com/168-load-a-shape-file-into-r.html">shapefile</a> format or under the <a href="https://www.r-graph-gallery.com/325-background-map-from-geojson-format-in-r.html">geoJSON</a> format. You can also load google like backgrounds with the <a href="https://www.r-graph-gallery.com/324-map-background-with-the-ggmap-library.html">ggmap</a> library.</p>
<p>This section uses the last approach: it loads the <code>maps</code> package that provides the boundaries of every world country.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb79-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb79-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb79-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb79-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the world polygon and extract UK</span></span>
<span id="cb79-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb79-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb79-7" aria-hidden="true" tabindex="-1"></a>UK <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="st">&quot;UK&quot;</span>)</span></code></pre></div>
<p>The second step is to load a data frame with the info of the bubble you want to draw. The <code>maps</code> library provides a list of the biggest cities in the world. Lets use it to get information on the UK.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a data frame with longitude, latitude, and size of bubbles (a bubble = a city)</span></span>
<span id="cb80-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb80-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> world.cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country.etc<span class="sc">==</span><span class="st">&quot;UK&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="basic-scatterplot-map" class="section level3" number="9.3.14">
<h3><span class="header-section-number">9.3.14</span> Basic Scatterplot Map</h3>
<p><code>ggplot2</code> makes it a breeze to map both information on the same graph. Use <code>geom_polygon</code> for the shape of UK first, and add your scatterplot on it with <code>geom_point()</code>.</p>
<p>On the right figure, note the use of the <code>ggrepel</code> library to avoid overlapping between city names.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left chart</span></span>
<span id="cb81-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat)) <span class="sc">+</span></span>
<span id="cb81-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() </span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second graphic with names of the 10 biggest cities</span></span>
<span id="cb82-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb82-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb82-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">alpha=</span>pop)) <span class="sc">+</span></span>
<span id="cb82-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>( <span class="at">data=</span>data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>), <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">label=</span>name), <span class="at">size=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb82-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>), <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat), <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span></span>
<span id="cb82-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-32-2.png" width="672" /></p>
</div>
<div id="basic-bubble-map" class="section level3" number="9.3.15">
<h3><span class="header-section-number">9.3.15</span> Basic Bubble Map</h3>
<p>Now we want to add another information. The number of inhabitant per city will be mapped to the colour and the size of the bubbles. Note that the order of city matters! It is advised to show the most important information on top (center). This can been done sorting your dataset before making the plot.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># virids package for the color palette</span></span>
<span id="cb83-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb83-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb83-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Left: use size and color</span></span>
<span id="cb83-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop)) <span class="sc">+</span></span>
<span id="cb83-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb83-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() </span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Center: reorder your dataset first! Big cities appear later = on top</span></span>
<span id="cb84-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb84-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop), <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb84-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right: just use arrange(desc(pop)) instead</span></span>
<span id="cb85-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">arrange</span>(<span class="fu">desc</span>(pop)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb85-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb85-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop), <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb85-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb85-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-33-3.png" width="672" /></p>
</div>
<div id="customized-bubble-map" class="section level3" number="9.3.16">
<h3><span class="header-section-number">9.3.16</span> Customized Bubble Map</h3>
<p>We can custom a little bit this figure for a better looking result (first image of this section).</p>
<p>Note that here the legend shows both the size, the color and the transparency on the same circles. This is possible only if these 3 informations are redondante, with the same name, transformation and breaks.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create breaks for the color scale</span></span>
<span id="cb86-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-2" aria-hidden="true" tabindex="-1"></a>mybreaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.04</span>, <span class="fl">0.08</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb86-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder data to show biggest cities on top</span></span>
<span id="cb86-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span></span>
<span id="cb86-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span></span>
<span id="cb86-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop=</span>pop<span class="sc">/</span><span class="dv">1000000</span>) </span>
<span id="cb86-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the map</span></span>
<span id="cb86-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-11" aria-hidden="true" tabindex="-1"></a>map <span class="sc">%&gt;%</span></span>
<span id="cb86-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb86-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb86-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(  <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop, <span class="at">alpha=</span>pop), <span class="at">shape=</span><span class="dv">20</span>, <span class="at">stroke=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb86-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>), <span class="at">breaks=</span>mybreaks) <span class="sc">+</span></span>
<span id="cb86-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">9</span>), <span class="at">breaks=</span>mybreaks) <span class="sc">+</span></span>
<span id="cb86-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">option=</span><span class="st">&quot;magma&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span>, <span class="at">breaks=</span>mybreaks, <span class="at">name=</span><span class="st">&quot;Population (in M)&quot;</span> ) <span class="sc">+</span></span>
<span id="cb86-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span> <span class="fu">coord_map</span>() <span class="sc">+</span> </span>
<span id="cb86-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>( <span class="at">colour =</span> <span class="fu">guide_legend</span>()) <span class="sc">+</span></span>
<span id="cb86-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;The 1000 biggest cities in the UK&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb86-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.8</span>),</span>
<span id="cb86-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#22211d&quot;</span>),</span>
<span id="cb86-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb86-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb86-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb86-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">16</span>, <span class="at">hjust=</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">t =</span> <span class="fl">0.4</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb86-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb86-28" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="https://www.r-graph-gallery.com/img/graph/330-bubble-map-with-ggplot2.png" /></p>
</div>
<div id="interactive-bubble-map-with-plotly" class="section level3" number="9.3.17">
<h3><span class="header-section-number">9.3.17</span> Interactive Bubble Map with Plotly</h3>
<p>Last but not least, plotly allows to quickly get an interactive version. This is really handy since it allows to zoom on the map and hover a city to know its name and population!</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the plotly package</span></span>
<span id="cb87-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb87-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb87-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rorder data + Add a new column with tooltip text</span></span>
<span id="cb87-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb87-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pop) <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">name=</span><span class="fu">factor</span>(name, <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span></span>
<span id="cb87-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mytext=</span><span class="fu">paste</span>(</span>
<span id="cb87-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;City: &quot;</span>, name, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb87-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Population: &quot;</span>, pop, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb87-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb87-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the map (static)</span></span>
<span id="cb87-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb87-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb87-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> UK, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb87-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat, <span class="at">size=</span>pop, <span class="at">color=</span>pop, <span class="at">text=</span>mytext, <span class="at">alpha=</span>pop) ) <span class="sc">+</span></span>
<span id="cb87-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb87-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis</span>(<span class="at">option=</span><span class="st">&quot;inferno&quot;</span>, <span class="at">trans=</span><span class="st">&quot;log&quot;</span> ) <span class="sc">+</span></span>
<span id="cb87-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">trans=</span><span class="st">&quot;log&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb87-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="sc">+</span></span>
<span id="cb87-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_map</span>() <span class="sc">+</span></span>
<span id="cb87-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb87-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb87-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-26" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplotly</span>(p, <span class="at">tooltip=</span><span class="st">&quot;text&quot;</span>)</span>
<span id="cb87-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-27" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb87-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="co"># save the widget in a html file if needed.</span></span>
<span id="cb87-30"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="co"># library(htmlwidgets)</span></span>
<span id="cb87-31"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb87-31" aria-hidden="true" tabindex="-1"></a><span class="co"># saveWidget(p, file=paste0( getwd(), &quot;/HtmlWidget/bubblemapUK.html&quot;))</span></span></code></pre></div>
<center>
<iframe title="My embedded document" src="mapHtml/bubblemapUK.html" height="300px" width="100%"></iframe>
</center>
</div>
<div id="proportional-symbol-map-with-the-cartography-package" class="section level3" number="9.3.18">
<h3><span class="header-section-number">9.3.18</span> Proportional Symbol Map with the Cartography Package</h3>
<p>The <a href="https://github.com/riatelab/cartography">cartography package</a> is a great alternative to make maps with R. This section explains how to build a <a href="https://www.r-graph-gallery.com/bubble-map.html">bubble map</a> using it, with explanation and reproducible code.</p>
<p>The <code>cartography</code> package is a very good alternative to the <a href="https://www.r-graph-gallery.com/bubble-map.html">other tools</a> presented in the gallery for building maps.</p>
<p>It notably allows to:</p>
<ul>
<li>Display a legend with embedded circles</li>
<li>Add data sources on the bottom of the chart</li>
<li>Show north / south</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb88-2"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartography)</span>
<span id="cb88-3"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb88-4"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Upload data attached with the package.</span></span>
<span id="cb88-6"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nuts2006)</span>
<span id="cb88-7"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have a geospatial object called nuts2.spdf containing the shape of european regions. We can plot it with the plot function.</span></span>
<span id="cb88-9"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(nuts2.spdf)</span></span>
<span id="cb88-10"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We also have a dataframe with information concerning every region.</span></span>
<span id="cb88-12"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># head(nuts2.df)</span></span>
<span id="cb88-13"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Both object have a first column &quot;id&quot; that makes the link between them.</span></span>
<span id="cb88-14"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Europe</span></span>
<span id="cb88-16"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nuts0.spdf, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="st">&quot;#A6CAE0&quot;</span>)</span>
<span id="cb88-17"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world.spdf, <span class="at">col =</span> <span class="st">&quot;#E3DEBF&quot;</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-18"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nuts0.spdf, <span class="at">col =</span> <span class="st">&quot;#D1914D&quot;</span>, <span class="at">border =</span> <span class="st">&quot;grey80&quot;</span>,  <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-19"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add circles proportional to the total population</span></span>
<span id="cb88-21"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="fu">propSymbolsLayer</span>(<span class="at">spdf =</span> nuts0.spdf, <span class="at">df =</span> nuts0.df,</span>
<span id="cb88-22"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> <span class="st">&quot;pop2008&quot;</span>, <span class="at">symbols =</span> <span class="st">&quot;circle&quot;</span>, <span class="at">col =</span> <span class="st">&quot;#920000&quot;</span>,</span>
<span id="cb88-23"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.pos =</span> <span class="st">&quot;right&quot;</span>, <span class="at">legend.title.txt =</span> <span class="st">&quot;Total</span><span class="sc">\n</span><span class="st">population (2008)&quot;</span>,</span>
<span id="cb88-24"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.style =</span> <span class="st">&quot;c&quot;</span>)</span>
<span id="cb88-25"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-26"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add titles, legend...</span></span>
<span id="cb88-27"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="fu">layoutLayer</span>(<span class="at">title =</span> <span class="st">&quot;Countries Population in Europe&quot;</span>,</span>
<span id="cb88-28"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">author =</span> <span class="st">&quot;cartography&quot;</span>, <span class="at">sources =</span> <span class="st">&quot;Eurostat, 2008&quot;</span>,</span>
<span id="cb88-29"><a href="use-the-cartography-library-to-do-the-choropleth-map.html#cb88-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">south =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="r-graph_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="map.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="flow.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-graph.pdf", "r-graph.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
